{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Project/SigapPlanner/web/lib/api-client.ts"],"sourcesContent":["// lib/api-client.ts\r\nexport type ApiOptions = RequestInit & { body?: any };\r\n\r\nconst API_BASE = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:4000/api';\r\n\r\nasync function handleResp(res: Response) {\r\n  const text = await res.text();\r\n  let data;\r\n  try { data = text ? JSON.parse(text) : undefined; } catch { data = text; }\r\n  if (!res.ok) {\r\n    const err: any = new Error(data?.message || res.statusText || 'API error');\r\n    err.status = res.status;\r\n    err.body = data;\r\n    throw err;\r\n  }\r\n  return data;\r\n}\r\n\r\nexport default async function apiClient(path: string, opts: ApiOptions = {}) {\r\n  const url = path.startsWith('http') ? path : `${API_BASE}${path.startsWith('/') ? '' : '/'}${path}`;\r\n\r\n  const headers: Record<string,string> = {\r\n    'Accept': 'application/json',\r\n    ...(opts.headers as Record<string,string> || {}),\r\n  };\r\n\r\n  let body: BodyInit | undefined;\r\n  if (opts.body !== undefined) {\r\n    headers['Content-Type'] = 'application/json';\r\n    body = JSON.stringify(opts.body);\r\n  }\r\n\r\n  try {\r\n    const res = await fetch(url, {\r\n      credentials: 'include',\r\n      ...opts,\r\n      headers,\r\n      body,\r\n    });\r\n    return await handleResp(res);\r\n  } catch (err: any) {\r\n    // Network-level error (CORS, DNS, connection refused, etc)\r\n    const e: any = new Error(err.message || 'Network error');\r\n    e.detail = err;\r\n    e.url = url;\r\n    throw e;\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,oBAAoB;;;;;AAGH;AAAjB,MAAM,WAAW,kLAAO,CAAC,GAAG,CAAC,mBAAmB,IAAI;AAEpD,eAAe,WAAW,GAAa;IACrC,MAAM,OAAO,MAAM,IAAI,IAAI;IAC3B,IAAI;IACJ,IAAI;QAAE,OAAO,OAAO,KAAK,KAAK,CAAC,QAAQ;IAAW,EAAE,OAAM;QAAE,OAAO;IAAM;IACzE,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,MAAW,IAAI,MAAM,MAAM,WAAW,IAAI,UAAU,IAAI;QAC9D,IAAI,MAAM,GAAG,IAAI,MAAM;QACvB,IAAI,IAAI,GAAG;QACX,MAAM;IACR;IACA,OAAO;AACT;AAEe,eAAe,UAAU,IAAY,EAAE,OAAmB,CAAC,CAAC;IACzE,MAAM,MAAM,KAAK,UAAU,CAAC,UAAU,OAAO,GAAG,WAAW,KAAK,UAAU,CAAC,OAAO,KAAK,MAAM,MAAM;IAEnG,MAAM,UAAiC;QACrC,UAAU;QACV,GAAI,KAAK,OAAO,IAA6B,CAAC,CAAC;IACjD;IAEA,IAAI;IACJ,IAAI,KAAK,IAAI,KAAK,WAAW;QAC3B,OAAO,CAAC,eAAe,GAAG;QAC1B,OAAO,KAAK,SAAS,CAAC,KAAK,IAAI;IACjC;IAEA,IAAI;QACF,MAAM,MAAM,MAAM,MAAM,KAAK;YAC3B,aAAa;YACb,GAAG,IAAI;YACP;YACA;QACF;QACA,OAAO,MAAM,WAAW;IAC1B,EAAE,OAAO,KAAU;QACjB,2DAA2D;QAC3D,MAAM,IAAS,IAAI,MAAM,IAAI,OAAO,IAAI;QACxC,EAAE,MAAM,GAAG;QACX,EAAE,GAAG,GAAG;QACR,MAAM;IACR;AACF"}},
    {"offset": {"line": 61, "column": 0}, "map": {"version":3,"sources":["file:///D:/Project/SigapPlanner/web/components/GanttCombined.tsx"],"sourcesContent":["'use client';\r\nimport React, { useEffect, useRef, useState } from 'react';\r\nimport apiClient from '../lib/api-client';\r\n\r\nimport moment from 'moment';\r\n\r\ntype WO = {\r\n  id: string | number;\r\n  doc_no: string;\r\n  asset_name: string;\r\n  work_type: string | null;\r\n  status: string | null;\r\n  start_date: string | null;\r\n  end_date: string | null;\r\n  duration_hour?: number;\r\n  raw?: any;\r\n};\r\n\r\n// color mapping for bars\r\nconst BAR_COLORS: Record<string,string> = {\r\n  PM: '#4ade80',\r\n  CM: '#fb923c',\r\n  BD: '#ef4444',\r\n  DEFAULT: '#60a5fa'\r\n};\r\n\r\n// badge colors\r\nconst STATUS_COLORS: Record<string,string> = {\r\n  'Waiting For Submitted': '#84cc16',\r\n  'Waiting For Submit Running': '#f97316',\r\n  'Waiting For Approval': '#3b82f6',\r\n  'Work Order Completed': '#10b981',\r\n  'Waiting For Good Issue': '#fde047',\r\n  'Waiting For Input Realization': '#8b5cf6',\r\n  DEFAULT: '#e5e7eb'\r\n};\r\n\r\n// utility color selector\r\nfunction chooseBarColor(type: string | null = '') {\r\n  if (!type) return BAR_COLORS.DEFAULT;\r\n  const key = type.toUpperCase();\r\n  if (key.includes('PM')) return BAR_COLORS.PM;\r\n  if (key.includes('CM')) return BAR_COLORS.CM;\r\n  if (key.includes('BD') || key.includes('BREAK')) return BAR_COLORS.BD;\r\n  return BAR_COLORS.DEFAULT;\r\n}\r\n\r\nfunction chooseStatusColor(status: string | null = '') {\r\n  if (!status) return STATUS_COLORS.DEFAULT;\r\n  const s = status.trim();\r\n  return STATUS_COLORS[s] ?? STATUS_COLORS.DEFAULT;\r\n}\r\n\r\nexport default function GanttCombined() {\r\n  const leftRef = useRef<HTMLDivElement>(null);\r\n  const rightRef = useRef<HTMLDivElement>(null);\r\n\r\n  const [rows, setRows] = useState<WO[]>([]);\r\n  const [selectedDate, setSelectedDate] = useState(\r\n    moment().format('YYYY-MM-DD')\r\n  );\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  useEffect(() => { loadRows(); }, []);\r\n\r\n  async function loadRows() {\r\n    setLoading(true);\r\n    try {\r\n      const res = await apiClient(`/work-orders?page=1&pageSize=2000`);\r\n      const data = res?.data ?? [];\r\n\r\n      const mapped: WO[] = data.map((r:any) => {\r\n        const sd = r.start_date ? moment(r.start_date) : null;\r\n        const ed = r.end_date ? moment(r.end_date) : null;\r\n        let duration = null;\r\n        if (sd && ed) duration = ed.diff(sd, 'hours');\r\n\r\n        return {\r\n          id: r.id,\r\n          doc_no: r.doc_no ?? '',\r\n          asset_name: r.asset_name ?? '',\r\n          work_type: r.work_type ?? (r.raw?.work_type ?? ''),\r\n          status: r.raw?.doc_status ?? '',\r\n          start_date: r.start_date,\r\n          end_date: r.end_date,\r\n          duration_hour: duration,\r\n          raw: r\r\n        };\r\n      });\r\n\r\n      setRows(mapped);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  // sync scroll left & right\r\n  useEffect(() => {\r\n    const L = leftRef.current;\r\n    const R = rightRef.current;\r\n    if (!L || !R) return;\r\n\r\n    const handler = () => {\r\n      R.scrollTop = L.scrollTop;\r\n    };\r\n    L.addEventListener('scroll', handler);\r\n    return () => L.removeEventListener('scroll', handler);\r\n  }, []);\r\n\r\n  const hours = Array.from({length: 24}, (_,i) => i);\r\n\r\n  return (\r\n    <div style={{ display:'flex', height:'80vh', border:'1px solid #e5e7eb', borderRadius:12, overflow:'hidden' }}>\r\n\r\n      {/* LEFT PANEL */}\r\n      <div ref={leftRef} style={{ width: '320px', overflowY:'auto', background:'#fafafa', borderRight:'1px solid #eee' }}>\r\n        \r\n        {/* HEADER */}\r\n        <div style={{ padding:'16px', borderBottom:'1px solid #e5e7eb', background:'#fff' }}>\r\n          <h3 style={{ margin:0 }}>WO Number</h3>\r\n        </div>\r\n\r\n        {/* BODY */}\r\n        {rows.map((r, idx) => (\r\n          <div key={r.id} style={{ padding:'12px 16px', minHeight:80, borderBottom:'1px solid #eee' }}>\r\n            \r\n            <div style={{ fontWeight:600 }}>\r\n              {r.doc_no}\r\n            </div>\r\n\r\n            <div style={{ fontSize:'0.85rem', color:'#555' }}>\r\n              {r.asset_name}\r\n            </div>\r\n\r\n            {/* status badge */}\r\n            <div style={{\r\n              display:'inline-block',\r\n              marginTop:6,\r\n              padding:'3px 10px',\r\n              borderRadius:20,\r\n              fontSize:'0.75rem',\r\n              color:'#fff',\r\n              background: chooseStatusColor(r.status)\r\n            }}>\r\n              {r.status || 'Unknown'}\r\n            </div>\r\n\r\n            {/* Duration */}\r\n            {r.duration_hour != null && (\r\n              <div style={{ marginTop:6, fontSize:'0.8rem', color:'#333' }}>\r\n                Realization: {r.duration_hour} h\r\n              </div>\r\n            )}\r\n\r\n          </div>\r\n        ))}\r\n\r\n      </div>\r\n\r\n      {/* RIGHT PANEL */}\r\n      <div style={{ flex:1, display:'flex', flexDirection:'column' }}>\r\n\r\n        {/* TIMELINE HEADER */}\r\n        <div style={{ height:50, borderBottom:'1px solid #eee', display:'flex', alignItems:'center', paddingLeft:10, background:'#fff' }}>\r\n          {hours.map(h => (\r\n            <div key={h} style={{ width:`${100/24}%`, textAlign:'center', fontSize:'0.8rem' }}>\r\n              {moment().hour(h).format('HH.00')}\r\n            </div>\r\n          ))}\r\n        </div>\r\n\r\n        {/* TIMELINE BODY */}\r\n        <div ref={rightRef} style={{ flex:1, overflowY:'auto', position:'relative' }}>\r\n\r\n          {/* grid vertical lines */}\r\n          <div style={{ position:'absolute', top:0, left:0, right:0, bottom:0, display:'flex' }}>\r\n            {hours.map(h => (\r\n              <div key={h} style={{ flex:1, borderLeft:'1px solid #f1f1f1' }} />\r\n            ))}\r\n          </div>\r\n\r\n          {/* NOW MARKER */}\r\n          {(() => {\r\n            const now = moment();\r\n            const selectedStart = moment(selectedDate + ' 00:00');\r\n            const selectedEnd = moment(selectedDate + ' 23:59');\r\n\r\n            if (now.isBetween(selectedStart, selectedEnd)) {\r\n              const hour = now.hour() + now.minute()/60;\r\n              const leftPct = (hour / 24) * 100;\r\n              return (\r\n                <div style={{\r\n                  position:'absolute',\r\n                  top:0, bottom:0,\r\n                  left:`${leftPct}%`,\r\n                  borderLeft:'2px dashed purple',\r\n                  zIndex:5\r\n                }} />\r\n              );\r\n            }\r\n            return null;\r\n          })()}\r\n\r\n          {/* ROWS */}\r\n          {rows.map((r, idx) => {\r\n            const s = r.start_date ? moment(r.start_date) : null;\r\n            const e = r.end_date ? moment(r.end_date) : null;\r\n            if (!s || !e) return null;\r\n\r\n            const startHour = s.hour() + s.minute()/60;\r\n            const endHour = e.hour() + e.minute()/60;\r\n\r\n            const leftPct = (startHour/24)*100;\r\n            const widthPct = ((endHour-startHour)/24)*100;\r\n\r\n            return (\r\n              <div key={r.id} style={{ position:'relative', height:80, borderBottom:'1px solid #f5f5f5' }}>\r\n                \r\n                {/* Bar */}\r\n                <div style={{\r\n                  position:'absolute',\r\n                  top:'22px',\r\n                  left:`${leftPct}%`,\r\n                  width:`${widthPct}%`,\r\n                  height:'36px',\r\n                  background: chooseBarColor(r.work_type || ''),\r\n                  borderRadius:18,\r\n                  display:'flex',\r\n                  alignItems:'center',\r\n                  justifyContent:'center',\r\n                  color:'#fff',\r\n                  fontWeight:600,\r\n                  fontSize:'0.8rem',\r\n                  zIndex:3,\r\n                  boxShadow:'0 2px 6px rgba(0,0,0,0.15)'\r\n                }}>\r\n                  {r.doc_no}\r\n                </div>\r\n\r\n              </div>\r\n            );\r\n          })}\r\n\r\n        </div>\r\n\r\n      </div>\r\n\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}