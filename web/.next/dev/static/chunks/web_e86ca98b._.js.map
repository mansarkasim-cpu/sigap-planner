{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Project/SigapPlanner/web/lib/api-client.ts"],"sourcesContent":["export const API_BASE = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:4000/api\";\r\n\r\n/**\r\n * Simple fetch wrapper for JSON APIs.\r\n * - path can be full URL or relative (prefixed with API_BASE)\r\n * - options.body will be JSON.stringified when plain object provided\r\n */\r\nexport async function apiClient(path: string, options: RequestInit = {}) {\r\n  const url = path.startsWith(\"http\") ? path : `${API_BASE}${path.startsWith(\"/\") ? \"\" : \"/\"}${path}`;\r\n  const init: RequestInit = { ...options };\r\n  const headers: Record<string, string> = Object.assign({}, (init.headers as any) || {});\r\n\r\n  // JSON encode body if needed\r\n  if (init.body && !(init.body instanceof FormData) && typeof init.body === \"object\") {\r\n    headers[\"Content-Type\"] = \"application/json\";\r\n    init.body = JSON.stringify(init.body);\r\n  }\r\n\r\n  // attach auth if token present\r\n  try {\r\n    if (typeof window !== \"undefined\") {\r\n      const token = localStorage.getItem(\"token\");\r\n      if (token) headers[\"Authorization\"] = `Bearer ${token}`;\r\n    }\r\n  } catch (_) {}\r\n\r\n  init.headers = headers;\r\n\r\n  const res = await fetch(url, init);\r\n  const text = await res.text();\r\n  let data: any = null;\r\n  try { data = text ? JSON.parse(text) : null; } catch { data = text; }\r\n\r\n  if (!res.ok) {\r\n    const err: any = new Error(data?.message || `Request failed ${res.status}`);\r\n    err.status = res.status;\r\n    err.payload = data;\r\n    throw err;\r\n  }\r\n  return data;\r\n}\r\n\r\n/**\r\n * Fetch external SIGAP API for WorkOrder by id (public endpoint).\r\n * Returns parsed JSON or throws.\r\n */\r\nexport async function fetchExternalWorkOrder(id: string) {\r\n  if (!id) throw new Error(\"id required\");\r\n  const url = `https://sigap-api.pelindo.co.id/api/Work/WorkOrderAgreement/GetData/${encodeURIComponent(id)}`;\r\n  const res = await fetch(url, { method: \"GET\" });\r\n  if (!res.ok) throw new Error(`External API error ${res.status}`);\r\n  return res.json();\r\n}"],"names":[],"mappings":";;;;;;;;AAAwB;AAAjB,MAAM,WAAW,kLAAO,CAAC,GAAG,CAAC,mBAAmB,IAAI;AAOpD,eAAe,UAAU,IAAY,EAAE,UAAuB,CAAC,CAAC;IACrE,MAAM,MAAM,KAAK,UAAU,CAAC,UAAU,OAAO,GAAG,WAAW,KAAK,UAAU,CAAC,OAAO,KAAK,MAAM,MAAM;IACnG,MAAM,OAAoB;QAAE,GAAG,OAAO;IAAC;IACvC,MAAM,UAAkC,OAAO,MAAM,CAAC,CAAC,GAAG,AAAC,KAAK,OAAO,IAAY,CAAC;IAEpF,6BAA6B;IAC7B,IAAI,KAAK,IAAI,IAAI,CAAC,CAAC,KAAK,IAAI,YAAY,QAAQ,KAAK,OAAO,KAAK,IAAI,KAAK,UAAU;QAClF,OAAO,CAAC,eAAe,GAAG;QAC1B,KAAK,IAAI,GAAG,KAAK,SAAS,CAAC,KAAK,IAAI;IACtC;IAEA,+BAA+B;IAC/B,IAAI;QACF,wCAAmC;YACjC,MAAM,QAAQ,aAAa,OAAO,CAAC;YACnC,IAAI,OAAO,OAAO,CAAC,gBAAgB,GAAG,CAAC,OAAO,EAAE,OAAO;QACzD;IACF,EAAE,OAAO,GAAG,CAAC;IAEb,KAAK,OAAO,GAAG;IAEf,MAAM,MAAM,MAAM,MAAM,KAAK;IAC7B,MAAM,OAAO,MAAM,IAAI,IAAI;IAC3B,IAAI,OAAY;IAChB,IAAI;QAAE,OAAO,OAAO,KAAK,KAAK,CAAC,QAAQ;IAAM,EAAE,OAAM;QAAE,OAAO;IAAM;IAEpE,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,MAAW,IAAI,MAAM,MAAM,WAAW,CAAC,eAAe,EAAE,IAAI,MAAM,EAAE;QAC1E,IAAI,MAAM,GAAG,IAAI,MAAM;QACvB,IAAI,OAAO,GAAG;QACd,MAAM;IACR;IACA,OAAO;AACT;AAMO,eAAe,uBAAuB,EAAU;IACrD,IAAI,CAAC,IAAI,MAAM,IAAI,MAAM;IACzB,MAAM,MAAM,CAAC,oEAAoE,EAAE,mBAAmB,KAAK;IAC3G,MAAM,MAAM,MAAM,MAAM,KAAK;QAAE,QAAQ;IAAM;IAC7C,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM,CAAC,mBAAmB,EAAE,IAAI,MAAM,EAAE;IAC/D,OAAO,IAAI,IAAI;AACjB"}},
    {"offset": {"line": 65, "column": 0}, "map": {"version":3,"sources":["file:///D:/Project/SigapPlanner/web/app/work-orders/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { apiClient, fetchExternalWorkOrder } from '../../lib/api-client';\r\n\r\ntype WorkOrder = {\r\n  id: string;\r\n  wo_id?: string;\r\n  equipment_name?: string;\r\n  description?: string;\r\n  raw?: any;\r\n  created_at?: string;\r\n};\r\n\r\nexport default function WorkOrdersPage() {\r\n  const [list, setList] = useState<WorkOrder[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [err, setErr] = useState<string | null>(null);\r\n\r\n  const [inputId, setInputId] = useState('');\r\n  const [creating, setCreating] = useState(false);\r\n  const [message, setMessage] = useState<string | null>(null);\r\n\r\n  const [preview, setPreview] = useState<any | null>(null);\r\n\r\n  async function load() {\r\n    setLoading(true);\r\n    setErr(null);\r\n    try {\r\n      // backend endpoint: GET /api/wo\r\n      const data = await apiClient('/wo');\r\n      // backend returns { total, items } or array; normalize:\r\n      const items = Array.isArray(data) ? data : (data?.items ?? data?.items ?? []);\r\n      setList(items);\r\n    } catch (e: any) {\r\n      setErr(e.message || 'Failed to load');\r\n      setList([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    load();\r\n  }, []);\r\n\r\n  async function handleFetchExternal(e: React.FormEvent) {\r\n    e.preventDefault();\r\n    setMessage(null);\r\n    setPreview(null);\r\n    if (!inputId) return setMessage('Masukkan id terlebih dahulu');\r\n    setCreating(true);\r\n    try {\r\n      const external = await fetchExternalWorkOrder(inputId);\r\n      setPreview(external);\r\n      setMessage('Data berhasil diambil. Tekan \"Simpan ke DB\" untuk menyimpan ke server.');\r\n    } catch (err: any) {\r\n      console.error(err);\r\n      setMessage('Gagal mengambil data eksternal: ' + (err.message || err));\r\n    } finally {\r\n      setCreating(false);\r\n    }\r\n  }\r\n\r\n  async function handleSaveToDb() {\r\n    if (!preview) return setMessage('Tidak ada data untuk disimpan');\r\n    setCreating(true);\r\n    setMessage(null);\r\n    try {\r\n      // Adjust payload mapping as backend expects.\r\n      // Here we send raw external object; backend should map fields and persist.\r\n      const res = await apiClient('/wo', {\r\n        method: 'POST',\r\n        body: JSON.stringify({ external: preview }),\r\n      });\r\n      setMessage('Work order disimpan: ' + (res?.wo_id || res?.id || 'OK'));\r\n      setPreview(null);\r\n      setInputId('');\r\n      await load();\r\n    } catch (err: any) {\r\n      console.error(err);\r\n      setMessage('Simpan ke DB gagal: ' + (err.message || err));\r\n    } finally {\r\n      setCreating(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <main style={{ padding: 20, fontFamily: 'sans-serif' }}>\r\n      <h1>Work Orders</h1>\r\n\r\n      <section style={{ marginBottom: 20 }}>\r\n        <form onSubmit={handleFetchExternal} style={{ display: 'flex', gap: 8, alignItems: 'center' }}>\r\n          <input\r\n            placeholder=\"Masukkan id SIGAP (contoh: 12345)\"\r\n            value={inputId}\r\n            onChange={(e) => setInputId(e.target.value)}\r\n            disabled={creating}\r\n          />\r\n          <button type=\"submit\" disabled={creating}>{creating ? 'Mengambil...' : 'Ambil dari SIGAP'}</button>\r\n        </form>\r\n\r\n        {message && <p style={{ marginTop: 8 }}>{message}</p>}\r\n\r\n        {preview && (\r\n          <div style={{ marginTop: 12, padding: 12, border: '1px solid #ddd', borderRadius: 6 }}>\r\n            <h3>Preview data eksternal</h3>\r\n            <pre style={{ maxHeight: 260, overflow: 'auto', background: '#fafafa', padding: 8 }}>{JSON.stringify(preview, null, 2)}</pre>\r\n            <div style={{ marginTop: 8 }}>\r\n              <button onClick={handleSaveToDb} disabled={creating}>Simpan ke DB</button>\r\n              <button onClick={() => setPreview(null)} style={{ marginLeft: 8 }}>Batal</button>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </section>\r\n\r\n      <section>\r\n        {loading ? <p>Loading...</p> : null}\r\n        {err ? <p style={{ color: 'red' }}>{err}</p> : null}\r\n\r\n        <table style={{ width: '100%', borderCollapse: 'collapse' }}>\r\n          <thead>\r\n            <tr>\r\n              <th style={{ textAlign: 'left', borderBottom: '1px solid #ccc' }}>ID</th>\r\n              <th style={{ textAlign: 'left', borderBottom: '1px solid #ccc' }}>WO ID</th>\r\n              <th style={{ textAlign: 'left', borderBottom: '1px solid #ccc' }}>Equipment</th>\r\n              <th style={{ textAlign: 'left', borderBottom: '1px solid #ccc' }}>Description</th>\r\n              <th style={{ textAlign: 'left', borderBottom: '1px solid #ccc' }}>Created</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {list.map((w) => (\r\n              <tr key={w.id}>\r\n                <td style={{ padding: '8px 0' }}>{w.id}</td>\r\n                <td style={{ padding: '8px 0' }}>{w.wo_id || '-'}</td>\r\n                <td style={{ padding: '8px 0' }}>{w.equipment_name || (w.raw?.equipmentName) || '-'}</td>\r\n                <td style={{ padding: '8px 0' }}>{w.description || '-'}</td>\r\n                <td style={{ padding: '8px 0' }}>{w.created_at ? new Date(w.created_at).toLocaleString() : '-'}</td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n\r\n        {list.length === 0 && !loading && <p>Tidak ada work order.</p>}\r\n      </section>\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}