module.exports=[73911,a=>{"use strict";var b=a.i(56856),c=a.i(55132),d=a.i(59165);function e(){let[a,e]=(0,c.useState)([]),[f,g]=(0,c.useState)(!0),[h,i]=(0,c.useState)([]),[j,k]=(0,c.useState)(null),[l,m]=(0,c.useState)(null),[n,o]=(0,c.useState)(!1);async function p(){g(!0);try{let a=await (0,d.apiFetch)("/assignments");e(Array.isArray(a)?a:a.items||[])}catch(a){console.error("fetch assignments error",a),e([])}finally{g(!1)}}async function q(){if(!l)return void alert("Select assignment first");o(!0);try{let a=[];for(let b of h){let c=await (0,d.uploadFilePresign)(b);a.push(c.url)}let b=null;j&&(b=(await (0,d.uploadFilePresign)(j)).url);let c={wo_id:l.work_order_id||l.work_order?.wo_id||null,assignment_id:l.id,start_time:new Date().toISOString(),end_time:new Date().toISOString(),actions_taken:"Submitted from web UI",man_hours:1,notes:"Uploaded from Next.js web",photos:a,signature:b},e=await (0,d.apiFetch)("/realisasi",{method:"POST",body:c});alert("Realisasi submitted: "+(e.realisasi_id||e.id||"ok")),p(),i([]),k(null),m(null)}catch(a){console.error(a),alert("Submit failed: "+(a.message||"error"))}finally{o(!1)}}return(0,c.useEffect)(()=>{p()},[]),(0,b.jsxs)("div",{style:{padding:20},children:[(0,b.jsx)("h1",{children:"Assignments"}),f?(0,b.jsx)("div",{children:"Loading..."}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("ul",{children:a.map(a=>(0,b.jsxs)("li",{style:{marginBottom:8},children:[(0,b.jsx)("strong",{children:a.work_order?.title||a.work_order_id}),(0,b.jsxs)("div",{children:["Assignee: ",a.assignee_id]}),(0,b.jsxs)("div",{children:["Status: ",a.status]}),(0,b.jsx)("button",{onClick:()=>m(a),style:{marginTop:6},children:"Select"})]},a.id))}),(0,b.jsx)("hr",{}),(0,b.jsx)("h2",{children:"Submit Realisasi"}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{children:["Selected assignment: ",l?l.id:"â€”"]}),(0,b.jsx)("input",{type:"file",multiple:!0,onChange:function(a){i(Array.from(a.target.files||[]))}}),(0,b.jsxs)("div",{style:{marginTop:8},children:[(0,b.jsx)("label",{children:"Signature (PNG): "}),(0,b.jsx)("input",{type:"file",accept:"image/png",onChange:function(a){k(a.target.files&&a.target.files[0]||null)}})]}),(0,b.jsx)("div",{style:{marginTop:12},children:(0,b.jsx)("button",{onClick:q,disabled:n||!l,children:n?"Submitting...":"Submit Realisasi"})})]})]})]})}a.s(["default",()=>e])}];

//# sourceMappingURL=web_app_asignments_page_jsx_5a434bd6._.js.map