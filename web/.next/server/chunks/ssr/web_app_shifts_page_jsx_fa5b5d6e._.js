module.exports=[48338,a=>{"use strict";var b=a.i(56856),c=a.i(55132),d=a.i(59165),e=a.i(56742),f=a.i(8810),g=a.i(8607),g=g,h=a.i(89622),i=a.i(89280),i=i,j=a.i(28683),j=j,k=a.i(62205),k=k,l=a.i(45389),l=l,m=a.i(51287),m=m;let n=[{id:1,label:"Shift 1",time:"07:00 - 15:00"},{id:2,label:"Shift 2",time:"15:00 - 23:00"},{id:3,label:"Shift 3",time:"23:00 - 07:00"}];function o({children:a,color:c="#2563eb"}){return(0,b.jsx)(j.default,{label:a,sx:{backgroundColor:c,color:"#fff",fontWeight:700},size:"small"})}function p(){let[a,j]=(0,c.useState)([]),[p,q]=(0,c.useState)(""),[r,s]=(0,c.useState)([]),[t,u]=(0,c.useState)([]),[v,w]=(0,c.useState)([]),[x,y]=(0,c.useState)(""),[z,A]=(0,c.useState)(new Set),[B,C]=(0,c.useState)(""),[D,E]=(0,c.useState)(""),[F,G]=(0,c.useState)(new Date().toISOString().slice(0,10)),[H,I]=(0,c.useState)(""),[J,K]=(0,c.useState)(1);async function L(){try{let a=await (0,d.default)("/users?page=1&pageSize=1000"),b=(a?.data??a)||[],c=Array.from(new Set(b.map(a=>a.site||a.vendor_cabang||""))).filter(Boolean);j(c),!p&&c[0]&&q(c[0])}catch(a){console.error("load sites",a)}}async function M(a){try{let b=await (0,d.default)(`/users?page=1&pageSize=1000&site=${encodeURIComponent(a)}`),c=(b?.data??b)||[];s(c.filter(a=>"technician"===(a.role||"").toLowerCase()))}catch(a){console.error("load users",a)}}async function N(){try{let a=p?`/shift-groups?site=${encodeURIComponent(p)}`:"/shift-groups",b=await (0,d.default)(a),c=(b?.data??b)||[];u(c)}catch(a){console.error("load groups",a)}}async function O(){try{let a;a="calendar"===ad?p?`/shift-assignments?site=${encodeURIComponent(p)}`:"/shift-assignments":`/shift-assignments?date=${F}`+(p?`&site=${encodeURIComponent(p)}`:"");let b=await (0,d.default)(a),c=(b?.data??b)||[];w(c)}catch(a){console.error("load assignments",a),w([])}}async function P(){if(!x||0===z.size)return alert("Please enter a group name and choose at least one technician");if(D&&!z.has(D))return alert("Leader must be one of the selected members");let a={name:x,members:Array.from(z),site:p,leader:D||null};try{await (0,d.default)("/shift-groups",{method:"POST",body:a}),y(""),E(""),A(new Set),await N(),alert("Group created")}catch(a){console.error("create group",a),alert("Failed to create group")}}async function Q(){if(!H)return alert("Select a group to assign");try{await (0,d.default)("/shift-assignments",{method:"POST",body:{date:F,shift:J,groupId:H,site:p}}),await O(),alert("Assigned")}catch(a){console.error("assign",a),alert("Failed to assign")}}(0,c.useEffect)(()=>{L()},[]),(0,c.useEffect)(()=>{N()},[p]),(0,c.useEffect)(()=>{p&&M(p)},[p]),(0,c.useEffect)(()=>{O()},[F,p]);let[R,S]=(0,c.useState)(""),[T,U]=(0,c.useState)(""),[V,W]=(0,c.useState)(new Set),[X,Y]=(0,c.useState)("");function Z(){S(""),U(""),W(new Set),Y("")}async function $(){if(R)try{if(X&&!V.has(X))return alert("Leader must be one of the selected members");let a={name:T,members:Array.from(V),site:p,leader:X||null};await (0,d.default)(`/shift-groups/${R}`,{method:"PUT",body:a}),await N(),await O(),Z(),alert("Group updated")}catch(a){console.error("save edit group",a),alert("Failed to update group")}}let _=(0,c.useMemo)(()=>{let a={};return t.forEach(b=>a[b.id]=b),a},[t]),aa=(0,c.useMemo)(()=>{let a={};return r.forEach(b=>{a[b.id]=b}),a},[r]),ab=(0,c.useMemo)(()=>{let a={};return v.forEach(b=>{let c=b.shift;a[c]||(a[c]=[]),a[c].push(b)}),a},[v]),ac=(0,c.useMemo)(()=>{let a={};return v.forEach(b=>{b&&b.date&&(a[b.date]||(a[b.date]=[]),a[b.date].push(b))}),a},[v]),[ad,ae]=(0,c.useState)("schedule"),[af,ag]=(0,c.useState)(()=>{let a=new Date(F);return new Date(a.getFullYear(),a.getMonth(),1)});(0,c.useEffect)(()=>{let a=new Date(F);ag(new Date(a.getFullYear(),a.getMonth(),1))},[F]);let ah=(0,c.useMemo)(()=>(function(a){let b=new Date(a),c=b.getDay(),d=[];for(let a=0;a<c;a++){let e=new Date(b.getFullYear(),b.getMonth(),a-c+1);d.push({date:e,inMonth:!1})}let e=b.getMonth();for(let a=1;a<=31;a++){let c=new Date(b.getFullYear(),e,a);if(c.getMonth()!==e)break;d.push({date:c,inMonth:!0})}for(;d.length%7!=0;){let a=d[d.length-1].date,b=new Date(a.getFullYear(),a.getMonth(),a.getDate()+1);d.push({date:b,inMonth:!1})}return d})(af),[af]);return(0,c.useEffect)(()=>{"calendar"===ad&&O()},[ad,af,p]),(0,c.useEffect)(()=>{"schedule"===ad&&O()},[ad]),(0,b.jsxs)(k.default,{sx:{position:"relative",display:"flex",gap:3,p:1},children:[(0,b.jsx)(k.default,{sx:{position:"absolute",top:16,right:16,width:440,zIndex:20}}),(0,b.jsxs)(k.default,{sx:{width:420},children:[(0,b.jsxs)(k.default,{sx:{mb:1},children:[(0,b.jsx)(l.default,{variant:"subtitle2",sx:{mb:.5},children:"Site"}),0===a.length?(0,b.jsx)(h.Paper,{sx:{p:2,border:"1px dashed",borderColor:"divider",borderRadius:1,color:"text.secondary"},children:"Tidak ada site terdaftar. Pastikan pengguna memiliki field `site` pada profil mereka."}):(0,b.jsxs)(f.TextField,{select:!0,value:p,onChange:a=>q(a.target.value),fullWidth:!0,size:"small",children:[(0,b.jsx)(g.default,{value:"",children:"-- pilih site --"}),a.map(a=>(0,b.jsx)(g.default,{value:a,children:a},a))]})]}),(0,b.jsxs)(h.Paper,{sx:{p:2,borderRadius:2,mb:2},children:[(0,b.jsx)(l.default,{variant:"h6",sx:{mb:1},children:"Create Group"}),(0,b.jsx)(f.TextField,{placeholder:"Group name",value:x,onChange:a=>y(a.target.value),fullWidth:!0,size:"small",sx:{mb:1}}),(0,b.jsxs)(k.default,{sx:{maxHeight:260,overflow:"auto",border:1,borderColor:"divider",p:1,borderRadius:1},children:[0===r.length&&(0,b.jsx)(l.default,{color:"text.secondary",children:"No technicians for this site"}),(0,b.jsx)(f.TextField,{placeholder:"Cari teknisi (nama atau NIPP)",value:B,onChange:a=>C(a.target.value),fullWidth:!0,size:"small",sx:{mb:1}}),r.filter(a=>{if(!B)return!0;let b=B.toLowerCase();return(a.name||"").toLowerCase().includes(b)||String(a.nipp||"").includes(b)}).map(a=>(0,b.jsxs)(k.default,{sx:{display:"flex",gap:1,alignItems:"center",p:"6px 4px"},children:[(0,b.jsx)(m.default,{size:"small",checked:z.has(a.id),onChange:()=>{var b;let c;return b=a.id,void((c=new Set(z)).has(b)?c.delete(b):c.add(b),A(c))}}),(0,b.jsxs)(k.default,{children:[(0,b.jsx)(l.default,{sx:{fontWeight:700},children:a.name||a.nipp||a.email}),(0,b.jsxs)(l.default,{variant:"caption",color:"text.secondary",children:[a.nipp," • ",a.role]})]})]},a.id))]}),(0,b.jsxs)(k.default,{sx:{mt:1},children:[(0,b.jsx)(l.default,{variant:"caption",sx:{display:"block",mb:.5},children:"Leader (optional)"}),(0,b.jsxs)(f.TextField,{select:!0,value:D,onChange:a=>E(a.target.value),fullWidth:!0,size:"small",disabled:0===z.size,sx:{mb:1},children:[(0,b.jsx)(g.default,{value:"",children:"-- pilih leader (opsional) --"}),Array.from(z).map(a=>{let c=aa[a];return(0,b.jsx)(g.default,{value:a,children:c&&(c.name||c.nipp)||a},a)})]}),(0,b.jsx)(k.default,{sx:{textAlign:"right"},children:(0,b.jsx)(e.Button,{variant:"contained",size:"small",onClick:P,children:"Create"})})]})]}),(0,b.jsxs)(h.Paper,{sx:{p:2,borderRadius:2,mb:2},children:[(0,b.jsx)(l.default,{variant:"h6",children:"Existing Groups"}),0===t.length?(0,b.jsx)(l.default,{color:"text.secondary",children:"No groups created yet."}):(0,b.jsx)(k.default,{sx:{display:"grid",gap:1},children:t.map(a=>(0,b.jsx)(h.Paper,{sx:{p:1,borderRadius:1},children:R===a.id?(0,b.jsxs)(k.default,{children:[(0,b.jsxs)(k.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,b.jsx)(f.TextField,{value:T,onChange:a=>U(a.target.value),sx:{flex:1,mr:1},size:"small"}),(0,b.jsxs)(l.default,{color:"text.secondary",variant:"caption",children:[a.site||""," • ",a.members?.length||0," members"]})]}),(0,b.jsx)(k.default,{sx:{mt:1,maxHeight:180,overflow:"auto",border:1,borderColor:"divider",p:1,borderRadius:1},children:r.filter(a=>"technician"===(a.role||"").toLowerCase()).map(a=>(0,b.jsxs)(k.default,{sx:{display:"flex",gap:1,alignItems:"center",py:.5},children:[(0,b.jsx)(m.default,{size:"small",checked:V.has(a.id),onChange:()=>{var b;let c;return b=a.id,void((c=new Set(V)).has(b)?c.delete(b):c.add(b),W(c))}}),(0,b.jsxs)(k.default,{children:[(0,b.jsx)(l.default,{sx:{fontWeight:700},children:a.name||a.nipp||a.email}),(0,b.jsx)(l.default,{variant:"caption",color:"text.secondary",children:a.nipp})]})]},a.id))}),(0,b.jsxs)(k.default,{sx:{mt:1},children:[(0,b.jsx)(l.default,{variant:"caption",sx:{display:"block",mb:.5},children:"Leader (optional)"}),(0,b.jsxs)(f.TextField,{select:!0,value:X,onChange:a=>Y(a.target.value),fullWidth:!0,size:"small",disabled:0===V.size,sx:{mb:1},children:[(0,b.jsx)(g.default,{value:"",children:"-- pilih leader (opsional) --"}),Array.from(V).map(a=>{let c=aa[a];return(0,b.jsx)(g.default,{value:a,children:c&&(c.name||c.nipp)||a},a)})]}),(0,b.jsxs)(k.default,{sx:{textAlign:"right"},children:[(0,b.jsx)(e.Button,{variant:"contained",size:"small",onClick:$,sx:{mr:1},children:"Save"}),(0,b.jsx)(e.Button,{variant:"outlined",size:"small",onClick:Z,children:"Cancel"})]})]})]}):(0,b.jsxs)(k.default,{children:[(0,b.jsxs)(k.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,b.jsx)(l.default,{sx:{fontWeight:700},children:a.name}),(0,b.jsxs)(l.default,{color:"text.secondary",variant:"caption",children:[a.site||""," • ",a.members?.length||0," members"]})]}),(0,b.jsxs)(k.default,{sx:{mt:1},children:[(a.members||[]).map(a=>(0,b.jsx)(l.default,{sx:{fontSize:13},children:aa[a]?.name||aa[a]?.nipp||a},a)),a.leader?(0,b.jsxs)(l.default,{sx:{mt:.5},children:[(0,b.jsx)("strong",{children:"Leader:"})," ",aa[a.leader]?.name||aa[a.leader]?.nipp||a.leader]}):null]}),(0,b.jsxs)(k.default,{sx:{mt:1,textAlign:"right"},children:[(0,b.jsx)(e.Button,{variant:"outlined",size:"small",onClick:()=>{S(a.id),U(a.name||""),W(new Set(a.members||[])),Y(a.leader||"")},sx:{mr:1},children:"Edit"}),(0,b.jsx)(e.Button,{variant:"contained",size:"small",color:"error",onClick:async()=>{if(confirm(`Hapus grup "${a.name}"? Ini juga akan menghapus penugasan shift yang terkait.`))try{await (0,d.default)(`/shift-groups/${a.id}`,{method:"DELETE"}),await N(),await O(),alert("Group deleted")}catch(a){console.error("delete group",a),alert("Failed to delete group")}},children:"Delete"})]})]})},a.id))})]}),(0,b.jsxs)(h.Paper,{sx:{p:2,borderRadius:2,background:"background.paper"},children:[(0,b.jsx)(l.default,{variant:"h6",sx:{mb:1},children:"Assign Group to Shift"}),(0,b.jsxs)(k.default,{sx:{display:"flex",gap:1,mb:1},children:[(0,b.jsx)(f.TextField,{type:"date",value:F,onChange:a=>G(a.target.value),size:"small"}),(0,b.jsx)(f.TextField,{select:!0,value:J,onChange:a=>K(Number(a.target.value)),size:"small",children:n.map(a=>(0,b.jsxs)(g.default,{value:a.id,children:[a.label," — ",a.time]},a.id))})]}),(0,b.jsxs)(f.TextField,{select:!0,value:H,onChange:a=>I(a.target.value),fullWidth:!0,size:"small",sx:{mb:1},children:[(0,b.jsx)(g.default,{value:"",children:"-- pilih grup --"}),t.map(a=>(0,b.jsxs)(g.default,{value:a.id,children:[a.name," (",a.members?.length||0,")"]},a.id))]}),(0,b.jsx)(k.default,{sx:{textAlign:"right"},children:(0,b.jsx)(e.Button,{variant:"contained",size:"small",onClick:Q,children:"Assign"})})]})]}),(0,b.jsxs)(k.default,{sx:{flex:1},children:[(0,b.jsxs)(k.default,{sx:{mb:1.5,display:"flex",gap:1.5,alignItems:"center"},children:[(0,b.jsx)(l.default,{variant:"h6",sx:{m:0},children:"calendar"===ad?"Calendar":`Schedule — ${F}`}),(0,b.jsxs)(k.default,{sx:{ml:1.5,display:"flex",gap:1},children:[(0,b.jsx)(e.Button,{variant:"schedule"===ad?"contained":"outlined",size:"small",onClick:()=>ae("schedule"),children:"Schedule"}),(0,b.jsx)(e.Button,{variant:"calendar"===ad?"contained":"outlined",size:"small",onClick:()=>ae("calendar"),children:"Calendar"})]}),(0,b.jsx)(k.default,{sx:{ml:"auto",display:"flex",alignItems:"center",gap:1},children:"calendar"===ad?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(i.default,{size:"small",onClick:function(){ag(a=>new Date(a.getFullYear(),a.getMonth()-1,1))},children:"◀"}),(0,b.jsx)(l.default,{sx:{minWidth:200,textAlign:"center",fontWeight:700},children:af.toLocaleString(void 0,{month:"long",year:"numeric"})}),(0,b.jsx)(i.default,{size:"small",onClick:function(){ag(a=>new Date(a.getFullYear(),a.getMonth()+1,1))},children:"▶"})]}):(0,b.jsx)(f.TextField,{type:"date",value:F,onChange:a=>G(a.target.value),size:"small"})})]}),"calendar"===ad?(0,b.jsxs)(k.default,{sx:{display:"grid",gap:1},children:[(0,b.jsx)(k.default,{sx:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:.5,mb:.5,textAlign:"center",color:"text.secondary"},children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(a=>(0,b.jsx)(k.default,{sx:{fontWeight:700},children:a},a))}),(0,b.jsx)(k.default,{sx:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:1},children:ah.map(({date:a,inMonth:c})=>{let d=a=>String(a).padStart(2,"0"),e=`${a.getFullYear()}-${d(a.getMonth()+1)}-${d(a.getDate())}`,f=ac[e]||[];return(0,b.jsxs)(h.Paper,{onClick:()=>{G(e),ae("schedule")},sx:{minHeight:120,p:1,borderRadius:1,backgroundColor:c?"background.paper":"background.default",cursor:"pointer"},children:[(0,b.jsxs)(k.default,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,b.jsx)(l.default,{sx:{fontWeight:700},children:a.getDate()}),(0,b.jsx)(l.default,{variant:"caption",color:"text.secondary",children:e===new Date().toISOString().slice(0,10)?"Today":""})]}),(0,b.jsx)(k.default,{sx:{mt:1,display:"flex",flexDirection:"column",gap:.5},children:n.map(a=>{let c=f.filter(b=>Number(b.shift)===a.id);return 0===c.length?null:(0,b.jsxs)(k.default,{children:[(0,b.jsx)(l.default,{sx:{fontSize:12,color:"text.primary",fontWeight:600},children:a.label}),c.map(a=>{let c=_[a.groupId];return(0,b.jsx)(k.default,{sx:{mt:.5},children:(0,b.jsx)(o,{color:"#2563eb",children:c?c.name:`Group ${a.groupId}`})},a.id)})]},a.id)})})]},e)})})]}):(0,b.jsx)(k.default,{sx:{display:"grid",gap:1},children:n.map(a=>{let c=ab[a.id]||[];return(0,b.jsxs)(h.Paper,{sx:{p:1,borderRadius:1,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,b.jsxs)(k.default,{children:[(0,b.jsxs)(l.default,{sx:{fontWeight:800},children:[a.label," ",(0,b.jsx)(k.default,{component:"span",sx:{fontWeight:400,color:"text.secondary",ml:1},children:a.time})]}),c.length>0?(0,b.jsx)(k.default,{sx:{mt:1},children:c.map(a=>{let c=_[a.groupId];return(0,b.jsxs)(k.default,{sx:{mt:1},children:[(0,b.jsx)(o,{color:"#2563eb",children:c?c.name:`Group ${a.groupId}`}),(0,b.jsxs)(k.default,{sx:{mt:.5,color:"text.primary"},children:[(c?.members||[]).slice(0,5).map(a=>{let c=aa[a]||{name:a};return(0,b.jsx)(l.default,{sx:{fontSize:13},children:c.name||c.nipp||a},a)}),c?.members&&c.members.length>5&&(0,b.jsxs)(l.default,{sx:{fontSize:12,color:"text.secondary"},children:["+",c.members.length-5," more"]})]})]},a.id)})}):(0,b.jsx)(l.default,{sx:{mt:1,color:"text.secondary"},children:"Not assigned"})]}),(0,b.jsx)(k.default,{sx:{textAlign:"right"},children:c.map(a=>(0,b.jsxs)(k.default,{sx:{mb:1},children:[(0,b.jsx)(l.default,{sx:{fontSize:13,color:"text.secondary"},children:`assigned by ${a.created_by||"—"}`}),(0,b.jsx)(k.default,{sx:{mt:1},children:(0,b.jsx)(e.Button,{variant:"outlined",size:"small",color:"error",onClick:async()=>{if(confirm("Remove assignment?"))try{await (0,d.default)(`/shift-assignments/${a.id}`,{method:"DELETE"}),await O(),alert("Removed")}catch(a){console.error(a),alert("Failed")}},children:"Remove"})})]},a.id))})]},a.id)})})]})]})}function q(){return(0,b.jsxs)("div",{style:{padding:20,fontFamily:'Inter, system-ui, -apple-system, Roboto, "Helvetica Neue", Arial'},children:[(0,b.jsx)("h1",{style:{marginTop:0},children:"Shift Management"}),(0,b.jsx)("p",{style:{color:"#555"},children:"Create technician groups and assign them to daily shifts per site."}),(0,b.jsx)(p,{})]})}a.s(["default",()=>q],48338)}];

//# sourceMappingURL=web_app_shifts_page_jsx_fa5b5d6e._.js.map