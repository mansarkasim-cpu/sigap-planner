module.exports=[7897,(a,b,c)=>{"use strict";var d=a.r(62817);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var e=d(a.r(79626)),f=a.r(56856);c.default=(0,e.default)((0,f.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"}),"Save")},17313,(a,b,c)=>{"use strict";var d=a.r(62817);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var e=d(a.r(79626)),f=a.r(56856);c.default=(0,e.default)((0,f.jsx)("path",{d:"M11 21h-1l1-7H7.5c-.58 0-.57-.32-.38-.66.19-.34.05-.08.07-.12C8.48 10.94 10.42 7.54 13 3h1l-1 7h3.5c.49 0 .56.33.47.51l-.07.15C12.96 17.55 11 21 11 21z"}),"Bolt")},11637,a=>{"use strict";var b,c,d=a.i(56856),e=a.i(55132),f=a.i(59165),g=a.i(8810),h=a.i(56742),i=a.i(6021),i=i,j=a.i(89622),k=a.i(25946),k=k,l=a.i(29478),l=l,m=a.i(7897),n=a.i(17313);function o({onCreated:a}){let[b,c]=(0,e.useState)(""),[o,p]=(0,e.useState)(!1),[q,r]=(0,e.useState)(null);async function s(d){if(d.preventDefault(),r(null),!b.trim())return r("Masukkan id SIGAP");p(!0);try{let d=await (0,f.default)("/work-orders/add",{method:"POST",body:{id:b.trim()}});r("Work order tersimpan: "+(d?.data?.doc_no||d?.data?.id||"OK")),c(""),a?.()}catch(a){console.error("add error",a),r("Error: "+(a.body?.detail||a.body?.message||a.message||"gagal"))}finally{p(!1)}}return(0,d.jsx)(j.Paper,{elevation:2,sx:{p:2,mb:2},children:(0,d.jsx)("form",{onSubmit:s,children:(0,d.jsxs)(i.default,{direction:"row",spacing:2,alignItems:"center",children:[(0,d.jsx)(g.TextField,{value:b,onChange:a=>c(a.target.value),placeholder:"Masukkan id SIGAP (contoh: 1656)",disabled:o,size:"small",variant:"outlined",sx:{minWidth:320},InputProps:{startAdornment:(0,d.jsx)(l.default,{position:"start",children:(0,d.jsx)(n.default,{color:"primary"})})}}),(0,d.jsx)(h.Button,{type:"submit",variant:"contained",color:"primary",startIcon:(0,d.jsx)(m.default,{}),disabled:o,sx:{whiteSpace:"nowrap"},children:o?"Mengambil...":"Ambil & Simpan"}),q&&(0,d.jsx)(k.default,{severity:q.startsWith("Error")?"error":"success",sx:{ml:1},children:q})]})})})}var p=a.i(62205),q=a.i(9098),r=a.i(13874),s=a.i(41414),t=a.i(19916),u=a.i(70219),v=a.i(49945),w=a.i(30922),x=a.i(59178),y=a.i(17449),z=a.i(24645);function A(a){return void 0!==a.normalize?a.normalize("NFD").replace(/[\u0300-\u036f]/g,""):a}function B(a,b){for(let c=0;c<a.length;c+=1)if(b(a[c]))return c;return -1}let C=function(a={}){let{ignoreAccents:b=!0,ignoreCase:c=!0,limit:d,matchFrom:e="any",stringify:f,trim:g=!1}=a;return(a,{inputValue:h,getOptionLabel:i})=>{let j=g?h.trim():h;c&&(j=j.toLowerCase()),b&&(j=A(j));let k=j?a.filter(a=>{let d=(f||i)(a);return c&&(d=d.toLowerCase()),b&&(d=A(d)),"start"===e?0===d.indexOf(j):d.indexOf(j)>-1}):a;return"number"==typeof d?k.slice(0,d):k}}(),D=a=>{var b;return null!==a.current&&(null==(b=a.current.parentElement)?void 0:b.contains(document.activeElement))};var E=a.i(30092),F=a.i(51898),G=a.i(45481),H=a.i(52283),I=a.i(50997),J=a.i(11510),K=a.i(14220);function L(a){return(0,K.default)("MuiListSubheader",a)}(0,J.default)("MuiListSubheader",["root","colorPrimary","colorInherit","gutters","inset","sticky"]);let M=["className","color","component","disableGutters","disableSticky","inset"],N=(0,G.default)("li",{name:"MuiListSubheader",slot:"Root",overridesResolver:(a,b)=>{let{ownerState:c}=a;return[b.root,"default"!==c.color&&b[`color${(0,I.default)(c.color)}`],!c.disableGutters&&b.gutters,c.inset&&b.inset,!c.disableSticky&&b.sticky]}})(({theme:a,ownerState:b})=>(0,t.default)({boxSizing:"border-box",lineHeight:"48px",listStyle:"none",color:(a.vars||a).palette.text.secondary,fontFamily:a.typography.fontFamily,fontWeight:a.typography.fontWeightMedium,fontSize:a.typography.pxToRem(14)},"primary"===b.color&&{color:(a.vars||a).palette.primary.main},"inherit"===b.color&&{color:"inherit"},!b.disableGutters&&{paddingLeft:16,paddingRight:16},b.inset&&{paddingLeft:72},!b.disableSticky&&{position:"sticky",top:0,zIndex:1,backgroundColor:(a.vars||a).palette.background.paper})),O=e.forwardRef(function(a,b){let c=(0,H.default)({props:a,name:"MuiListSubheader"}),{className:e,color:f="default",component:g="li",disableGutters:h=!1,disableSticky:i=!1,inset:j=!1}=c,k=(0,s.default)(c,M),l=(0,t.default)({},c,{color:f,component:g,disableGutters:h,disableSticky:i,inset:j}),m=(a=>{let{classes:b,color:c,disableGutters:d,inset:e,disableSticky:f}=a,g={root:["root","default"!==c&&`color${(0,I.default)(c)}`,!d&&"gutters",e&&"inset",!f&&"sticky"]};return(0,v.unstable_composeClasses)(g,L,b)})(l);return(0,d.jsx)(N,(0,t.default)({as:g,className:(0,u.default)(m.root,e),ref:b,ownerState:l},k))});O.muiSkipListHighlight=!0;var P=a.i(89280),Q=a.i(28683),R=a.i(83882),S=a.i(91350),T=a.i(49205),U=a.i(15199),V=a.i(32072),W=a.i(25967);function X(a){return(0,K.default)("MuiAutocomplete",a)}let Y=(0,a.i(55980).unstable_generateUtilityClasses)("MuiAutocomplete",["root","expanded","fullWidth","focused","focusVisible","tag","tagSizeSmall","tagSizeMedium","hasPopupIcon","hasClearIcon","inputRoot","input","inputFocused","endAdornment","clearIndicator","popupIndicator","popupIndicatorOpen","popper","popperDisablePortal","paper","listbox","loading","noOptions","option","groupLabel","groupUl"]);var Z=a.i(58988);let $=["autoComplete","autoHighlight","autoSelect","blurOnSelect","ChipProps","className","clearIcon","clearOnBlur","clearOnEscape","clearText","closeText","componentsProps","defaultValue","disableClearable","disableCloseOnSelect","disabled","disabledItemsFocusable","disableListWrap","disablePortal","filterOptions","filterSelectedOptions","forcePopupIcon","freeSolo","fullWidth","getLimitTagsText","getOptionDisabled","getOptionLabel","isOptionEqualToValue","groupBy","handleHomeEndKeys","id","includeInputInList","inputValue","limitTags","ListboxComponent","ListboxProps","loading","loadingText","multiple","noOptionsText","onChange","onClose","onHighlightChange","onInputChange","onOpen","open","openOnFocus","openText","options","PaperComponent","PopperComponent","popupIcon","readOnly","renderGroup","renderInput","renderOption","renderTags","selectOnFocus","size","slotProps","value"],_=["ref"],aa=(0,G.default)("div",{name:"MuiAutocomplete",slot:"Root",overridesResolver:(a,b)=>{let{ownerState:c}=a,{fullWidth:d,hasClearIcon:e,hasPopupIcon:f,inputFocused:g,size:h}=c;return[{[`& .${Y.tag}`]:b.tag},{[`& .${Y.tag}`]:b[`tagSize${(0,I.default)(h)}`]},{[`& .${Y.inputRoot}`]:b.inputRoot},{[`& .${Y.input}`]:b.input},{[`& .${Y.input}`]:g&&b.inputFocused},b.root,d&&b.fullWidth,f&&b.hasPopupIcon,e&&b.hasClearIcon]}})(({ownerState:a})=>(0,t.default)({[`&.${Y.focused} .${Y.clearIndicator}`]:{visibility:"visible"},"@media (pointer: fine)":{[`&:hover .${Y.clearIndicator}`]:{visibility:"visible"}}},a.fullWidth&&{width:"100%"},{[`& .${Y.tag}`]:(0,t.default)({margin:3,maxWidth:"calc(100% - 6px)"},"small"===a.size&&{margin:2,maxWidth:"calc(100% - 4px)"}),[`& .${Y.inputRoot}`]:{flexWrap:"wrap",[`.${Y.hasPopupIcon}&, .${Y.hasClearIcon}&`]:{paddingRight:30},[`.${Y.hasPopupIcon}.${Y.hasClearIcon}&`]:{paddingRight:56},[`& .${Y.input}`]:{width:0,minWidth:30}},[`& .${R.default.root}`]:{paddingBottom:1,"& .MuiInput-input":{padding:"4px 4px 4px 0px"}},[`& .${R.default.root}.${S.default.sizeSmall}`]:{[`& .${R.default.input}`]:{padding:"2px 4px 3px 0"}},[`& .${T.default.root}`]:{padding:9,[`.${Y.hasPopupIcon}&, .${Y.hasClearIcon}&`]:{paddingRight:39},[`.${Y.hasPopupIcon}.${Y.hasClearIcon}&`]:{paddingRight:65},[`& .${Y.input}`]:{padding:"7.5px 4px 7.5px 5px"},[`& .${Y.endAdornment}`]:{right:9}},[`& .${T.default.root}.${S.default.sizeSmall}`]:{paddingTop:6,paddingBottom:6,paddingLeft:6,[`& .${Y.input}`]:{padding:"2.5px 4px 2.5px 8px"}},[`& .${U.default.root}`]:{paddingTop:19,paddingLeft:8,[`.${Y.hasPopupIcon}&, .${Y.hasClearIcon}&`]:{paddingRight:39},[`.${Y.hasPopupIcon}.${Y.hasClearIcon}&`]:{paddingRight:65},[`& .${U.default.input}`]:{padding:"7px 4px"},[`& .${Y.endAdornment}`]:{right:9}},[`& .${U.default.root}.${S.default.sizeSmall}`]:{paddingBottom:1,[`& .${U.default.input}`]:{padding:"2.5px 4px"}},[`& .${S.default.hiddenLabel}`]:{paddingTop:8},[`& .${U.default.root}.${S.default.hiddenLabel}`]:{paddingTop:0,paddingBottom:0,[`& .${Y.input}`]:{paddingTop:16,paddingBottom:17}},[`& .${U.default.root}.${S.default.hiddenLabel}.${S.default.sizeSmall}`]:{[`& .${Y.input}`]:{paddingTop:8,paddingBottom:9}},[`& .${Y.input}`]:(0,t.default)({flexGrow:1,textOverflow:"ellipsis",opacity:0},a.inputFocused&&{opacity:1})})),ab=(0,G.default)("div",{name:"MuiAutocomplete",slot:"EndAdornment",overridesResolver:(a,b)=>b.endAdornment})({position:"absolute",right:0,top:"calc(50% - 14px)"}),ac=(0,G.default)(P.default,{name:"MuiAutocomplete",slot:"ClearIndicator",overridesResolver:(a,b)=>b.clearIndicator})({marginRight:-2,padding:4,visibility:"hidden"}),ad=(0,G.default)(P.default,{name:"MuiAutocomplete",slot:"PopupIndicator",overridesResolver:({ownerState:a},b)=>(0,t.default)({},b.popupIndicator,a.popupOpen&&b.popupIndicatorOpen)})(({ownerState:a})=>(0,t.default)({padding:2,marginRight:-2},a.popupOpen&&{transform:"rotate(180deg)"})),ae=(0,G.default)(F.default,{name:"MuiAutocomplete",slot:"Popper",overridesResolver:(a,b)=>{let{ownerState:c}=a;return[{[`& .${Y.option}`]:b.option},b.popper,c.disablePortal&&b.popperDisablePortal]}})(({theme:a,ownerState:b})=>(0,t.default)({zIndex:(a.vars||a).zIndex.modal},b.disablePortal&&{position:"absolute"})),af=(0,G.default)(q.default,{name:"MuiAutocomplete",slot:"Paper",overridesResolver:(a,b)=>b.paper})(({theme:a})=>(0,t.default)({},a.typography.body1,{overflow:"auto"})),ag=(0,G.default)("div",{name:"MuiAutocomplete",slot:"Loading",overridesResolver:(a,b)=>b.loading})(({theme:a})=>({color:(a.vars||a).palette.text.secondary,padding:"14px 16px"})),ah=(0,G.default)("div",{name:"MuiAutocomplete",slot:"NoOptions",overridesResolver:(a,b)=>b.noOptions})(({theme:a})=>({color:(a.vars||a).palette.text.secondary,padding:"14px 16px"})),ai=(0,G.default)("div",{name:"MuiAutocomplete",slot:"Listbox",overridesResolver:(a,b)=>b.listbox})(({theme:a})=>({listStyle:"none",margin:0,padding:"8px 0",maxHeight:"40vh",overflow:"auto",position:"relative",[`& .${Y.option}`]:{minHeight:48,display:"flex",overflow:"hidden",justifyContent:"flex-start",alignItems:"center",cursor:"pointer",paddingTop:6,boxSizing:"border-box",outline:"0",WebkitTapHighlightColor:"transparent",paddingBottom:6,paddingLeft:16,paddingRight:16,[a.breakpoints.up("sm")]:{minHeight:"auto"},[`&.${Y.focused}`]:{backgroundColor:(a.vars||a).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},'&[aria-disabled="true"]':{opacity:(a.vars||a).palette.action.disabledOpacity,pointerEvents:"none"},[`&.${Y.focusVisible}`]:{backgroundColor:(a.vars||a).palette.action.focus},'&[aria-selected="true"]':{backgroundColor:a.vars?`rgba(${a.vars.palette.primary.mainChannel} / ${a.vars.palette.action.selectedOpacity})`:(0,E.alpha)(a.palette.primary.main,a.palette.action.selectedOpacity),[`&.${Y.focused}`]:{backgroundColor:a.vars?`rgba(${a.vars.palette.primary.mainChannel} / calc(${a.vars.palette.action.selectedOpacity} + ${a.vars.palette.action.hoverOpacity}))`:(0,E.alpha)(a.palette.primary.main,a.palette.action.selectedOpacity+a.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:(a.vars||a).palette.action.selected}},[`&.${Y.focusVisible}`]:{backgroundColor:a.vars?`rgba(${a.vars.palette.primary.mainChannel} / calc(${a.vars.palette.action.selectedOpacity} + ${a.vars.palette.action.focusOpacity}))`:(0,E.alpha)(a.palette.primary.main,a.palette.action.selectedOpacity+a.palette.action.focusOpacity)}}}})),aj=(0,G.default)(O,{name:"MuiAutocomplete",slot:"GroupLabel",overridesResolver:(a,b)=>b.groupLabel})(({theme:a})=>({backgroundColor:(a.vars||a).palette.background.paper,top:-8})),ak=(0,G.default)("ul",{name:"MuiAutocomplete",slot:"GroupUl",overridesResolver:(a,b)=>b.groupUl})({padding:0,[`& .${Y.option}`]:{paddingLeft:24}}),al=e.forwardRef(function(a,f){var g,h,i,j;let k,l=(0,H.default)({props:a,name:"MuiAutocomplete"}),{autoComplete:m=!1,autoHighlight:n=!1,autoSelect:o=!1,blurOnSelect:p=!1,ChipProps:r,className:A,clearIcon:E=b||(b=(0,d.jsx)(V.default,{fontSize:"small"})),clearOnBlur:G=!l.freeSolo,clearOnEscape:J=!1,clearText:K="Clear",closeText:L="Close",componentsProps:M={},defaultValue:N=l.multiple?[]:null,disableClearable:O=!1,disableCloseOnSelect:P=!1,disabled:R=!1,disabledItemsFocusable:S=!1,disableListWrap:T=!1,disablePortal:U=!1,filterSelectedOptions:Y=!1,forcePopupIcon:al="auto",freeSolo:am=!1,fullWidth:an=!1,getLimitTagsText:ao=a=>`+${a}`,getOptionLabel:ap,groupBy:aq,handleHomeEndKeys:ar=!l.freeSolo,includeInputInList:as=!1,limitTags:at=-1,ListboxComponent:au="ul",ListboxProps:av,loading:aw=!1,loadingText:ax="Loading…",multiple:ay=!1,noOptionsText:az="No options",openOnFocus:aA=!1,openText:aB="Open",PaperComponent:aC=q.default,PopperComponent:aD=F.default,popupIcon:aE=c||(c=(0,d.jsx)(W.default,{})),readOnly:aF=!1,renderGroup:aG,renderInput:aH,renderOption:aI,renderTags:aJ,selectOnFocus:aK=!l.freeSolo,size:aL="medium",slotProps:aM={}}=l,aN=(0,s.default)(l,$),{getRootProps:aO,getInputProps:aP,getInputLabelProps:aQ,getPopupIndicatorProps:aR,getClearProps:aS,getTagProps:aT,getListboxProps:aU,getOptionProps:aV,value:aW,dirty:aX,expanded:aY,id:aZ,popupOpen:a$,focused:a_,focusedTag:a0,anchorEl:a1,setAnchorEl:a2,inputValue:a3,groupedOptions:a4}=function(a){var b;let c,{unstable_isActiveElementInListbox:d=D,unstable_classNamePrefix:f="Mui",autoComplete:g=!1,autoHighlight:h=!1,autoSelect:i=!1,blurOnSelect:j=!1,clearOnBlur:k=!a.freeSolo,clearOnEscape:l=!1,componentName:m="useAutocomplete",defaultValue:n=a.multiple?[]:null,disableClearable:o=!1,disableCloseOnSelect:p=!1,disabled:q,disabledItemsFocusable:r=!1,disableListWrap:s=!1,filterOptions:u=C,filterSelectedOptions:v=!1,freeSolo:A=!1,getOptionDisabled:E,getOptionLabel:F=a=>{var b;return null!=(b=a.label)?b:a},groupBy:G,handleHomeEndKeys:H=!a.freeSolo,id:I,includeInputInList:J=!1,inputValue:K,isOptionEqualToValue:L=(a,b)=>a===b,multiple:M=!1,onChange:N,onClose:O,onHighlightChange:P,onInputChange:Q,onOpen:R,open:S,openOnFocus:T=!1,options:U,readOnly:V=!1,selectOnFocus:W=!a.freeSolo,value:X}=a,Y=(0,z.unstable_useId)(I),Z=F;Z=a=>{let b=F(a);return"string"!=typeof b?String(b):b};let $=e.useRef(!1),_=e.useRef(!0),aa=e.useRef(null),ab=e.useRef(null),[ac,ad]=e.useState(null),[ae,af]=e.useState(-1),ag=h?0:-1,ah=e.useRef(ag),[ai,aj]=(0,y.unstable_useControlled)({controlled:X,default:n,name:m}),[ak,al]=(0,y.unstable_useControlled)({controlled:K,default:"",name:m,state:"inputValue"}),[am,an]=e.useState(!1),ao=e.useCallback((a,b)=>{let c;if((M?ai.length<b.length:null!==b)||k){if(M)c="";else if(null==b)c="";else{let a=Z(b);c="string"==typeof a?a:""}ak!==c&&(al(c),Q&&Q(a,c,"reset"))}},[Z,ak,M,Q,al,k,ai]),[ap,aq]=(0,y.unstable_useControlled)({controlled:S,default:!1,name:m,state:"open"}),[ar,as]=e.useState(!0),at=!M&&null!=ai&&ak===Z(ai),au=ap&&!V,av=au?u(U.filter(a=>!(v&&(M?ai:[ai]).some(b=>null!==b&&L(a,b)))),{inputValue:at&&ar?"":ak,getOptionLabel:Z}):[],aw=(b={filteredOptions:av,value:ai,inputValue:ak},c=e.useRef({}),e.useEffect(()=>{c.current=b}),c.current);e.useEffect(()=>{let a=ai!==aw.value;am&&!a||(!A||a)&&ao(null,ai)},[ai,ao,am,aw.value,A]);let ax=ap&&av.length>0&&!V,ay=(0,x.unstable_useEventCallback)(a=>{-1===a?aa.current.focus():ac.querySelector(`[data-tag-index="${a}"]`).focus()});e.useEffect(()=>{M&&ae>ai.length-1&&(af(-1),ay(-1))},[ai,M,ae,ay]);let az=(0,x.unstable_useEventCallback)(({event:a,index:b,reason:c="auto"})=>{if(ah.current=b,-1===b?aa.current.removeAttribute("aria-activedescendant"):aa.current.setAttribute("aria-activedescendant",`${Y}-option-${b}`),P&&P(a,-1===b?null:av[b],c),!ab.current)return;let d=ab.current.querySelector(`[role="option"].${f}-focused`);d&&(d.classList.remove(`${f}-focused`),d.classList.remove(`${f}-focusVisible`));let e=ab.current;if("listbox"!==ab.current.getAttribute("role")&&(e=ab.current.parentElement.querySelector('[role="listbox"]')),!e)return;if(-1===b){e.scrollTop=0;return}let g=ab.current.querySelector(`[data-option-index="${b}"]`);if(g&&(g.classList.add(`${f}-focused`),"keyboard"===c&&g.classList.add(`${f}-focusVisible`),e.scrollHeight>e.clientHeight&&"mouse"!==c&&"touch"!==c)){let a=e.clientHeight+e.scrollTop,b=g.offsetTop+g.offsetHeight;b>a?e.scrollTop=b-e.clientHeight:g.offsetTop-g.offsetHeight*(1.3*!!G)<e.scrollTop&&(e.scrollTop=g.offsetTop-g.offsetHeight*(1.3*!!G))}}),aA=(0,x.unstable_useEventCallback)(({event:a,diff:b,direction:c="next",reason:d="auto"})=>{if(!au)return;let e=function(a,b){if(!ab.current||-1===a)return -1;let c=a;for(;;){if("next"===b&&c===av.length||"previous"===b&&-1===c)return -1;let a=ab.current.querySelector(`[data-option-index="${c}"]`),d=!r&&(!a||a.disabled||"true"===a.getAttribute("aria-disabled"));if((!a||a.hasAttribute("tabindex"))&&!d)return c;c+="next"===b?1:-1}}((()=>{let a=av.length-1;if("reset"===b)return ag;if("start"===b)return 0;if("end"===b)return a;let c=ah.current+b;return c<0?-1===c&&J?-1:s&&-1!==ah.current||Math.abs(b)>1?0:a:c>a?c===a+1&&J?-1:s||Math.abs(b)>1?a:0:c})(),c);if(az({index:e,reason:d,event:a}),g&&"reset"!==b)if(-1===e)aa.current.value=ak;else{let a=Z(av[e]);aa.current.value=a,0===a.toLowerCase().indexOf(ak.toLowerCase())&&ak.length>0&&aa.current.setSelectionRange(ak.length,a.length)}}),aB=e.useCallback(()=>{if(!au||(()=>{var a;if(-1!==ah.current&&aw.filteredOptions&&aw.filteredOptions.length!==av.length&&aw.inputValue===ak&&(M?ai.length===aw.value.length&&aw.value.every((a,b)=>Z(ai[b])===Z(a)):(a=aw.value,(a?Z(a):"")===(ai?Z(ai):"")))){let a=aw.filteredOptions[ah.current];if(a&&av.some(b=>Z(b)===Z(a)))return!0}return!1})())return;let a=M?ai[0]:ai;if(0===av.length||null==a)return void aA({diff:"reset"});if(ab.current){if(null!=a){let b=av[ah.current];if(M&&b&&-1!==B(ai,a=>L(b,a)))return;let c=B(av,b=>L(b,a));-1===c?aA({diff:"reset"}):az({index:c});return}if(ah.current>=av.length-1)return void az({index:av.length-1});az({index:ah.current})}},[av.length,!M&&ai,v,aA,az,au,ak,M]),aC=(0,x.unstable_useEventCallback)(a=>{(0,w.unstable_setRef)(ab,a),a&&aB()});e.useEffect(()=>{aB()},[aB]);let aD=a=>{!ap&&(aq(!0),as(!0),R&&R(a))},aE=(a,b)=>{ap&&(aq(!1),O&&O(a,b))},aF=(a,b,c,d)=>{if(M){if(ai.length===b.length&&ai.every((a,c)=>a===b[c]))return}else if(ai===b)return;N&&N(a,b,c,d),aj(b)},aG=e.useRef(!1),aH=(a,b,c="selectOption",d="options")=>{let e=c,f=b;if(M){let a=B(f=Array.isArray(ai)?ai.slice():[],a=>L(b,a));-1===a?f.push(b):"freeSolo"!==d&&(f.splice(a,1),e="removeOption")}ao(a,f),aF(a,f,e,{option:b}),p||a&&(a.ctrlKey||a.metaKey)||aE(a,e),(!0===j||"touch"===j&&aG.current||"mouse"===j&&!aG.current)&&aa.current.blur()},aI=(a,b)=>{if(!M)return;""===ak&&aE(a,"toggleInput");let c=ae;-1===ae?""===ak&&"previous"===b&&(c=ai.length-1):((c+="next"===b?1:-1)<0&&(c=0),c===ai.length&&(c=-1)),af(c=function(a,b){if(-1===a)return -1;let c=a;for(;;){if("next"===b&&c===ai.length||"previous"===b&&-1===c)return -1;let a=ac.querySelector(`[data-tag-index="${c}"]`);if(a&&a.hasAttribute("tabindex")&&!a.disabled&&"true"!==a.getAttribute("aria-disabled"))return c;c+="next"===b?1:-1}}(c,b)),ay(c)},aJ=a=>{$.current=!0,al(""),Q&&Q(a,"","clear"),aF(a,M?[]:null,"clear")},aK=a=>{an(!0),T&&!$.current&&aD(a)},aL=a=>{d(ab)?aa.current.focus():(an(!1),_.current=!0,$.current=!1,i&&-1!==ah.current&&au?aH(a,av[ah.current],"blur"):i&&A&&""!==ak?aH(a,ak,"blur","freeSolo"):k&&ao(a,ai),aE(a,"blur"))},aM=a=>{let b=a.target.value;ak!==b&&(al(b),as(!1),Q&&Q(a,b,"input")),""===b?o||M||aF(a,null,"clear"):aD(a)},aN=a=>{let b=Number(a.currentTarget.getAttribute("data-option-index"));ah.current!==b&&az({event:a,index:b,reason:"mouse"})},aO=a=>{az({event:a,index:Number(a.currentTarget.getAttribute("data-option-index")),reason:"touch"}),aG.current=!0},aP=a=>{let b=Number(a.currentTarget.getAttribute("data-option-index"));aH(a,av[b],"selectOption"),aG.current=!1},aQ=a=>{ap?aE(a,"toggleInput"):aD(a)},aR=a=>{a.currentTarget.contains(a.target)&&a.target.getAttribute("id")!==Y&&a.preventDefault()},aS=a=>{a.currentTarget.contains(a.target)&&(aa.current.focus(),W&&_.current&&aa.current.selectionEnd-aa.current.selectionStart==0&&aa.current.select(),_.current=!1)},aT=a=>{q||""!==ak&&ap||aQ(a)},aU=A&&ak.length>0;aU=aU||(M?ai.length>0:null!==ai);let aV=av;return G&&(aV=av.reduce((a,b,c)=>{let d=G(b);return a.length>0&&a[a.length-1].group===d?a[a.length-1].options.push(b):a.push({key:c,index:c,group:d,options:[b]}),a},[])),q&&am&&aL(),{getRootProps:(a={})=>(0,t.default)({"aria-owns":ax?`${Y}-listbox`:null},a,{onKeyDown:b=>{if(a.onKeyDown&&a.onKeyDown(b),!b.defaultMuiPrevented&&(-1!==ae&&-1===["ArrowLeft","ArrowRight"].indexOf(b.key)&&(af(-1),ay(-1)),229!==b.which))switch(b.key){case"Home":au&&H&&(b.preventDefault(),aA({diff:"start",direction:"next",reason:"keyboard",event:b}));break;case"End":au&&H&&(b.preventDefault(),aA({diff:"end",direction:"previous",reason:"keyboard",event:b}));break;case"PageUp":b.preventDefault(),aA({diff:-5,direction:"previous",reason:"keyboard",event:b}),aD(b);break;case"PageDown":b.preventDefault(),aA({diff:5,direction:"next",reason:"keyboard",event:b}),aD(b);break;case"ArrowDown":b.preventDefault(),aA({diff:1,direction:"next",reason:"keyboard",event:b}),aD(b);break;case"ArrowUp":b.preventDefault(),aA({diff:-1,direction:"previous",reason:"keyboard",event:b}),aD(b);break;case"ArrowLeft":aI(b,"previous");break;case"ArrowRight":aI(b,"next");break;case"Enter":if(-1!==ah.current&&au){let a=av[ah.current],c=!!E&&E(a);if(b.preventDefault(),c)return;aH(b,a,"selectOption"),g&&aa.current.setSelectionRange(aa.current.value.length,aa.current.value.length)}else A&&""!==ak&&!1===at&&(M&&b.preventDefault(),aH(b,ak,"createOption","freeSolo"));break;case"Escape":au?(b.preventDefault(),b.stopPropagation(),aE(b,"escape")):l&&(""!==ak||M&&ai.length>0)&&(b.preventDefault(),b.stopPropagation(),aJ(b));break;case"Backspace":if(M&&!V&&""===ak&&ai.length>0){let a=-1===ae?ai.length-1:ae,c=ai.slice();c.splice(a,1),aF(b,c,"removeOption",{option:ai[a]})}break;case"Delete":if(M&&!V&&""===ak&&ai.length>0&&-1!==ae){let a=ai.slice();a.splice(ae,1),aF(b,a,"removeOption",{option:ai[ae]})}}},onMouseDown:aR,onClick:aS}),getInputLabelProps:()=>({id:`${Y}-label`,htmlFor:Y}),getInputProps:()=>({id:Y,value:ak,onBlur:aL,onFocus:aK,onChange:aM,onMouseDown:aT,"aria-activedescendant":au?"":null,"aria-autocomplete":g?"both":"list","aria-controls":ax?`${Y}-listbox`:void 0,"aria-expanded":ax,autoComplete:"off",ref:aa,autoCapitalize:"none",spellCheck:"false",role:"combobox",disabled:q}),getClearProps:()=>({tabIndex:-1,onClick:aJ}),getPopupIndicatorProps:()=>({tabIndex:-1,onClick:aQ}),getTagProps:({index:a})=>(0,t.default)({key:a,"data-tag-index":a,tabIndex:-1},!V&&{onDelete:b=>{let c=ai.slice();c.splice(a,1),aF(b,c,"removeOption",{option:ai[a]})}}),getListboxProps:()=>({role:"listbox",id:`${Y}-listbox`,"aria-labelledby":`${Y}-label`,ref:aC,onMouseDown:a=>{a.preventDefault()}}),getOptionProps:({index:a,option:b})=>{let c=(M?ai:[ai]).some(a=>null!=a&&L(b,a)),d=!!E&&E(b);return{key:Z(b),tabIndex:-1,role:"option",id:`${Y}-option-${a}`,onMouseMove:aN,onClick:aP,onTouchStart:aO,"data-option-index":a,"aria-disabled":d,"aria-selected":c}},id:Y,inputValue:ak,value:ai,dirty:aU,expanded:au&&ac,popupOpen:au,focused:am||-1!==ae,anchorEl:ac,setAnchorEl:ad,focusedTag:ae,groupedOptions:aV}}((0,t.default)({},l,{componentName:"Autocomplete"})),a5=!O&&!R&&aX&&!aF,a6=(!am||!0===al)&&!1!==al,{onMouseDown:a7}=aP(),{ref:a8}=null!=av?av:{},a9=aU(),{ref:ba}=a9,bb=(0,s.default)(a9,_),bc=(0,Z.default)(ba,a8),bd=ap||(a=>{var b;return null!=(b=a.label)?b:a}),be=(0,t.default)({},l,{disablePortal:U,expanded:aY,focused:a_,fullWidth:an,getOptionLabel:bd,hasClearIcon:a5,hasPopupIcon:a6,inputFocused:-1===a0,popupOpen:a$,size:aL}),bf=(a=>{let{classes:b,disablePortal:c,expanded:d,focused:e,fullWidth:f,hasClearIcon:g,hasPopupIcon:h,inputFocused:i,popupOpen:j,size:k}=a,l={root:["root",d&&"expanded",e&&"focused",f&&"fullWidth",g&&"hasClearIcon",h&&"hasPopupIcon"],inputRoot:["inputRoot"],input:["input",i&&"inputFocused"],tag:["tag",`tagSize${(0,I.default)(k)}`],endAdornment:["endAdornment"],clearIndicator:["clearIndicator"],popupIndicator:["popupIndicator",j&&"popupIndicatorOpen"],popper:["popper",c&&"popperDisablePortal"],paper:["paper"],listbox:["listbox"],loading:["loading"],noOptions:["noOptions"],option:["option"],groupLabel:["groupLabel"],groupUl:["groupUl"]};return(0,v.unstable_composeClasses)(l,X,b)})(be);if(ay&&aW.length>0){let a=a=>(0,t.default)({className:bf.tag,disabled:R},aT(a));k=aJ?aJ(aW,a,be):aW.map((b,c)=>(0,d.jsx)(Q.default,(0,t.default)({label:bd(b),size:aL},a({index:c}),r)))}if(at>-1&&Array.isArray(k)){let a=k.length-at;!a_&&a>0&&(k=k.splice(0,at)).push((0,d.jsx)("span",{className:bf.tag,children:ao(a)},k.length))}let bg=aG||(a=>(0,d.jsxs)("li",{children:[(0,d.jsx)(aj,{className:bf.groupLabel,ownerState:be,component:"div",children:a.group}),(0,d.jsx)(ak,{className:bf.groupUl,ownerState:be,children:a.children})]},a.key)),bh=aI||((a,b)=>(0,d.jsx)("li",(0,t.default)({},a,{children:bd(b)}))),bi=(a,b)=>{let c=aV({option:a,index:b});return bh((0,t.default)({},c,{className:bf.option}),a,{selected:c["aria-selected"],index:b,inputValue:a3},be)},bj=null!=(g=aM.clearIndicator)?g:M.clearIndicator,bk=null!=(h=aM.paper)?h:M.paper,bl=null!=(i=aM.popper)?i:M.popper,bm=null!=(j=aM.popupIndicator)?j:M.popupIndicator;return(0,d.jsxs)(e.Fragment,{children:[(0,d.jsx)(aa,(0,t.default)({ref:f,className:(0,u.default)(bf.root,A),ownerState:be},aO(aN),{children:aH({id:aZ,disabled:R,fullWidth:!0,size:"small"===aL?"small":void 0,InputLabelProps:aQ(),InputProps:(0,t.default)({ref:a2,className:bf.inputRoot,startAdornment:k,onClick:a=>{a.target===a.currentTarget&&a7(a)}},(a5||a6)&&{endAdornment:(0,d.jsxs)(ab,{className:bf.endAdornment,ownerState:be,children:[a5?(0,d.jsx)(ac,(0,t.default)({},aS(),{"aria-label":K,title:K,ownerState:be},bj,{className:(0,u.default)(bf.clearIndicator,null==bj?void 0:bj.className),children:E})):null,a6?(0,d.jsx)(ad,(0,t.default)({},aR(),{disabled:R,"aria-label":a$?L:aB,title:a$?L:aB,ownerState:be},bm,{className:(0,u.default)(bf.popupIndicator,null==bm?void 0:bm.className),children:aE})):null]})}),inputProps:(0,t.default)({className:bf.input,disabled:R,readOnly:aF},aP())})})),a1?(0,d.jsx)(ae,(0,t.default)({as:aD,disablePortal:U,style:{width:a1?a1.clientWidth:null},ownerState:be,role:"presentation",anchorEl:a1,open:a$},bl,{className:(0,u.default)(bf.popper,null==bl?void 0:bl.className),children:(0,d.jsxs)(af,(0,t.default)({ownerState:be,as:aC},bk,{className:(0,u.default)(bf.paper,null==bk?void 0:bk.className),children:[aw&&0===a4.length?(0,d.jsx)(ag,{className:bf.loading,ownerState:be,children:ax}):null,0!==a4.length||am||aw?null:(0,d.jsx)(ah,{className:bf.noOptions,ownerState:be,role:"presentation",onMouseDown:a=>{a.preventDefault()},children:az}),a4.length>0?(0,d.jsx)(ai,(0,t.default)({as:au,className:bf.listbox,ownerState:be},bb,av,{ref:bc,children:a4.map((a,b)=>aq?bg({key:a.key,group:a.group,children:a.options.map((b,c)=>bi(b,a.index+c))}):bi(a,b))})):null]}))})):null]})});var am=a.i(13541),an=a.i(8607),ao=a.i(61981),ap=a.i(62104),aq=a.i(32775),ar=a.i(45117),as=a.i(11338),at=i,au=a.i(6771),av=a.i(55806),aw=a.i(34122),ax=a.i(3683),ay=a.i(48154),az=a.i(81777),aA=a.i(51287),aB=a.i(34491),aC=a.i(45389);function aD({onRefreshRequested:a}){function b(a){if(!a)return"-";let b=String(a).trim(),c=/^(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2})(?::(\d{2}))?)?$/.exec(b),d=a=>String(a).padStart(2,"0");if(c){let[,a,b,e,f="00",g="00"]=c;return`${d(Number(e))}/${d(Number(b))}/${a} ${d(Number(f))}:${d(Number(g))}`}let e=new Date(b);return isNaN(e.getTime())?"-":`${d(e.getDate())}/${d(e.getMonth()+1)}/${e.getFullYear()} ${d(e.getHours())}:${d(e.getMinutes())}`}function c(a){if(null==a)return"";let b=String(a).toString();return"NEW"===b.toUpperCase().trim()?"PREPARATION":b}let[g,h]=(0,e.useState)([]),[i,j]=(0,e.useState)(!1),[k,l]=(0,e.useState)(null),[m,n]=(0,e.useState)([]),[o,s]=(0,e.useState)(""),[t,u]=(0,e.useState)([]),[v,w]=(0,e.useState)([]),[x,y]=(0,e.useState)(1),[z]=(0,e.useState)(10),[A,B]=(0,e.useState)(0),[C,D]=(0,e.useState)(""),[E,F]=(0,e.useState)(null),[G,H]=(0,e.useState)(!1),[I,J]=(0,e.useState)(""),[K,L]=(0,e.useState)([]),[M,N]=(0,e.useState)({open:!1,wo:null}),[O,P]=(0,e.useState)([]),[R,S]=(0,e.useState)(""),[T,U]=(0,e.useState)({}),[V,W]=(0,e.useState)(void 0),[X,Y]=(0,e.useState)(""),[Z,$]=(0,e.useState)("");async function _(a=x,b=C,d=o){j(!0),l(null);try{let e=new URLSearchParams;b&&e.set("q",b),e.set("page",String(a)),e.set("pageSize",String(z)),d&&e.set("location",d);let g=await (0,f.default)(`/work-orders?${e.toString()}`),i=Array.isArray(g)?g:g?.data??[],j=g&&"object"==typeof g&&!Array.isArray(g)?g.meta??{page:a,pageSize:z,total:0}:{page:a,pageSize:z,total:0},k=Array.isArray(i)?i:[],l=Array.from(new Set(k.map(a=>(a.vendor_cabang??a.raw?.vendor_cabang??"").toString().trim()).filter(Boolean))),m=Array.from(new Set(k.map(a=>c(a.status??a.raw?.status??"PREPARATION").toString().trim()).filter(Boolean)));u(m),n(l);let o=k;if(console.debug("test ",k),d){let a=d.toString().toLowerCase().trim();o=k.filter(b=>(b.vendor_cabang??b.raw?.vendor_cabang??"").toString().toLowerCase().trim()===a)}if(v&&v.length>0){let a=new Set(v.map(a=>a.toString().toUpperCase().replace(/[-\s]/g,"_")));o=o.filter(b=>{let d=c(b.status??b.raw?.status??"PREPARATION").toString().toString().toUpperCase().replace(/[-\s]/g,"_");return a.has(d)})}v&&0!==v.length||(o=o.filter(a=>{let b=c(a.status??a.raw?.status??"PREPARATION").toString().toString().toUpperCase().replace(/[-\s]/g,"_");return"COMPLETED"!==b})),h(o),B("number"==typeof j.total?j.total:0)}catch(a){console.error("load work orders",a),l(a?.body?.message||a?.message||"Gagal memuat")}finally{j(!1)}}async function aa(a,b,c){H(!0);try{let d={};void 0!==b&&(d.start_date=b||null),void 0!==c&&(d.end_date=c||null),I&&I.trim().length&&(d.note=I.trim()),await (0,f.default)(`/work-orders/${encodeURIComponent(a)}`,{method:"PATCH",body:d}),_(x,C),F(null)}catch(a){console.error("save edit",a),alert("Gagal menyimpan: "+(a?.body?.message||a?.message))}finally{H(!1)}}function ab(a){if(!a)return"";let b=String(a).trim(),c=/^(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2})(?::(\d{2}))?)?$/.exec(b),d=a=>String(a).padStart(2,"0");if(c){let[,a,b,e,f="00",g="00"]=c;return`${a}-${b}-${e}T${d(Number(f))}:${d(Number(g))}`}let e=new Date(b);return isNaN(e.getTime())?"":`${e.getFullYear()}-${d(e.getMonth()+1)}-${d(e.getDate())}T${d(e.getHours())}:${d(e.getMinutes())}`}function ac(a){switch(c(a).toString().toUpperCase()){case"ASSIGNED":return"#1e40af";case"DEPLOYED":return"#db2777";case"READY_TO_DEPLOY":return"#7c3aed";case"IN_PROGRESS":case"IN-PROGRESS":return"#f97316";case"COMPLETED":return"#10b981";case"PREPARATION":case"OPEN":return"#64748b";case"CANCELLED":return"#ef4444";case"CLOSED":return"#334155";default:return"#6b7280"}}function ad(a){let b=(a?.status??a?.raw?.status??"").toString().toUpperCase().replace(/[-\s]/g,"_");return"IN_PROGRESS"!==b&&"COMPLETED"!==b}async function ae(a){try{await (0,f.default)(`/work-orders/${encodeURIComponent(a)}/deploy`,{method:"POST"});let b=await (0,f.default)(`/work-orders/${encodeURIComponent(a)}`),c=b?.data??b,d=await (0,f.default)(`/work-orders/${encodeURIComponent(a)}/tasks`),e=Array.isArray(d)?d:d?.data??[];N(a=>({...a||{},wo:{...a?.wo||{},...c,tasks:e}})),_(x,C)}catch(a){console.error("deploy failed",a),alert("Deploy gagal: "+(a?.message||a))}}async function af(a){try{await (0,f.default)(`/work-orders/${encodeURIComponent(a)}/undeploy`,{method:"POST"});let b=await (0,f.default)(`/work-orders/${encodeURIComponent(a)}`),c=b?.data??b,d=await (0,f.default)(`/work-orders/${encodeURIComponent(a)}/tasks`),e=Array.isArray(d)?d:d?.data??[];N(a=>({...a||{},wo:{...a?.wo||{},...c,tasks:e}})),_(x,C)}catch(a){console.error("undeploy failed",a),alert("Undeploy gagal: "+(a?.message||a))}}return(0,e.useEffect)(()=>{_(1,C),y(1)},[C,o,v]),(0,e.useEffect)(()=>{"function"==typeof a&&a(async()=>{await _(1,C,o),y(1)})},[]),(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{style:{display:"flex",gap:8,marginBottom:12,alignItems:"center"},children:[(0,d.jsxs)(p.default,{sx:{display:"flex",gap:2,flexWrap:"wrap",mb:2},children:[(0,d.jsxs)(am.default,{value:o,onChange:a=>s(String(a.target.value)),displayEmpty:!0,size:"small",sx:{minWidth:180},children:[(0,d.jsx)(an.default,{value:"",children:"Semua Lokasi"}),m.map(a=>(0,d.jsx)(an.default,{value:a,children:a},a))]}),(0,d.jsx)(am.default,{multiple:!0,displayEmpty:!0,size:"small",value:v,onChange:a=>w("string"==typeof a.target.value?a.target.value.split(","):a.target.value),renderValue:a=>a&&a.length>0?(0,d.jsx)(p.default,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:a.map(a=>(0,d.jsx)(Q.default,{label:a,size:"small"},a))}):"Semua Status",sx:{minWidth:220},children:["PREPARATION","ASSIGNED","READY TO DEPLOY","DEPLOYED","IN PROGRESS","COMPLETED"].map(a=>(0,d.jsxs)(an.default,{value:a,children:[(0,d.jsx)(aA.default,{checked:v.indexOf(a)>-1}),a]},a))}),(0,d.jsx)(r.default,{placeholder:"Search doc_no / asset / desc",value:C,onChange:a=>D(a.target.value),size:"small",sx:{flex:1,minWidth:240}}),(0,d.jsx)(ao.default,{variant:"contained",color:"primary",size:"small",onClick:()=>_(1,C),disabled:i,children:"Search"}),(0,d.jsx)(ao.default,{variant:"outlined",size:"small",onClick:()=>_(1,C),disabled:i,children:"Refresh"}),(0,d.jsxs)(p.default,{sx:{alignSelf:"center",ml:"auto",color:"text.secondary"},children:[A," item"]})]}),i?(0,d.jsx)(aC.default,{variant:"body2",children:"Loading..."}):null,k?(0,d.jsx)(aC.default,{variant:"body2",color:"error",children:k}):null]}),(0,d.jsxs)("div",{style:{overflowX:"auto"},children:[(0,d.jsx)(ax.default,{component:q.default,sx:{mb:2},children:(0,d.jsxs)(au.default,{size:"small",children:[(0,d.jsx)(ay.default,{children:(0,d.jsxs)(az.default,{children:[(0,d.jsx)(aw.default,{children:"Doc No"}),(0,d.jsx)(aw.default,{children:"Jenis Work Order"}),(0,d.jsx)(aw.default,{children:"Start"}),(0,d.jsx)(aw.default,{children:"End"}),(0,d.jsx)(aw.default,{children:"Equipment"}),(0,d.jsx)(aw.default,{children:"Status"}),(0,d.jsx)(aw.default,{children:"Location"}),(0,d.jsx)(aw.default,{children:"Description"}),(0,d.jsx)(aw.default,{children:"Progress"}),(0,d.jsx)(aw.default,{children:"Action"})]})}),(0,d.jsx)(av.default,{children:g.map(a=>{let e,g,h,i,j=a.raw?.activities??[],k=c(a.status??a.raw?.status??"PREPARATION").toString(),l=k.toUpperCase().replace(/[-\s]/g,"_");return(0,d.jsxs)(az.default,{hover:!0,children:[(0,d.jsx)(aw.default,{children:a.doc_no??a.id}),(0,d.jsx)(aw.default,{children:a.work_type??a.type_work??a.raw?.work_type??a.raw?.type_work??"-"}),(0,d.jsx)(aw.default,{children:b(a.start_date)}),(0,d.jsx)(aw.default,{children:b(a.end_date)}),(0,d.jsx)(aw.default,{children:a.asset_name??"-"}),(0,d.jsx)(aw.default,{children:(g=ac(e=c(a.status??a.raw?.status??"PREPARATION")),(0,d.jsx)("span",{style:{display:"inline-block",padding:"4px 8px",borderRadius:999,background:g,color:"white",fontSize:12,fontWeight:600},children:String(e).replace(/_/g," ")}))}),(0,d.jsx)(aw.default,{children:a.vendor_cabang??a.raw?.vendor_cabang??"-"}),(0,d.jsx)(aw.default,{sx:{maxWidth:220,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:a.description??"-"}),(0,d.jsx)(aw.default,{sx:{width:180},children:"IN_PROGRESS"===l&&"number"==typeof a.progress?(h=Math.max(0,Math.min(1,a.progress||0)),i=ac(k),(0,d.jsxs)(p.default,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[(0,d.jsxs)(aC.default,{variant:"caption",sx:{fontWeight:700},children:[Math.round(100*h),"%"]}),(0,d.jsx)(aB.default,{variant:"determinate",value:Math.round(100*h),sx:{height:8,borderRadius:2,backgroundColor:"#f1f5f9","& .MuiLinearProgress-bar":{background:i}}})]})):(0,d.jsx)(aC.default,{variant:"body2",color:"text.secondary",children:"-"})}),(0,d.jsx)(aw.default,{children:(0,d.jsxs)(p.default,{sx:{display:"flex",gap:1},children:[Array.isArray(j)&&j.length>0&&(0,d.jsxs)(ao.default,{size:"small",variant:"outlined",onClick:()=>(function(a){if(console.debug("[openTaskModal]"),console.debug("workorder:",a),!a.start_date){alert("Work Order belum memiliki Start Date. Isi Start Date dan End Date terlebih dahulu."),F(a);return}S(""),P([]),U({}),N({open:!0,wo:a}),(async()=>{let b=[];try{let c=a.vendor_cabang??a.raw?.vendor_cabang??a.raw?.site??"",d=String(c||"").toLowerCase().trim(),e=a=>String(a).padStart(2,"0"),g=function(a){if(!a)return null;let b=String(a).trim(),c=/^(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2})(?::(\d{2}))?)?$/.exec(b);if(c){let[,a,b,d,e="00",f="00",g="00"]=c,h=new Date(Date.UTC(Number(a),Number(b)-1,Number(d),Number(e),Number(f),Number(g)));return new Date(h.getTime()+0)}let d=new Date(b);return isNaN(d.getTime())?null:new Date(d.getTime()+0)}(String(a.start_date));if(!g){alert("Start Date tidak valid. Isi Start Date yang benar terlebih dahulu."),F(a);return}let h=`${g.getUTCFullYear()}-${e(g.getUTCMonth()+1)}-${e(g.getUTCDate())}`,i=`${e(g.getUTCHours())}:${e(g.getUTCMinutes())}`;console.debug("[openTaskModal] assignDate/time (local)",{assignDate:h,assignTime:i,raw:a.start_date});let j=`/scheduled-technicians?date=${encodeURIComponent(h)}&time=${encodeURIComponent(i)}`+(d?`&site=${encodeURIComponent(d)}`:"");console.debug(j);try{console.debug("[openTaskModal] fetching scheduled technicians",{schedUrl:j});let a=await (0,f.default)(j);console.debug(a);let c=Array.isArray(a)?a:a?.data??[];console.debug("[openTaskModal] scheduled-technicians response",{count:Array.isArray(c)?c.length:0}),c&&c.length>0?(b=c,console.debug("[openTaskModal] using scheduled-technicians sample",c.slice(0,5))):b=c}catch(d){console.warn("scheduled-technicians fetch failed, falling back",d);let a=await (0,f.default)("/users?role=technician"),c=Array.isArray(a)?a:a?.data??[];console.debug("[openTaskModal] fallback /users?role=technician response",{count:Array.isArray(c)?c.length:0}),b=c}console.debug("[openTaskModal] final filteredTechs",{count:b.length,sample:b.slice(0,5)}),P(b)}catch(a){console.warn("Failed to load technicians from shift assignments",a),P([]),b=[]}try{let c=await (0,f.default)(`/work-orders/${encodeURIComponent(a.id)}`),d=c?.data??c;try{console.debug("[openTaskModal] fetching tasks for workorder",{workOrderId:a.id});let b=await (0,f.default)(`/work-orders/${encodeURIComponent(a.id)}/tasks`),c=Array.isArray(b)?b:b?.data??[];console.debug("[openTaskModal] tasks fetch result",{count:Array.isArray(c)?c.length:0,sample:c.slice(0,5)}),d.tasks=c}catch(b){console.debug("[openTaskModal] /tasks fetch failed, falling back to raw.activities",b);let a=Array.isArray(d.raw?.activities)?d.raw.activities:[];d.tasks=a.map((a,b)=>({id:`raw-${b}`,name:a.task_name||a.name||`Task ${b+1}`,duration_min:a.task_duration}))}N({open:!0,wo:d});let e={},g=Array.isArray(d.tasks)?d.tasks:[],h=new Set((Array.isArray(b)?b:[]).map(a=>String(a.id)));for(let a of(console.debug("[openTaskModal] building selectedAssignees from task.assignments",{taskCount:g.length,techIdsCount:h.size}),g)){let b=String(a.id??a.task_id??a.external_id??"");if(!b)continue;let c=Array.isArray(a.assignments)?a.assignments:[],d=[];for(let a of c){let c=String(a?.user?.id??a.user_id??a.userId??"");if(c){if(!h.has(c)){console.debug("[openTaskModal] skipping assignment because assignee not in filtered technicians",{assId:c,key:b});continue}d.includes(c)||d.push(c)}}d.length>0&&(e[b]=d)}console.debug("[openTaskModal] selectedAssignees prepared",e),U(e)}catch(a){console.warn("Failed to load workorder detail",a)}try{let a=await (0,f.default)("/auth/me");W(a?.data??a)}catch(a){W(null)}})()})(a),children:["Lihat Task (",j.length,")"]}),"IN_PROGRESS"!==l&&"COMPLETED"!==l&&"DEPLOYED"!==l&&(0,d.jsx)(ao.default,{size:"small",variant:"contained",color:"secondary",onClick:()=>{F(a),J(""),Y(ab(a.start_date)),$(ab(a.end_date)),(async()=>{try{let b=await (0,f.default)(`/work-orders/${encodeURIComponent(a.id)}/date-history`),c=b?.data??b;Array.isArray(c)?L(c):L([])}catch(a){L([])}})()},children:"Edit Dates"})]})})]},a.id)})})]})}),(0,d.jsxs)(p.default,{sx:{display:"flex",gap:2,alignItems:"center"},children:[(0,d.jsx)(ao.default,{onClick:function(){x>1&&y(a=>{let b=a-1;return _(b),b})},disabled:x<=1,size:"small",children:"Prev"}),(0,d.jsxs)(aC.default,{variant:"body2",children:["Page ",x," / ",Math.max(1,Math.ceil(A/z))]}),(0,d.jsx)(ao.default,{onClick:function(){x<Math.ceil(A/z)&&y(a=>{let b=a+1;return _(b),b})},disabled:x>=Math.max(1,Math.ceil(A/z)),size:"small",children:"Next"})]})]}),M.open&&M.wo&&(0,d.jsx)("div",{style:{position:"fixed",left:0,right:0,top:0,bottom:0,background:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:2e3,padding:16},children:(0,d.jsxs)("div",{style:{background:"white",padding:16,width:"95%",maxWidth:900,borderRadius:8,maxHeight:"86vh",overflow:"auto",boxShadow:"0 6px 30px rgba(0,0,0,0.2)"},children:[(0,d.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:12,marginBottom:12},children:[(0,d.jsxs)("div",{style:{flex:1},children:[(0,d.jsxs)("h2",{style:{marginTop:0,marginBottom:6,fontSize:20},children:["Task - ",M.wo.doc_no??M.wo.id]}),(0,d.jsx)("div",{style:{color:"#666",fontSize:13},children:M.wo.description})]}),(0,d.jsxs)("div",{style:{textAlign:"right",minWidth:180},children:[(0,d.jsx)("div",{style:{fontSize:13,marginBottom:8},children:void 0===V?(0,d.jsx)("span",{style:{color:"#666"},children:"Checking auth..."}):null===V?(0,d.jsx)("span",{style:{color:"#c00"},children:"Not authenticated"}):(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{style:{fontWeight:700},children:V.name||V.username||V.email}),(0,d.jsxs)("div",{style:{color:"#666",fontSize:12},children:[V.email," — ",V.role??V.type]})]})}),(0,d.jsxs)("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[M.wo?.status==="READY_TO_DEPLOY"&&(0,d.jsx)("button",{onClick:()=>ae(M.wo.id),style:{padding:"6px 10px",background:"#7c3aed",color:"white",borderRadius:6},children:"Deploy"}),M.wo?.status==="DEPLOYED"&&(0,d.jsx)("button",{onClick:()=>af(M.wo.id),style:{padding:"6px 10px",background:"#ef4444",color:"white",borderRadius:6},children:"Undeploy"}),(0,d.jsx)("button",{onClick:function(){N({open:!1,wo:null}),S("");try{_(x,C)}catch(a){console.warn("Failed to refresh work order list after closing modal",a)}},style:{padding:"6px 10px"},children:"Close"})]})]})]}),(0,d.jsx)("div",{style:{marginBottom:8},children:(0,d.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",tableLayout:"fixed"},children:[(0,d.jsxs)("colgroup",{children:[(0,d.jsx)("col",{style:{width:"50px"}}),(0,d.jsx)("col",{}),(0,d.jsx)("col",{style:{width:"110px"}}),(0,d.jsx)("col",{style:{width:"340px"}})]}),(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{style:{background:"#f5f5f5"},children:[(0,d.jsx)("th",{style:{textAlign:"left",padding:12,borderBottom:"1px solid #ddd"},children:"No"}),(0,d.jsx)("th",{style:{textAlign:"left",padding:12,borderBottom:"1px solid #ddd"},children:"Task Name"}),(0,d.jsx)("th",{style:{textAlign:"left",padding:12,borderBottom:"1px solid #ddd",textAlignLast:"right"},children:"Duration (min)"}),ad(M.wo)&&(0,d.jsx)("th",{style:{textAlign:"left",padding:12,borderBottom:"1px solid #ddd"},children:"Assign technicians"})]})}),(0,d.jsx)("tbody",{children:Array.isArray(M.wo.tasks)&&M.wo.tasks.map((a,b)=>{let c,e=a.id??a.task_id??String(b);T[e];let g=function(a){try{for(let b of["realisasi","realisasis","realisasi_list","realisasi_entries","realisasiItems","realisasi_items","realisasiEntries"]){let c=a[b];if(Array.isArray(c)&&c.length>0)return!0}if(Array.isArray(a.assignments))for(let b of a.assignments){if(Array.isArray(b.realisasi)&&b.realisasi.length>0||(b.realisasi_count||b.realisasiCount||b.realisasiTotal)>0)return!0;let a=(b.status||b.state||"").toString().toUpperCase();if(a.includes("COMP")||a.includes("VERIF")||a.includes("DONE")||a.includes("APPROV"))return!0}let b=Array.isArray(M.wo?.assignments)?M.wo.assignments:[];if(b.length>0)for(let c of b){let b=c.task_id??c.taskId??c.task?.id?String(c.task_id??c.taskId??c.task?.id):null,d=a.id??a.task_id??a.external_id?String(a.id??a.task_id??a.external_id):null;if(b&&d&&b===d){if(Array.isArray(c.realisasi)&&c.realisasi.length>0||(c.realisasi_count||c.realisasiCount||c.realisasiTotal)>0)return!0;let a=(c.status||c.state||"").toString().toUpperCase();if(a.includes("COMP")||a.includes("VERIF")||a.includes("DONE")||a.includes("APPROV"))return!0}let e=(c.task_name||c.taskName||c.task?.name||"").toString().trim().toLowerCase(),f=(a.name||a.task_name||a.taskName||"").toString().trim().toLowerCase();if(e&&f&&e===f){if(Array.isArray(c.realisasi)&&c.realisasi.length>0||(c.realisasi_count||c.realisasiCount||c.realisasiTotal)>0)return!0;let a=(c.status||c.state||"").toString().toUpperCase();if(a.includes("COMP")||a.includes("VERIF")||a.includes("DONE")||a.includes("APPROV"))return!0}}if(!0===a.completed||!0===a.is_completed||String(a.status||"").toUpperCase().includes("COMP")||a.completed_at||a.realisasi_at||a.approved_at)return!0}catch(a){}return!1}(a)||!!(a.has_realisasi||a.realisasi_count);return(0,d.jsxs)("tr",{style:{borderBottom:"1px solid #f1f1f1"},children:[(0,d.jsx)("td",{style:{padding:12,verticalAlign:"top"},children:a.task_number??b+1}),(0,d.jsxs)("td",{style:{padding:12,verticalAlign:"top"},children:[(0,d.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,d.jsx)("div",{style:{fontWeight:700},children:a.name??a.task_name??"-"}),g?(0,d.jsx)("span",{style:{background:"#10b981",color:"white",padding:"2px 8px",borderRadius:999,fontSize:12,fontWeight:600},children:"Realisasi ✓"}):(c=Number(a.pending_realisasi_count||a.pendingCount||0),a.has_pending||c>0?(0,d.jsxs)("span",{style:{background:"#f59e0b",color:"white",padding:"2px 8px",borderRadius:999,fontSize:12,fontWeight:600},children:["Pending",c?` (${c})`:""]}):(0,d.jsx)("span",{style:{background:"#64748b",color:"white",padding:"2px 8px",borderRadius:999,fontSize:12,fontWeight:600},children:"Belum Realisasi"}))]}),(0,d.jsxs)("div",{style:{fontSize:12,color:"#888",marginTop:6},children:["ID: ",a.id??"-"]}),Array.isArray(a.assignments)&&a.assignments.length>0&&(0,d.jsx)("div",{style:{marginTop:8,display:"flex",gap:8,flexWrap:"wrap"},children:a.assignments.map(b=>(0,d.jsxs)("div",{style:{background:"#eef2ff",padding:"4px 8px",borderRadius:6,display:"flex",gap:8,alignItems:"center"},children:[(0,d.jsx)("span",{style:{fontSize:13,fontWeight:600},children:b.user?.name??b.user?.nipp??b.user?.email??b.assigned_to??"Unknown"}),V&&!["DEPLOYED","IN_PROGRESS"].includes((M.wo?.status??"").toString())&&(0,d.jsx)("button",{onClick:async()=>{try{await (0,f.default)(`/tasks/${encodeURIComponent(a.id)}/assign/${encodeURIComponent(b.id)}`,{method:"DELETE"})}catch(c){try{await (0,f.default)(`/tasks/${encodeURIComponent(a.id)}/assign/${encodeURIComponent(b.id)}`,{method:"DELETE"})}catch(a){console.error("unassign failed",a),alert("Unassign failed");return}}try{let a=await (0,f.default)(`/work-orders/${encodeURIComponent(M.wo?.id)}`),b=a?.data??a,c=await (0,f.default)(`/work-orders/${encodeURIComponent(M.wo?.id)}/tasks`),d=Array.isArray(c)?c:c?.data??[];N(a=>({...a||{},wo:{...a?.wo||{},...b,tasks:d}}))}catch(a){console.warn("refresh workorder after unassign failed",a)}},style:{background:"transparent",border:"none",color:"#c00",cursor:"pointer"},children:"Unassign"})]},b.id))})]}),(0,d.jsx)("td",{style:{padding:12,verticalAlign:"top",textAlign:"right"},children:a.duration_min??a.task_duration??"-"}),ad(M.wo)?(0,d.jsx)("td",{style:{padding:12,verticalAlign:"top"},children:(0,d.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[(0,d.jsx)(al,{multiple:!0,options:O||[],getOptionLabel:a=>(a.name||a.nipp||a.email||"").toString(),filterSelectedOptions:!0,value:(T[e]||[]).map(a=>O.find(b=>b.id===a)).filter(Boolean),onChange:(a,b)=>U(a=>({...a,[e]:b.map(a=>a.id)})),renderInput:a=>(0,d.jsx)(r.default,{...a,placeholder:"Cari teknisi (nama / email / id)",size:"small"})}),(0,d.jsx)("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginTop:8},children:(O||[]).slice(0,200).map(a=>{let b=(T[e]||[]).includes(a.id);return(0,d.jsx)(Q.default,{label:(a.name||a.nipp||a.email||"").toString(),onClick:()=>{U(b=>{let c=new Set(b[e]||[]);return c.has(a.id)?c.delete(a.id):c.add(a.id),{...b,[e]:Array.from(c)}})},clickable:!0,color:b?"primary":"default",variant:b?"filled":"outlined",size:"small",sx:{marginRight:.5}},a.id)})}),(0,d.jsx)("div",{style:{display:"flex",gap:8,justifyContent:"flex-start",marginTop:8},children:void 0===V?(0,d.jsx)(ao.default,{size:"small",disabled:!0,children:"Checking..."}):null===V?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(ao.default,{size:"small",variant:"contained",color:"primary",onClick:()=>{window.location.href="/login"},children:"Login to assign"}),(0,d.jsx)(ao.default,{size:"small",onClick:()=>{U(a=>({...a,[e]:[]}))},children:"Clear"})]}):["DEPLOYED","IN_PROGRESS"].includes((M.wo?.status??"").toString())?(0,d.jsx)(ao.default,{size:"small",disabled:!0,children:"Deployed"}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(ao.default,{size:"small",variant:"contained",onClick:async()=>{let c=T[e]||[];if(!c||0===c.length)return void alert("Pilih minimal 1 teknisi");try{for(let d of Array.from(new Set(c)))await (0,f.default)(`/tasks/${encodeURIComponent(a.id??a.task_id??String(b))}/assign`,{method:"POST",body:{userId:d,assignedBy:V?.id}});alert("Assignment created");try{let a=await (0,f.default)(`/work-orders/${encodeURIComponent(M.wo?.id)}`),b=a?.data??a,c=await (0,f.default)(`/work-orders/${encodeURIComponent(M.wo?.id)}/tasks`),d=Array.isArray(c)?c:c?.data??[];N(a=>({...a||{},wo:{...a?.wo||{},...b,tasks:d}}))}catch(a){console.warn("refresh tasks after assign failed",a)}_(x,C)}catch(a){console.error("assign error",a),alert(a?.body?.message||a?.message||"Assignment failed")}},children:"Assign"}),(0,d.jsx)(ao.default,{size:"small",onClick:()=>{U(a=>({...a,[e]:[]}))},children:"Clear"})]})})]})}):(0,d.jsx)("td",{style:{padding:12,verticalAlign:"top"}})]},b)})})]})})]})}),(0,d.jsxs)(ap.default,{open:!!E,onClose:()=>F(null),fullWidth:!0,maxWidth:"sm",children:[(0,d.jsxs)(aq.default,{children:["Edit Dates — ",E?.doc_no??E?.id]}),(0,d.jsx)(ar.default,{dividers:!0,children:(0,d.jsxs)(at.default,{spacing:2,sx:{mt:1},children:[(0,d.jsx)(r.default,{label:"Start Date & Time",type:"datetime-local",size:"small",value:X,onChange:a=>Y(a.target.value),InputLabelProps:{shrink:!0},fullWidth:!0}),(0,d.jsxs)("div",{style:{fontSize:12,color:"#666"},children:["Current: ",b(E?.start_date)]}),(0,d.jsx)(r.default,{label:"End Date & Time",type:"datetime-local",size:"small",value:Z,onChange:a=>$(a.target.value),InputLabelProps:{shrink:!0},fullWidth:!0}),(0,d.jsxs)("div",{style:{fontSize:12,color:"#666"},children:["Current: ",b(E?.end_date)]}),(0,d.jsx)(r.default,{label:"Keterangan (opsional)",placeholder:"Alasan atau catatan perubahan tanggal",multiline:!0,rows:4,value:I,onChange:a=>J(a.target.value),fullWidth:!0,size:"small"}),Array.isArray(K)&&K.length>0&&(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"History perubahan tanggal"}),(0,d.jsx)("div",{style:{maxHeight:240,overflow:"auto"},children:K.map((a,c)=>(0,d.jsxs)("div",{style:{padding:12,borderBottom:"1px solid #f5f5f5"},children:[(0,d.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,d.jsx)("div",{style:{fontSize:13,color:"#333",fontWeight:700},children:a.changed_at?new Date(a.changed_at).toLocaleString():"-"}),(0,d.jsx)("div",{style:{fontSize:12,color:"#666"},children:a.changed_by?`${a.changed_by.nipp??a.changed_by.id??"-"} • ${a.changed_by.name??a.changed_by.email??"-"}`:"-"})]}),(0,d.jsxs)("div",{style:{marginTop:6,color:"#444"},children:[(0,d.jsxs)("div",{children:["Start: ",a.old_start?b(a.old_start):"-"," → ",a.new_start?b(a.new_start):"-"]}),(0,d.jsxs)("div",{children:["End: ",a.old_end?b(a.old_end):"-"," → ",a.new_end?b(a.new_end):"-"]})]}),a.note&&(0,d.jsxs)("div",{style:{marginTop:8,fontSize:13,color:"#555"},children:["Catatan: ",a.note]})]},a.id||c))})]})]})}),(0,d.jsxs)(as.default,{sx:{p:2},children:[(0,d.jsx)(ao.default,{onClick:()=>F(null),disabled:G,children:"Batal"}),(0,d.jsx)(ao.default,{variant:"contained",color:"primary",onClick:async()=>{function a(a){if(!a)return null;let b=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2})$/.exec(a);if(!b)return null;let[,c,d,e,f,g]=b;return`${c}-${d}-${e} ${f}:${g}:00`}if(X&&!/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2})$/.test(X))return void alert("Start date tidak valid");if(Z&&!/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2})$/.test(Z))return void alert("End date tidak valid");let b=a(X||null),c=a(Z||null);await aa(E.id,b,c)},disabled:G,children:G?"Menyimpan...":"Simpan Perubahan"})]})]})]})}function aE(){let a=(0,e.useRef)(null);return(0,d.jsxs)("main",{style:{padding:24,fontFamily:'Inter, system-ui, -apple-system, Roboto, "Helvetica Neue", Arial'},children:[(0,d.jsx)("h1",{style:{marginBottom:12},children:"Work Orders"}),(0,d.jsx)("section",{style:{marginBottom:20},children:(0,d.jsx)(o,{onCreated:()=>a.current?.()})}),(0,d.jsx)("section",{children:(0,d.jsx)(aD,{onRefreshRequested:b=>a.current=b})})]})}a.s(["default",()=>aE],11637)}];

//# sourceMappingURL=web_826ccc66._.js.map