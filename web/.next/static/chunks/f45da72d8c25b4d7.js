(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,92081,(e,t,a)=>{"use strict";var r=e.r(7478);Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var l=r(e.r(87915)),n=e.r(14294);a.default=(0,l.default)((0,n.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"}),"Save")},54501,(e,t,a)=>{"use strict";var r=e.r(7478);Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var l=r(e.r(87915)),n=e.r(14294);a.default=(0,l.default)((0,n.jsx)("path",{d:"M11 21h-1l1-7H7.5c-.58 0-.57-.32-.38-.66.19-.34.05-.08.07-.12C8.48 10.94 10.42 7.54 13 3h1l-1 7h3.5c.49 0 .56.33.47.51l-.07.15C12.96 17.55 11 21 11 21z"}),"Bolt")},24419,(e,t,a)=>{"use strict";var r=e.r(7478);Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var l=r(e.r(87915)),n=e.r(14294);a.default=(0,l.default)((0,n.jsx)("path",{d:"M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"}),"InfoOutlined")},93291,(e,t,a)=>{"use strict";var r=e.r(7478);Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var l=r(e.r(87915)),n=e.r(14294);a.default=(0,l.default)((0,n.jsx)("path",{d:"M11 7h6v2h-6zm0 4h6v2h-6zm0 4h6v2h-6zM7 7h2v2H7zm0 4h2v2H7zm0 4h2v2H7zM20.1 3H3.9c-.5 0-.9.4-.9.9v16.2c0 .4.4.9.9.9h16.2c.4 0 .9-.5.9-.9V3.9c0-.5-.5-.9-.9-.9zM19 19H5V5h14v14z"}),"ListAltOutlined")},21850,(e,t,a)=>{"use strict";var r=e.r(7478);Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var l=r(e.r(87915)),n=e.r(14294);a.default=(0,l.default)((0,n.jsx)("path",{d:"m14.06 9.02.92.92L5.92 19H5v-.92l9.06-9.06M17.66 3c-.25 0-.51.1-.7.29l-1.83 1.83 3.75 3.75 1.83-1.83c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.2-.2-.45-.29-.71-.29zm-3.6 3.19L3 17.25V21h3.75L17.81 9.94l-3.75-3.75z"}),"EditOutlined")},60855,e=>{"use strict";var t,a,r=e.i(14294),l=e.i(30878),n=e.i(23703),i=e.i(75696),s=e.i(36742),o=e.i(24268),o=o,d=e.i(61645),u=e.i(54073),u=u,c=e.i(87988),c=c,p=e.i(92081),f=e.i(54501);function h({onCreated:e}){let[t,a]=(0,l.useState)(""),[h,g]=(0,l.useState)(!1),[m,x]=(0,l.useState)(null);async function y(r){if(r.preventDefault(),x(null),!t.trim())return x("Masukkan id SIGAP");g(!0);try{let r=await (0,n.default)("/work-orders/add",{method:"POST",body:{id:t.trim()}});x("Work order tersimpan: "+(r?.data?.doc_no||r?.data?.id||"OK")),a(""),e?.()}catch(e){console.error("add error",e),x("Error: "+(e.body?.detail||e.body?.message||e.message||"gagal"))}finally{g(!1)}}return(0,r.jsx)(d.Paper,{elevation:2,sx:{p:2,mb:2},children:(0,r.jsx)("form",{onSubmit:y,children:(0,r.jsxs)(o.default,{direction:"row",spacing:2,alignItems:"center",children:[(0,r.jsx)(i.TextField,{value:t,onChange:e=>a(e.target.value),placeholder:"Masukkan id SIGAP (contoh: 1656)",disabled:h,size:"small",variant:"outlined",sx:{minWidth:320},InputProps:{startAdornment:(0,r.jsx)(c.default,{position:"start",children:(0,r.jsx)(f.default,{color:"primary"})})}}),(0,r.jsx)(s.Button,{type:"submit",variant:"contained",color:"primary",startIcon:(0,r.jsx)(p.default,{}),disabled:h,sx:{whiteSpace:"nowrap"},children:h?"Mengambil...":"Ambil & Simpan"}),m&&(0,r.jsx)(u.default,{severity:m.startsWith("Error")?"error":"success",sx:{ml:1},children:m})]})})})}var g=e.i(88627),m=e.i(28960),x=e.i(71606);e.i(50382);var y=e.i(79711),b=e.i(73161),v=e.i(30279),w=e.i(64848),j=e.i(45262),S=e.i(93243),k=e.i(1352),C=e.i(7775);function A(e){return void 0!==e.normalize?e.normalize("NFD").replace(/[\u0300-\u036f]/g,""):e}function $(e,t){for(let a=0;a<e.length;a+=1)if(t(e[a]))return a;return -1}let I=function(e={}){let{ignoreAccents:t=!0,ignoreCase:a=!0,limit:r,matchFrom:l="any",stringify:n,trim:i=!1}=e;return(e,{inputValue:s,getOptionLabel:o})=>{let d=i?s.trim():s;a&&(d=d.toLowerCase()),t&&(d=A(d));let u=d?e.filter(e=>{let r=(n||o)(e);return a&&(r=r.toLowerCase()),t&&(r=A(r)),"start"===l?0===r.indexOf(d):r.indexOf(d)>-1}):e;return"number"==typeof r?u.slice(0,r):u}}(),R=e=>{var t;return null!==e.current&&(null==(t=e.current.parentElement)?void 0:t.contains(document.activeElement))};var O=e.i(42735),_=e.i(44734),P=e.i(28569),T=e.i(56568),E=e.i(30352),D=e.i(20455),z=e.i(75964);function L(e){return(0,z.default)("MuiListSubheader",e)}(0,D.default)("MuiListSubheader",["root","colorPrimary","colorInherit","gutters","inset","sticky"]);let M=["className","color","component","disableGutters","disableSticky","inset"],N=(0,P.default)("li",{name:"MuiListSubheader",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:a}=e;return[t.root,"default"!==a.color&&t[`color${(0,E.default)(a.color)}`],!a.disableGutters&&t.gutters,a.inset&&t.inset,!a.disableSticky&&t.sticky]}})(({theme:e,ownerState:t})=>(0,b.default)({boxSizing:"border-box",lineHeight:"48px",listStyle:"none",color:(e.vars||e).palette.text.secondary,fontFamily:e.typography.fontFamily,fontWeight:e.typography.fontWeightMedium,fontSize:e.typography.pxToRem(14)},"primary"===t.color&&{color:(e.vars||e).palette.primary.main},"inherit"===t.color&&{color:"inherit"},!t.disableGutters&&{paddingLeft:16,paddingRight:16},t.inset&&{paddingLeft:72},!t.disableSticky&&{position:"sticky",top:0,zIndex:1,backgroundColor:(e.vars||e).palette.background.paper})),W=l.forwardRef(function(e,t){let a=(0,T.default)({props:e,name:"MuiListSubheader"}),{className:l,color:n="default",component:i="li",disableGutters:s=!1,disableSticky:o=!1,inset:d=!1}=a,u=(0,y.default)(a,M),c=(0,b.default)({},a,{color:n,component:i,disableGutters:s,disableSticky:o,inset:d}),p=(e=>{let{classes:t,color:a,disableGutters:r,inset:l,disableSticky:n}=e,i={root:["root","default"!==a&&`color${(0,E.default)(a)}`,!r&&"gutters",l&&"inset",!n&&"sticky"]};return(0,w.unstable_composeClasses)(i,L,t)})(c);return(0,r.jsx)(N,(0,b.default)({as:i,className:(0,v.default)(p.root,l),ref:t,ownerState:c},u))});W.muiSkipListHighlight=!0;var U=e.i(22921),B=e.i(65250),H=e.i(87220),F=e.i(29248),V=e.i(42882),G=e.i(79939),Y=e.i(11724),q=e.i(65515);function K(e){return(0,z.default)("MuiAutocomplete",e)}let J=(0,e.i(27605).unstable_generateUtilityClasses)("MuiAutocomplete",["root","expanded","fullWidth","focused","focusVisible","tag","tagSizeSmall","tagSizeMedium","hasPopupIcon","hasClearIcon","inputRoot","input","inputFocused","endAdornment","clearIndicator","popupIndicator","popupIndicatorOpen","popper","popperDisablePortal","paper","listbox","loading","noOptions","option","groupLabel","groupUl"]);var X=e.i(85537);let Q=["autoComplete","autoHighlight","autoSelect","blurOnSelect","ChipProps","className","clearIcon","clearOnBlur","clearOnEscape","clearText","closeText","componentsProps","defaultValue","disableClearable","disableCloseOnSelect","disabled","disabledItemsFocusable","disableListWrap","disablePortal","filterOptions","filterSelectedOptions","forcePopupIcon","freeSolo","fullWidth","getLimitTagsText","getOptionDisabled","getOptionLabel","isOptionEqualToValue","groupBy","handleHomeEndKeys","id","includeInputInList","inputValue","limitTags","ListboxComponent","ListboxProps","loading","loadingText","multiple","noOptionsText","onChange","onClose","onHighlightChange","onInputChange","onOpen","open","openOnFocus","openText","options","PaperComponent","PopperComponent","popupIcon","readOnly","renderGroup","renderInput","renderOption","renderTags","selectOnFocus","size","slotProps","value"],Z=["ref"],ee=(0,P.default)("div",{name:"MuiAutocomplete",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:a}=e,{fullWidth:r,hasClearIcon:l,hasPopupIcon:n,inputFocused:i,size:s}=a;return[{[`& .${J.tag}`]:t.tag},{[`& .${J.tag}`]:t[`tagSize${(0,E.default)(s)}`]},{[`& .${J.inputRoot}`]:t.inputRoot},{[`& .${J.input}`]:t.input},{[`& .${J.input}`]:i&&t.inputFocused},t.root,r&&t.fullWidth,n&&t.hasPopupIcon,l&&t.hasClearIcon]}})(({ownerState:e})=>(0,b.default)({[`&.${J.focused} .${J.clearIndicator}`]:{visibility:"visible"},"@media (pointer: fine)":{[`&:hover .${J.clearIndicator}`]:{visibility:"visible"}}},e.fullWidth&&{width:"100%"},{[`& .${J.tag}`]:(0,b.default)({margin:3,maxWidth:"calc(100% - 6px)"},"small"===e.size&&{margin:2,maxWidth:"calc(100% - 4px)"}),[`& .${J.inputRoot}`]:{flexWrap:"wrap",[`.${J.hasPopupIcon}&, .${J.hasClearIcon}&`]:{paddingRight:30},[`.${J.hasPopupIcon}.${J.hasClearIcon}&`]:{paddingRight:56},[`& .${J.input}`]:{width:0,minWidth:30}},[`& .${H.default.root}`]:{paddingBottom:1,"& .MuiInput-input":{padding:"4px 4px 4px 0px"}},[`& .${H.default.root}.${F.default.sizeSmall}`]:{[`& .${H.default.input}`]:{padding:"2px 4px 3px 0"}},[`& .${V.default.root}`]:{padding:9,[`.${J.hasPopupIcon}&, .${J.hasClearIcon}&`]:{paddingRight:39},[`.${J.hasPopupIcon}.${J.hasClearIcon}&`]:{paddingRight:65},[`& .${J.input}`]:{padding:"7.5px 4px 7.5px 5px"},[`& .${J.endAdornment}`]:{right:9}},[`& .${V.default.root}.${F.default.sizeSmall}`]:{paddingTop:6,paddingBottom:6,paddingLeft:6,[`& .${J.input}`]:{padding:"2.5px 4px 2.5px 8px"}},[`& .${G.default.root}`]:{paddingTop:19,paddingLeft:8,[`.${J.hasPopupIcon}&, .${J.hasClearIcon}&`]:{paddingRight:39},[`.${J.hasPopupIcon}.${J.hasClearIcon}&`]:{paddingRight:65},[`& .${G.default.input}`]:{padding:"7px 4px"},[`& .${J.endAdornment}`]:{right:9}},[`& .${G.default.root}.${F.default.sizeSmall}`]:{paddingBottom:1,[`& .${G.default.input}`]:{padding:"2.5px 4px"}},[`& .${F.default.hiddenLabel}`]:{paddingTop:8},[`& .${G.default.root}.${F.default.hiddenLabel}`]:{paddingTop:0,paddingBottom:0,[`& .${J.input}`]:{paddingTop:16,paddingBottom:17}},[`& .${G.default.root}.${F.default.hiddenLabel}.${F.default.sizeSmall}`]:{[`& .${J.input}`]:{paddingTop:8,paddingBottom:9}},[`& .${J.input}`]:(0,b.default)({flexGrow:1,textOverflow:"ellipsis",opacity:0},e.inputFocused&&{opacity:1})})),et=(0,P.default)("div",{name:"MuiAutocomplete",slot:"EndAdornment",overridesResolver:(e,t)=>t.endAdornment})({position:"absolute",right:0,top:"calc(50% - 14px)"}),ea=(0,P.default)(U.default,{name:"MuiAutocomplete",slot:"ClearIndicator",overridesResolver:(e,t)=>t.clearIndicator})({marginRight:-2,padding:4,visibility:"hidden"}),er=(0,P.default)(U.default,{name:"MuiAutocomplete",slot:"PopupIndicator",overridesResolver:({ownerState:e},t)=>(0,b.default)({},t.popupIndicator,e.popupOpen&&t.popupIndicatorOpen)})(({ownerState:e})=>(0,b.default)({padding:2,marginRight:-2},e.popupOpen&&{transform:"rotate(180deg)"})),el=(0,P.default)(_.default,{name:"MuiAutocomplete",slot:"Popper",overridesResolver:(e,t)=>{let{ownerState:a}=e;return[{[`& .${J.option}`]:t.option},t.popper,a.disablePortal&&t.popperDisablePortal]}})(({theme:e,ownerState:t})=>(0,b.default)({zIndex:(e.vars||e).zIndex.modal},t.disablePortal&&{position:"absolute"})),en=(0,P.default)(m.default,{name:"MuiAutocomplete",slot:"Paper",overridesResolver:(e,t)=>t.paper})(({theme:e})=>(0,b.default)({},e.typography.body1,{overflow:"auto"})),ei=(0,P.default)("div",{name:"MuiAutocomplete",slot:"Loading",overridesResolver:(e,t)=>t.loading})(({theme:e})=>({color:(e.vars||e).palette.text.secondary,padding:"14px 16px"})),es=(0,P.default)("div",{name:"MuiAutocomplete",slot:"NoOptions",overridesResolver:(e,t)=>t.noOptions})(({theme:e})=>({color:(e.vars||e).palette.text.secondary,padding:"14px 16px"})),eo=(0,P.default)("div",{name:"MuiAutocomplete",slot:"Listbox",overridesResolver:(e,t)=>t.listbox})(({theme:e})=>({listStyle:"none",margin:0,padding:"8px 0",maxHeight:"40vh",overflow:"auto",position:"relative",[`& .${J.option}`]:{minHeight:48,display:"flex",overflow:"hidden",justifyContent:"flex-start",alignItems:"center",cursor:"pointer",paddingTop:6,boxSizing:"border-box",outline:"0",WebkitTapHighlightColor:"transparent",paddingBottom:6,paddingLeft:16,paddingRight:16,[e.breakpoints.up("sm")]:{minHeight:"auto"},[`&.${J.focused}`]:{backgroundColor:(e.vars||e).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},'&[aria-disabled="true"]':{opacity:(e.vars||e).palette.action.disabledOpacity,pointerEvents:"none"},[`&.${J.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},'&[aria-selected="true"]':{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:(0,O.alpha)(e.palette.primary.main,e.palette.action.selectedOpacity),[`&.${J.focused}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:(0,O.alpha)(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:(e.vars||e).palette.action.selected}},[`&.${J.focusVisible}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.focusOpacity}))`:(0,O.alpha)(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.focusOpacity)}}}})),ed=(0,P.default)(W,{name:"MuiAutocomplete",slot:"GroupLabel",overridesResolver:(e,t)=>t.groupLabel})(({theme:e})=>({backgroundColor:(e.vars||e).palette.background.paper,top:-8})),eu=(0,P.default)("ul",{name:"MuiAutocomplete",slot:"GroupUl",overridesResolver:(e,t)=>t.groupUl})({padding:0,[`& .${J.option}`]:{paddingLeft:24}}),ec=l.forwardRef(function(e,n){var i,s,o,d;let u,c=(0,T.default)({props:e,name:"MuiAutocomplete"}),{autoComplete:p=!1,autoHighlight:f=!1,autoSelect:h=!1,blurOnSelect:g=!1,ChipProps:x,className:A,clearIcon:O=t||(t=(0,r.jsx)(Y.default,{fontSize:"small"})),clearOnBlur:P=!c.freeSolo,clearOnEscape:D=!1,clearText:z="Clear",closeText:L="Close",componentsProps:M={},defaultValue:N=c.multiple?[]:null,disableClearable:W=!1,disableCloseOnSelect:U=!1,disabled:H=!1,disabledItemsFocusable:F=!1,disableListWrap:V=!1,disablePortal:G=!1,filterSelectedOptions:J=!1,forcePopupIcon:ec="auto",freeSolo:ep=!1,fullWidth:ef=!1,getLimitTagsText:eh=e=>`+${e}`,getOptionLabel:eg,groupBy:em,handleHomeEndKeys:ex=!c.freeSolo,includeInputInList:ey=!1,limitTags:eb=-1,ListboxComponent:ev="ul",ListboxProps:ew,loading:ej=!1,loadingText:eS="Loading…",multiple:ek=!1,noOptionsText:eC="No options",openOnFocus:eA=!1,openText:e$="Open",PaperComponent:eI=m.default,PopperComponent:eR=_.default,popupIcon:eO=a||(a=(0,r.jsx)(q.default,{})),readOnly:e_=!1,renderGroup:eP,renderInput:eT,renderOption:eE,renderTags:eD,selectOnFocus:ez=!c.freeSolo,size:eL="medium",slotProps:eM={}}=c,eN=(0,y.default)(c,Q),{getRootProps:eW,getInputProps:eU,getInputLabelProps:eB,getPopupIndicatorProps:eH,getClearProps:eF,getTagProps:eV,getListboxProps:eG,getOptionProps:eY,value:eq,dirty:eK,expanded:eJ,id:eX,popupOpen:eQ,focused:eZ,focusedTag:e0,anchorEl:e1,setAnchorEl:e2,inputValue:e6,groupedOptions:e4}=function(e){var t;let a,{unstable_isActiveElementInListbox:r=R,unstable_classNamePrefix:n="Mui",autoComplete:i=!1,autoHighlight:s=!1,autoSelect:o=!1,blurOnSelect:d=!1,clearOnBlur:u=!e.freeSolo,clearOnEscape:c=!1,componentName:p="useAutocomplete",defaultValue:f=e.multiple?[]:null,disableClearable:h=!1,disableCloseOnSelect:g=!1,disabled:m,disabledItemsFocusable:x=!1,disableListWrap:y=!1,filterOptions:v=I,filterSelectedOptions:w=!1,freeSolo:A=!1,getOptionDisabled:O,getOptionLabel:_=e=>{var t;return null!=(t=e.label)?t:e},groupBy:P,handleHomeEndKeys:T=!e.freeSolo,id:E,includeInputInList:D=!1,inputValue:z,isOptionEqualToValue:L=(e,t)=>e===t,multiple:M=!1,onChange:N,onClose:W,onHighlightChange:U,onInputChange:B,onOpen:H,open:F,openOnFocus:V=!1,options:G,readOnly:Y=!1,selectOnFocus:q=!e.freeSolo,value:K}=e,J=(0,C.unstable_useId)(E),X=_;X=e=>{let t=_(e);return"string"!=typeof t?String(t):t};let Q=l.useRef(!1),Z=l.useRef(!0),ee=l.useRef(null),et=l.useRef(null),[ea,er]=l.useState(null),[el,en]=l.useState(-1),ei=s?0:-1,es=l.useRef(ei),[eo,ed]=(0,k.unstable_useControlled)({controlled:K,default:f,name:p}),[eu,ec]=(0,k.unstable_useControlled)({controlled:z,default:"",name:p,state:"inputValue"}),[ep,ef]=l.useState(!1),eh=l.useCallback((e,t)=>{let a;if((M?eo.length<t.length:null!==t)||u){if(M)a="";else if(null==t)a="";else{let e=X(t);a="string"==typeof e?e:""}eu!==a&&(ec(a),B&&B(e,a,"reset"))}},[X,eu,M,B,ec,u,eo]),[eg,em]=(0,k.unstable_useControlled)({controlled:F,default:!1,name:p,state:"open"}),[ex,ey]=l.useState(!0),eb=!M&&null!=eo&&eu===X(eo),ev=eg&&!Y,ew=ev?v(G.filter(e=>!(w&&(M?eo:[eo]).some(t=>null!==t&&L(e,t)))),{inputValue:eb&&ex?"":eu,getOptionLabel:X}):[],ej=(t={filteredOptions:ew,value:eo,inputValue:eu},a=l.useRef({}),l.useEffect(()=>{a.current=t}),a.current);l.useEffect(()=>{let e=eo!==ej.value;ep&&!e||(!A||e)&&eh(null,eo)},[eo,eh,ep,ej.value,A]);let eS=eg&&ew.length>0&&!Y,ek=(0,S.unstable_useEventCallback)(e=>{-1===e?ee.current.focus():ea.querySelector(`[data-tag-index="${e}"]`).focus()});l.useEffect(()=>{M&&el>eo.length-1&&(en(-1),ek(-1))},[eo,M,el,ek]);let eC=(0,S.unstable_useEventCallback)(({event:e,index:t,reason:a="auto"})=>{if(es.current=t,-1===t?ee.current.removeAttribute("aria-activedescendant"):ee.current.setAttribute("aria-activedescendant",`${J}-option-${t}`),U&&U(e,-1===t?null:ew[t],a),!et.current)return;let r=et.current.querySelector(`[role="option"].${n}-focused`);r&&(r.classList.remove(`${n}-focused`),r.classList.remove(`${n}-focusVisible`));let l=et.current;if("listbox"!==et.current.getAttribute("role")&&(l=et.current.parentElement.querySelector('[role="listbox"]')),!l)return;if(-1===t){l.scrollTop=0;return}let i=et.current.querySelector(`[data-option-index="${t}"]`);if(i&&(i.classList.add(`${n}-focused`),"keyboard"===a&&i.classList.add(`${n}-focusVisible`),l.scrollHeight>l.clientHeight&&"mouse"!==a&&"touch"!==a)){let e=l.clientHeight+l.scrollTop,t=i.offsetTop+i.offsetHeight;t>e?l.scrollTop=t-l.clientHeight:i.offsetTop-i.offsetHeight*(1.3*!!P)<l.scrollTop&&(l.scrollTop=i.offsetTop-i.offsetHeight*(1.3*!!P))}}),eA=(0,S.unstable_useEventCallback)(({event:e,diff:t,direction:a="next",reason:r="auto"})=>{if(!ev)return;let l=function(e,t){if(!et.current||-1===e)return -1;let a=e;for(;;){if("next"===t&&a===ew.length||"previous"===t&&-1===a)return -1;let e=et.current.querySelector(`[data-option-index="${a}"]`),r=!x&&(!e||e.disabled||"true"===e.getAttribute("aria-disabled"));if((!e||e.hasAttribute("tabindex"))&&!r)return a;a+="next"===t?1:-1}}((()=>{let e=ew.length-1;if("reset"===t)return ei;if("start"===t)return 0;if("end"===t)return e;let a=es.current+t;return a<0?-1===a&&D?-1:y&&-1!==es.current||Math.abs(t)>1?0:e:a>e?a===e+1&&D?-1:y||Math.abs(t)>1?e:0:a})(),a);if(eC({index:l,reason:r,event:e}),i&&"reset"!==t)if(-1===l)ee.current.value=eu;else{let e=X(ew[l]);ee.current.value=e,0===e.toLowerCase().indexOf(eu.toLowerCase())&&eu.length>0&&ee.current.setSelectionRange(eu.length,e.length)}}),e$=l.useCallback(()=>{if(!ev||(()=>{var e;if(-1!==es.current&&ej.filteredOptions&&ej.filteredOptions.length!==ew.length&&ej.inputValue===eu&&(M?eo.length===ej.value.length&&ej.value.every((e,t)=>X(eo[t])===X(e)):(e=ej.value,(e?X(e):"")===(eo?X(eo):"")))){let e=ej.filteredOptions[es.current];if(e&&ew.some(t=>X(t)===X(e)))return!0}return!1})())return;let e=M?eo[0]:eo;if(0===ew.length||null==e)return void eA({diff:"reset"});if(et.current){if(null!=e){let t=ew[es.current];if(M&&t&&-1!==$(eo,e=>L(t,e)))return;let a=$(ew,t=>L(t,e));-1===a?eA({diff:"reset"}):eC({index:a});return}if(es.current>=ew.length-1)return void eC({index:ew.length-1});eC({index:es.current})}},[ew.length,!M&&eo,w,eA,eC,ev,eu,M]),eI=(0,S.unstable_useEventCallback)(e=>{(0,j.unstable_setRef)(et,e),e&&e$()});l.useEffect(()=>{e$()},[e$]);let eR=e=>{!eg&&(em(!0),ey(!0),H&&H(e))},eO=(e,t)=>{eg&&(em(!1),W&&W(e,t))},e_=(e,t,a,r)=>{if(M){if(eo.length===t.length&&eo.every((e,a)=>e===t[a]))return}else if(eo===t)return;N&&N(e,t,a,r),ed(t)},eP=l.useRef(!1),eT=(e,t,a="selectOption",r="options")=>{let l=a,n=t;if(M){let e=$(n=Array.isArray(eo)?eo.slice():[],e=>L(t,e));-1===e?n.push(t):"freeSolo"!==r&&(n.splice(e,1),l="removeOption")}eh(e,n),e_(e,n,l,{option:t}),g||e&&(e.ctrlKey||e.metaKey)||eO(e,l),(!0===d||"touch"===d&&eP.current||"mouse"===d&&!eP.current)&&ee.current.blur()},eE=(e,t)=>{if(!M)return;""===eu&&eO(e,"toggleInput");let a=el;-1===el?""===eu&&"previous"===t&&(a=eo.length-1):((a+="next"===t?1:-1)<0&&(a=0),a===eo.length&&(a=-1)),en(a=function(e,t){if(-1===e)return -1;let a=e;for(;;){if("next"===t&&a===eo.length||"previous"===t&&-1===a)return -1;let e=ea.querySelector(`[data-tag-index="${a}"]`);if(e&&e.hasAttribute("tabindex")&&!e.disabled&&"true"!==e.getAttribute("aria-disabled"))return a;a+="next"===t?1:-1}}(a,t)),ek(a)},eD=e=>{Q.current=!0,ec(""),B&&B(e,"","clear"),e_(e,M?[]:null,"clear")},ez=e=>{ef(!0),V&&!Q.current&&eR(e)},eL=e=>{r(et)?ee.current.focus():(ef(!1),Z.current=!0,Q.current=!1,o&&-1!==es.current&&ev?eT(e,ew[es.current],"blur"):o&&A&&""!==eu?eT(e,eu,"blur","freeSolo"):u&&eh(e,eo),eO(e,"blur"))},eM=e=>{let t=e.target.value;eu!==t&&(ec(t),ey(!1),B&&B(e,t,"input")),""===t?h||M||e_(e,null,"clear"):eR(e)},eN=e=>{let t=Number(e.currentTarget.getAttribute("data-option-index"));es.current!==t&&eC({event:e,index:t,reason:"mouse"})},eW=e=>{eC({event:e,index:Number(e.currentTarget.getAttribute("data-option-index")),reason:"touch"}),eP.current=!0},eU=e=>{let t=Number(e.currentTarget.getAttribute("data-option-index"));eT(e,ew[t],"selectOption"),eP.current=!1},eB=e=>{eg?eO(e,"toggleInput"):eR(e)},eH=e=>{e.currentTarget.contains(e.target)&&e.target.getAttribute("id")!==J&&e.preventDefault()},eF=e=>{e.currentTarget.contains(e.target)&&(ee.current.focus(),q&&Z.current&&ee.current.selectionEnd-ee.current.selectionStart==0&&ee.current.select(),Z.current=!1)},eV=e=>{m||""!==eu&&eg||eB(e)},eG=A&&eu.length>0;eG=eG||(M?eo.length>0:null!==eo);let eY=ew;return P&&(eY=ew.reduce((e,t,a)=>{let r=P(t);return e.length>0&&e[e.length-1].group===r?e[e.length-1].options.push(t):e.push({key:a,index:a,group:r,options:[t]}),e},[])),m&&ep&&eL(),{getRootProps:(e={})=>(0,b.default)({"aria-owns":eS?`${J}-listbox`:null},e,{onKeyDown:t=>{if(e.onKeyDown&&e.onKeyDown(t),!t.defaultMuiPrevented&&(-1!==el&&-1===["ArrowLeft","ArrowRight"].indexOf(t.key)&&(en(-1),ek(-1)),229!==t.which))switch(t.key){case"Home":ev&&T&&(t.preventDefault(),eA({diff:"start",direction:"next",reason:"keyboard",event:t}));break;case"End":ev&&T&&(t.preventDefault(),eA({diff:"end",direction:"previous",reason:"keyboard",event:t}));break;case"PageUp":t.preventDefault(),eA({diff:-5,direction:"previous",reason:"keyboard",event:t}),eR(t);break;case"PageDown":t.preventDefault(),eA({diff:5,direction:"next",reason:"keyboard",event:t}),eR(t);break;case"ArrowDown":t.preventDefault(),eA({diff:1,direction:"next",reason:"keyboard",event:t}),eR(t);break;case"ArrowUp":t.preventDefault(),eA({diff:-1,direction:"previous",reason:"keyboard",event:t}),eR(t);break;case"ArrowLeft":eE(t,"previous");break;case"ArrowRight":eE(t,"next");break;case"Enter":if(-1!==es.current&&ev){let e=ew[es.current],a=!!O&&O(e);if(t.preventDefault(),a)return;eT(t,e,"selectOption"),i&&ee.current.setSelectionRange(ee.current.value.length,ee.current.value.length)}else A&&""!==eu&&!1===eb&&(M&&t.preventDefault(),eT(t,eu,"createOption","freeSolo"));break;case"Escape":ev?(t.preventDefault(),t.stopPropagation(),eO(t,"escape")):c&&(""!==eu||M&&eo.length>0)&&(t.preventDefault(),t.stopPropagation(),eD(t));break;case"Backspace":if(M&&!Y&&""===eu&&eo.length>0){let e=-1===el?eo.length-1:el,a=eo.slice();a.splice(e,1),e_(t,a,"removeOption",{option:eo[e]})}break;case"Delete":if(M&&!Y&&""===eu&&eo.length>0&&-1!==el){let e=eo.slice();e.splice(el,1),e_(t,e,"removeOption",{option:eo[el]})}}},onMouseDown:eH,onClick:eF}),getInputLabelProps:()=>({id:`${J}-label`,htmlFor:J}),getInputProps:()=>({id:J,value:eu,onBlur:eL,onFocus:ez,onChange:eM,onMouseDown:eV,"aria-activedescendant":ev?"":null,"aria-autocomplete":i?"both":"list","aria-controls":eS?`${J}-listbox`:void 0,"aria-expanded":eS,autoComplete:"off",ref:ee,autoCapitalize:"none",spellCheck:"false",role:"combobox",disabled:m}),getClearProps:()=>({tabIndex:-1,onClick:eD}),getPopupIndicatorProps:()=>({tabIndex:-1,onClick:eB}),getTagProps:({index:e})=>(0,b.default)({key:e,"data-tag-index":e,tabIndex:-1},!Y&&{onDelete:t=>{let a=eo.slice();a.splice(e,1),e_(t,a,"removeOption",{option:eo[e]})}}),getListboxProps:()=>({role:"listbox",id:`${J}-listbox`,"aria-labelledby":`${J}-label`,ref:eI,onMouseDown:e=>{e.preventDefault()}}),getOptionProps:({index:e,option:t})=>{let a=(M?eo:[eo]).some(e=>null!=e&&L(t,e)),r=!!O&&O(t);return{key:X(t),tabIndex:-1,role:"option",id:`${J}-option-${e}`,onMouseMove:eN,onClick:eU,onTouchStart:eW,"data-option-index":e,"aria-disabled":r,"aria-selected":a}},id:J,inputValue:eu,value:eo,dirty:eG,expanded:ev&&ea,popupOpen:ev,focused:ep||-1!==el,anchorEl:ea,setAnchorEl:er,focusedTag:el,groupedOptions:eY}}((0,b.default)({},c,{componentName:"Autocomplete"})),e9=!W&&!H&&eK&&!e_,e8=(!ep||!0===ec)&&!1!==ec,{onMouseDown:e5}=eU(),{ref:e3}=null!=ew?ew:{},e7=eG(),{ref:te}=e7,tt=(0,y.default)(e7,Z),ta=(0,X.default)(te,e3),tr=eg||(e=>{var t;return null!=(t=e.label)?t:e}),tl=(0,b.default)({},c,{disablePortal:G,expanded:eJ,focused:eZ,fullWidth:ef,getOptionLabel:tr,hasClearIcon:e9,hasPopupIcon:e8,inputFocused:-1===e0,popupOpen:eQ,size:eL}),tn=(e=>{let{classes:t,disablePortal:a,expanded:r,focused:l,fullWidth:n,hasClearIcon:i,hasPopupIcon:s,inputFocused:o,popupOpen:d,size:u}=e,c={root:["root",r&&"expanded",l&&"focused",n&&"fullWidth",i&&"hasClearIcon",s&&"hasPopupIcon"],inputRoot:["inputRoot"],input:["input",o&&"inputFocused"],tag:["tag",`tagSize${(0,E.default)(u)}`],endAdornment:["endAdornment"],clearIndicator:["clearIndicator"],popupIndicator:["popupIndicator",d&&"popupIndicatorOpen"],popper:["popper",a&&"popperDisablePortal"],paper:["paper"],listbox:["listbox"],loading:["loading"],noOptions:["noOptions"],option:["option"],groupLabel:["groupLabel"],groupUl:["groupUl"]};return(0,w.unstable_composeClasses)(c,K,t)})(tl);if(ek&&eq.length>0){let e=e=>(0,b.default)({className:tn.tag,disabled:H},eV(e));u=eD?eD(eq,e,tl):eq.map((t,a)=>(0,r.jsx)(B.default,(0,b.default)({label:tr(t),size:eL},e({index:a}),x)))}if(eb>-1&&Array.isArray(u)){let e=u.length-eb;!eZ&&e>0&&(u=u.splice(0,eb)).push((0,r.jsx)("span",{className:tn.tag,children:eh(e)},u.length))}let ti=eP||(e=>(0,r.jsxs)("li",{children:[(0,r.jsx)(ed,{className:tn.groupLabel,ownerState:tl,component:"div",children:e.group}),(0,r.jsx)(eu,{className:tn.groupUl,ownerState:tl,children:e.children})]},e.key)),ts=eE||((e,t)=>(0,r.jsx)("li",(0,b.default)({},e,{children:tr(t)}))),to=(e,t)=>{let a=eY({option:e,index:t});return ts((0,b.default)({},a,{className:tn.option}),e,{selected:a["aria-selected"],index:t,inputValue:e6},tl)},td=null!=(i=eM.clearIndicator)?i:M.clearIndicator,tu=null!=(s=eM.paper)?s:M.paper,tc=null!=(o=eM.popper)?o:M.popper,tp=null!=(d=eM.popupIndicator)?d:M.popupIndicator;return(0,r.jsxs)(l.Fragment,{children:[(0,r.jsx)(ee,(0,b.default)({ref:n,className:(0,v.default)(tn.root,A),ownerState:tl},eW(eN),{children:eT({id:eX,disabled:H,fullWidth:!0,size:"small"===eL?"small":void 0,InputLabelProps:eB(),InputProps:(0,b.default)({ref:e2,className:tn.inputRoot,startAdornment:u,onClick:e=>{e.target===e.currentTarget&&e5(e)}},(e9||e8)&&{endAdornment:(0,r.jsxs)(et,{className:tn.endAdornment,ownerState:tl,children:[e9?(0,r.jsx)(ea,(0,b.default)({},eF(),{"aria-label":z,title:z,ownerState:tl},td,{className:(0,v.default)(tn.clearIndicator,null==td?void 0:td.className),children:O})):null,e8?(0,r.jsx)(er,(0,b.default)({},eH(),{disabled:H,"aria-label":eQ?L:e$,title:eQ?L:e$,ownerState:tl},tp,{className:(0,v.default)(tn.popupIndicator,null==tp?void 0:tp.className),children:eO})):null]})}),inputProps:(0,b.default)({className:tn.input,disabled:H,readOnly:e_},eU())})})),e1?(0,r.jsx)(el,(0,b.default)({as:eR,disablePortal:G,style:{width:e1?e1.clientWidth:null},ownerState:tl,role:"presentation",anchorEl:e1,open:eQ},tc,{className:(0,v.default)(tn.popper,null==tc?void 0:tc.className),children:(0,r.jsxs)(en,(0,b.default)({ownerState:tl,as:eI},tu,{className:(0,v.default)(tn.paper,null==tu?void 0:tu.className),children:[ej&&0===e4.length?(0,r.jsx)(ei,{className:tn.loading,ownerState:tl,children:eS}):null,0!==e4.length||ep||ej?null:(0,r.jsx)(es,{className:tn.noOptions,ownerState:tl,role:"presentation",onMouseDown:e=>{e.preventDefault()},children:eC}),e4.length>0?(0,r.jsx)(eo,(0,b.default)({as:ev,className:tn.listbox,ownerState:tl},tt,ew,{ref:ta,children:e4.map((e,t)=>em?ti({key:e.key,group:e.group,children:e.options.map((t,a)=>to(t,e.index+a))}):to(e,t))})):null]}))})):null]})});var ep=e.i(1138),ef=e.i(70993),eh=e.i(60152),eg=e.i(14067),em=e.i(87695),ex=e.i(73743),ey=e.i(66769),eb=o,ev=e.i(71666),ew=e.i(73509),ej=e.i(12744),eS=e.i(95013),ek=e.i(77678),eC=e.i(91962),eA=e.i(54169),e$=e.i(81620),eI=e.i(71864),eR=e.i(61609),eO=e.i(24419),e_=e.i(93291),eP=e.i(21850);function eT({onRefreshRequested:e}){function t(e){if(!e)return"-";let t=String(e).trim(),a=/^(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2})(?::(\d{2}))?)?$/.exec(t),r=e=>String(e).padStart(2,"0");if(a){let[,e,t,l,n="00",i="00"]=a;return`${r(Number(l))}/${r(Number(t))}/${e} ${r(Number(n))}:${r(Number(i))}`}let l=new Date(t);return isNaN(l.getTime())?"-":`${r(l.getDate())}/${r(l.getMonth()+1)}/${l.getFullYear()} ${r(l.getHours())}:${r(l.getMinutes())}`}function a(e){if(null==e)return"";let t=String(e).toString();return"NEW"===t.toUpperCase().trim()?"PREPARATION":t}let[i,s]=(0,l.useState)([]),[o,d]=(0,l.useState)(!1),[u,c]=(0,l.useState)(null),[p,f]=(0,l.useState)([]),[h,y]=(0,l.useState)(""),[b,v]=(0,l.useState)([]),[w,j]=(0,l.useState)([]),[S,k]=(0,l.useState)(1),[C]=(0,l.useState)(10),[A,$]=(0,l.useState)(0),[I,R]=(0,l.useState)(""),[O,_]=(0,l.useState)(null),[P,T]=(0,l.useState)(!1),[E,D]=(0,l.useState)(""),[z,L]=(0,l.useState)([]),[M,N]=(0,l.useState)({open:!1,wo:null}),[W,H]=(0,l.useState)([]),[F,V]=(0,l.useState)(""),[G,Y]=(0,l.useState)({}),[q,K]=(0,l.useState)(void 0),[J,X]=(0,l.useState)(""),[Q,Z]=(0,l.useState)("");async function ee(e=S,t=I,r=h){d(!0),c(null);try{let l=new URLSearchParams;t&&l.set("q",t),l.set("page",String(e)),l.set("pageSize",String(C)),r&&l.set("location",r);let i=await (0,n.default)(`/work-orders?${l.toString()}`),o=Array.isArray(i)?i:i?.data??[],d=i&&"object"==typeof i&&!Array.isArray(i)?i.meta??{page:e,pageSize:C,total:0}:{page:e,pageSize:C,total:0},u=Array.isArray(o)?o:[],c=Array.from(new Set(u.map(e=>(e.vendor_cabang??e.raw?.vendor_cabang??"").toString().trim()).filter(Boolean))),p=Array.from(new Set(u.map(e=>a(e.status??e.raw?.status??"PREPARATION").toString().trim()).filter(Boolean)));v(p),f(c);let h=u;if(console.debug("test ",u),r){let e=r.toString().toLowerCase().trim();h=u.filter(t=>(t.vendor_cabang??t.raw?.vendor_cabang??"").toString().toLowerCase().trim()===e)}if(w&&w.length>0){let e=new Set(w.map(e=>e.toString().toUpperCase().replace(/[-\s]/g,"_")));h=h.filter(t=>{let r=a(t.status??t.raw?.status??"PREPARATION").toString().toString().toUpperCase().replace(/[-\s]/g,"_");return e.has(r)})}w&&0!==w.length||(h=h.filter(e=>{let t=a(e.status??e.raw?.status??"PREPARATION").toString().toString().toUpperCase().replace(/[-\s]/g,"_");return"COMPLETED"!==t})),s(h),$("number"==typeof d.total?d.total:0)}catch(e){console.error("load work orders",e),c(e?.body?.message||e?.message||"Gagal memuat")}finally{d(!1)}}(0,l.useEffect)(()=>{ee(1,I),k(1)},[I,h,w]),(0,l.useEffect)(()=>{"function"==typeof e&&e(async()=>{await ee(1,I,h),k(1)})},[]);let[et,ea]=(0,l.useState)(!1);(0,l.useEffect)(()=>{function e(){ea(window.innerWidth<800)}return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let[er,el]=(0,l.useState)({});function en(e){el(t=>({...t,[e]:!t[e]}))}let[ei,es]=(0,l.useState)(null);function eo(){es(null)}function ed(e){_(e),D(""),X(eE(e.start_date)),Z(eE(e.end_date)),(async()=>{try{let t=await (0,n.default)(`/work-orders/${encodeURIComponent(e.id)}/date-history`),a=t?.data??t;Array.isArray(a)?L(a):L([])}catch(e){L([])}})()}function eu(e){if(console.debug("[openTaskModal]"),console.debug("workorder:",e),!e.start_date){alert("Work Order belum memiliki Start Date. Isi Start Date dan End Date terlebih dahulu."),_(e);return}V(""),H([]),Y({}),N({open:!0,wo:e}),(async()=>{let t=[];try{let a=e.vendor_cabang??e.raw?.vendor_cabang??e.raw?.site??"",r=String(a||"").toLowerCase().trim(),l=e=>String(e).padStart(2,"0"),i=function(e){if(!e)return null;let t=String(e).trim(),a=/^(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2})(?::(\d{2}))?)?$/.exec(t);if(a){let[,e,t,r,l="00",n="00",i="00"]=a,s=new Date(Date.UTC(Number(e),Number(t)-1,Number(r),Number(l),Number(n),Number(i)));return new Date(s.getTime()+0)}let r=new Date(t);return isNaN(r.getTime())?null:new Date(r.getTime()+0)}(String(e.start_date));if(!i){alert("Start Date tidak valid. Isi Start Date yang benar terlebih dahulu."),_(e);return}let s=`${i.getUTCFullYear()}-${l(i.getUTCMonth()+1)}-${l(i.getUTCDate())}`,o=`${l(i.getUTCHours())}:${l(i.getUTCMinutes())}`;console.debug("[openTaskModal] assignDate/time (local)",{assignDate:s,assignTime:o,raw:e.start_date});let d=`/scheduled-technicians?date=${encodeURIComponent(s)}&time=${encodeURIComponent(o)}`+(r?`&site=${encodeURIComponent(r)}`:"");console.debug(d);try{console.debug("[openTaskModal] fetching scheduled technicians",{schedUrl:d});let e=await (0,n.default)(d);console.debug(e);let a=Array.isArray(e)?e:e?.data??[];console.debug("[openTaskModal] scheduled-technicians response",{count:Array.isArray(a)?a.length:0}),a&&a.length>0?(t=a,console.debug("[openTaskModal] using scheduled-technicians sample",a.slice(0,5))):t=a}catch(r){console.warn("scheduled-technicians fetch failed, falling back",r);let e=await (0,n.default)("/users?role=technician"),a=Array.isArray(e)?e:e?.data??[];console.debug("[openTaskModal] fallback /users?role=technician response",{count:Array.isArray(a)?a.length:0}),t=a}console.debug("[openTaskModal] final filteredTechs",{count:t.length,sample:t.slice(0,5)}),H(t)}catch(e){console.warn("Failed to load technicians from shift assignments",e),H([]),t=[]}try{let a=await (0,n.default)(`/work-orders/${encodeURIComponent(e.id)}`),r=a?.data??a;try{console.debug("[openTaskModal] fetching tasks for workorder",{workOrderId:e.id});let t=await (0,n.default)(`/work-orders/${encodeURIComponent(e.id)}/tasks`),a=Array.isArray(t)?t:t?.data??[];console.debug("[openTaskModal] tasks fetch result",{count:Array.isArray(a)?a.length:0,sample:a.slice(0,5)}),r.tasks=a}catch(t){console.debug("[openTaskModal] /tasks fetch failed, falling back to raw.activities",t);let e=Array.isArray(r.raw?.activities)?r.raw.activities:[];r.tasks=e.map((e,t)=>({id:`raw-${t}`,name:e.task_name||e.name||`Task ${t+1}`,duration_min:e.task_duration}))}N({open:!0,wo:r});let l={},i=Array.isArray(r.tasks)?r.tasks:[],s=new Set((Array.isArray(t)?t:[]).map(e=>String(e.id)));for(let e of(console.debug("[openTaskModal] building selectedAssignees from task.assignments",{taskCount:i.length,techIdsCount:s.size}),i)){let t=String(e.id??e.task_id??e.external_id??"");if(!t)continue;let a=Array.isArray(e.assignments)?e.assignments:[],r=[];for(let e of a){let a=String(e?.user?.id??e.user_id??e.userId??"");if(a){if(!s.has(a)){console.debug("[openTaskModal] skipping assignment because assignee not in filtered technicians",{assId:a,key:t});continue}r.includes(a)||r.push(a)}}r.length>0&&(l[t]=r)}console.debug("[openTaskModal] selectedAssignees prepared",l),Y(l)}catch(e){console.warn("Failed to load workorder detail",e)}try{let e=await (0,n.default)("/auth/me");K(e?.data??e)}catch(e){K(null)}})()}async function eT(e,t,a){T(!0);try{let r={};void 0!==t&&(r.start_date=t||null),void 0!==a&&(r.end_date=a||null),E&&E.trim().length&&(r.note=E.trim()),await (0,n.default)(`/work-orders/${encodeURIComponent(e)}`,{method:"PATCH",body:r}),ee(S,I),_(null)}catch(e){console.error("save edit",e),alert("Gagal menyimpan: "+(e?.body?.message||e?.message))}finally{T(!1)}}function eE(e){if(!e)return"";let t=String(e).trim(),a=/^(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2})(?::(\d{2}))?)?$/.exec(t),r=e=>String(e).padStart(2,"0");if(a){let[,e,t,l,n="00",i="00"]=a;return`${e}-${t}-${l}T${r(Number(n))}:${r(Number(i))}`}let l=new Date(t);return isNaN(l.getTime())?"":`${l.getFullYear()}-${r(l.getMonth()+1)}-${r(l.getDate())}T${r(l.getHours())}:${r(l.getMinutes())}`}function eD(e){switch(a(e).toString().toUpperCase()){case"ASSIGNED":return"#1e40af";case"DEPLOYED":return"#db2777";case"READY_TO_DEPLOY":return"#7c3aed";case"IN_PROGRESS":case"IN-PROGRESS":return"#f97316";case"COMPLETED":return"#10b981";case"PREPARATION":case"OPEN":return"#64748b";case"CANCELLED":return"#ef4444";case"CLOSED":return"#334155";default:return"#6b7280"}}function ez(e){let t=(e?.status??e?.raw?.status??"").toString().toUpperCase().replace(/[-\s]/g,"_");return"IN_PROGRESS"!==t&&"COMPLETED"!==t}function eL(e){let t=a(e),l=eD(t);return(0,r.jsx)("span",{style:{display:"inline-block",padding:"4px 8px",borderRadius:999,background:l,color:"white",fontSize:10,fontWeight:600},children:String(t).replace(/_/g," ")})}async function eM(e){try{await (0,n.default)(`/work-orders/${encodeURIComponent(e)}/deploy`,{method:"POST"});let t=await (0,n.default)(`/work-orders/${encodeURIComponent(e)}`),a=t?.data??t,r=await (0,n.default)(`/work-orders/${encodeURIComponent(e)}/tasks`),l=Array.isArray(r)?r:r?.data??[];N(e=>({...e||{},wo:{...e?.wo||{},...a,tasks:l}})),ee(S,I)}catch(e){console.error("deploy failed",e),alert("Deploy gagal: "+(e?.message||e))}}async function eN(e){try{await (0,n.default)(`/work-orders/${encodeURIComponent(e)}/undeploy`,{method:"POST"});let t=await (0,n.default)(`/work-orders/${encodeURIComponent(e)}`),a=t?.data??t,r=await (0,n.default)(`/work-orders/${encodeURIComponent(e)}/tasks`),l=Array.isArray(r)?r:r?.data??[];N(e=>({...e||{},wo:{...e?.wo||{},...a,tasks:l}})),ee(S,I)}catch(e){console.error("undeploy failed",e),alert("Undeploy gagal: "+(e?.message||e))}}return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{style:{display:"flex",gap:8,marginBottom:12,alignItems:"center"},children:[(0,r.jsxs)(g.default,{sx:{display:"flex",gap:2,flexWrap:"wrap",mb:2},children:[(0,r.jsxs)(ep.default,{value:h,onChange:e=>y(String(e.target.value)),displayEmpty:!0,size:"small",sx:{minWidth:180},children:[(0,r.jsx)(ef.default,{value:"",children:"Semua Lokasi"}),p.map(e=>(0,r.jsx)(ef.default,{value:e,children:e},e))]}),(0,r.jsx)(ep.default,{multiple:!0,displayEmpty:!0,size:"small",value:w,onChange:e=>j("string"==typeof e.target.value?e.target.value.split(","):e.target.value),renderValue:e=>e&&e.length>0?(0,r.jsx)(g.default,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:e.map(e=>(0,r.jsx)(B.default,{label:e,size:"small"},e))}):"Semua Status",sx:{minWidth:220},children:["PREPARATION","ASSIGNED","READY TO DEPLOY","DEPLOYED","IN PROGRESS","COMPLETED"].map(e=>(0,r.jsxs)(ef.default,{value:e,children:[(0,r.jsx)(eA.default,{checked:w.indexOf(e)>-1}),e]},e))}),(0,r.jsx)(x.default,{placeholder:"Search doc_no / asset / desc",value:I,onChange:e=>R(e.target.value),size:"small",sx:{flex:1,minWidth:240}}),(0,r.jsx)(eh.default,{variant:"contained",color:"primary",size:"small",onClick:()=>ee(1,I),disabled:o,children:"Search"}),(0,r.jsx)(eh.default,{variant:"outlined",size:"small",onClick:()=>ee(1,I),disabled:o,children:"Refresh"}),(0,r.jsxs)(g.default,{sx:{alignSelf:"center",ml:"auto",color:"text.secondary"},children:[A," item"]})]}),o?(0,r.jsx)(eI.default,{variant:"body2",children:"Loading..."}):null,u?(0,r.jsx)(eI.default,{variant:"body2",color:"error",children:u}):null]}),(0,r.jsxs)("div",{children:[et?(0,r.jsx)(g.default,{sx:{display:"flex",flexDirection:"column",gap:2},children:i.map(e=>{let l,n,i=e.raw?.activities??[],s=a(e.status??e.raw?.status??"PREPARATION").toString(),o=s.toUpperCase().replace(/[-\s]/g,"_");return(0,r.jsx)(m.default,{sx:{p:2},children:(0,r.jsxs)(g.default,{sx:{display:"flex",gap:2,alignItems:"flex-start",justifyContent:"space-between"},children:[(0,r.jsxs)(g.default,{sx:{flex:1},children:[(0,r.jsxs)("div",{style:{fontWeight:700},children:[e.doc_no??e.id," — ",e.asset_name??"-"]}),(0,r.jsx)("div",{style:{color:"#666",marginTop:6},children:e.description??"-"}),(0,r.jsxs)(g.default,{sx:{display:"flex",gap:1,flexWrap:"wrap",mt:1},children:[(0,r.jsxs)("div",{style:{fontSize:12,color:"#666"},children:["Start: ",t(e.start_date)]}),(0,r.jsxs)("div",{style:{fontSize:12,color:"#666"},children:["End: ",t(e.end_date)]}),(0,r.jsx)("div",{children:eL(e.status??e.raw?.status??"PREPARATION")})]}),(0,r.jsxs)("div",{style:{marginTop:8},children:[(0,r.jsx)("div",{style:er[e.id]?{}:{maxHeight:"3em",overflow:"hidden"},children:e.description??"-"}),(0,r.jsx)(g.default,{sx:{display:"flex",gap:1,justifyContent:"flex-start",mt:1},children:(0,r.jsx)(eh.default,{size:"small",onClick:()=>en(e.id),children:er[e.id]?"Collapse":"Expand"})})]}),"IN_PROGRESS"===o&&"number"==typeof e.progress&&(0,r.jsx)(g.default,{sx:{mt:1},children:(l=Math.max(0,Math.min(1,e.progress||0)),n=eD(s),(0,r.jsxs)(g.default,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[(0,r.jsxs)(eI.default,{variant:"caption",sx:{fontWeight:700},children:[Math.round(100*l),"%"]}),(0,r.jsx)(e$.default,{variant:"determinate",value:Math.round(100*l),sx:{height:8,borderRadius:2,backgroundColor:"#f1f5f9","& .MuiLinearProgress-bar":{background:n}}})]}))})]}),(0,r.jsxs)(g.default,{sx:{display:"flex",flexDirection:"column",gap:1,alignItems:"flex-end"},children:[(0,r.jsxs)(g.default,{sx:{display:"flex",gap:1,flexWrap:"wrap",alignItems:"center"},children:[(0,r.jsx)(eh.default,{size:"small",onClick:()=>en(e.id),children:er[e.id]?"Collapse":"Expand"}),Array.isArray(i)&&i.length>0&&(0,r.jsx)(eR.default,{title:`Lihat Task (${i.length})`,children:(0,r.jsx)(U.default,{size:"small",onClick:()=>eu(e),"aria-label":`Lihat Task ${i.length}`,children:(0,r.jsx)(e_.default,{fontSize:"small"})})}),"IN_PROGRESS"!==o&&"COMPLETED"!==o&&"DEPLOYED"!==o&&(0,r.jsx)(eR.default,{title:"Edit Tanggal",children:(0,r.jsx)(U.default,{size:"small",color:"secondary",onClick:()=>ed(e),"aria-label":"Edit Dates",children:(0,r.jsx)(eP.default,{fontSize:"small"})})})]}),(0,r.jsx)("div",{style:{color:"#666",fontSize:12},children:e.vendor_cabang??e.raw?.vendor_cabang??"-"})]})]})},e.id)})}):(0,r.jsx)("div",{style:{overflowX:"hidden"},children:(0,r.jsx)(eS.default,{component:m.default,sx:{mb:2},children:(0,r.jsxs)(ev.default,{size:"small",sx:{tableLayout:"fixed",width:"100%"},children:[(0,r.jsx)(ek.default,{children:(0,r.jsxs)(eC.default,{children:[(0,r.jsx)(ej.default,{sx:{width:"12%"},children:"Doc No"}),(0,r.jsx)(ej.default,{sx:{width:"12%"},children:"Jenis Work Order"}),(0,r.jsx)(ej.default,{sx:{width:"9%"},children:"Start"}),(0,r.jsx)(ej.default,{sx:{width:"9%"},children:"End"}),(0,r.jsx)(ej.default,{sx:{width:"10%"},children:"Equipment"}),(0,r.jsx)(ej.default,{sx:{width:"8%"},children:"Status"}),(0,r.jsx)(ej.default,{sx:{width:"10%"},children:"Location"}),(0,r.jsx)(ej.default,{sx:{width:"24%",whiteSpace:"normal"},children:"Description"}),(0,r.jsx)(ej.default,{sx:{width:"8%"},children:"Action"})]})}),(0,r.jsx)(ew.default,{children:i.map(e=>{let l=e.raw?.activities??[],n=a(e.status??e.raw?.status??"PREPARATION").toString().toUpperCase().replace(/[-\s]/g,"_");return(0,r.jsxs)(eC.default,{hover:!0,children:[(0,r.jsx)(ej.default,{sx:{whiteSpace:"normal",overflowWrap:"anywhere",wordBreak:"break-word"},children:e.doc_no??e.id}),(0,r.jsx)(ej.default,{sx:{whiteSpace:"normal",overflowWrap:"anywhere",wordBreak:"break-word"},children:e.work_type??e.type_work??e.raw?.work_type??e.raw?.type_work??"-"}),(0,r.jsx)(ej.default,{sx:{whiteSpace:"normal",overflowWrap:"anywhere",wordBreak:"break-word"},children:t(e.start_date)}),(0,r.jsx)(ej.default,{sx:{whiteSpace:"normal",overflowWrap:"anywhere",wordBreak:"break-word"},children:t(e.end_date)}),(0,r.jsx)(ej.default,{sx:{whiteSpace:"normal",overflowWrap:"anywhere",wordBreak:"break-word"},children:e.asset_name??"-"}),(0,r.jsx)(ej.default,{sx:{whiteSpace:"normal",overflowWrap:"anywhere",wordBreak:"break-word"},children:eL(e.status??e.raw?.status??"PREPARATION")}),(0,r.jsx)(ej.default,{sx:{whiteSpace:"normal",overflowWrap:"anywhere",wordBreak:"break-word"},children:e.vendor_cabang??e.raw?.vendor_cabang??"-"}),(0,r.jsx)(ej.default,{sx:{whiteSpace:"normal",overflowWrap:"anywhere",wordBreak:"break-word"},children:e.description??"-"}),(0,r.jsx)(ej.default,{sx:{whiteSpace:"normal"},children:(0,r.jsxs)(g.default,{sx:{display:"flex",gap:1,flexWrap:"wrap",alignItems:"center"},children:[(0,r.jsx)(eR.default,{title:"Details",children:(0,r.jsx)(U.default,{size:"small",onClick:()=>{es(e)},"aria-label":"Details",children:(0,r.jsx)(eO.default,{fontSize:"small"})})}),Array.isArray(l)&&l.length>0&&(0,r.jsx)(eR.default,{title:`Lihat Task (${l.length})`,children:(0,r.jsx)(U.default,{size:"small",onClick:()=>eu(e),"aria-label":"Lihat Task",children:(0,r.jsx)(e_.default,{fontSize:"small"})})}),"IN_PROGRESS"!==n&&"COMPLETED"!==n&&"DEPLOYED"!==n&&(0,r.jsx)(eR.default,{title:"Edit Tanggal",children:(0,r.jsx)(U.default,{size:"small",color:"secondary",onClick:()=>ed(e),"aria-label":"Edit Dates",children:(0,r.jsx)(eP.default,{fontSize:"small"})})})]})})]},e.id)})})]})})}),(0,r.jsxs)(g.default,{sx:{display:"flex",gap:2,alignItems:"center"},children:[(0,r.jsx)(eh.default,{onClick:function(){S>1&&k(e=>{let t=e-1;return ee(t),t})},disabled:S<=1,size:"small",children:"Prev"}),(0,r.jsxs)(eI.default,{variant:"body2",children:["Page ",S," / ",Math.max(1,Math.ceil(A/C))]}),(0,r.jsx)(eh.default,{onClick:function(){S<Math.ceil(A/C)&&k(e=>{let t=e+1;return ee(t),t})},disabled:S>=Math.max(1,Math.ceil(A/C)),size:"small",children:"Next"})]})]}),M.open&&M.wo&&(0,r.jsx)("div",{style:{position:"fixed",left:0,right:0,top:0,bottom:0,background:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:2e3,padding:16},children:(0,r.jsxs)("div",{style:{background:"white",padding:16,width:"95%",maxWidth:900,borderRadius:8,maxHeight:"86vh",overflow:"auto",boxShadow:"0 6px 30px rgba(0,0,0,0.2)"},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:12,marginBottom:12},children:[(0,r.jsxs)("div",{style:{flex:1},children:[(0,r.jsxs)("h2",{style:{marginTop:0,marginBottom:6,fontSize:20},children:["Task - ",M.wo.doc_no??M.wo.id]}),(0,r.jsx)("div",{style:{color:"#666",fontSize:13},children:M.wo.description})]}),(0,r.jsxs)("div",{style:{textAlign:"right",minWidth:180},children:[(0,r.jsx)("div",{style:{fontSize:13,marginBottom:8},children:void 0===q?(0,r.jsx)("span",{style:{color:"#666"},children:"Checking auth..."}):null===q?(0,r.jsx)("span",{style:{color:"#c00"},children:"Not authenticated"}):(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{style:{fontWeight:700},children:q.name||q.username||q.email}),(0,r.jsxs)("div",{style:{color:"#666",fontSize:12},children:[q.email," — ",q.role??q.type]})]})}),(0,r.jsxs)("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[M.wo?.status==="READY_TO_DEPLOY"&&(0,r.jsx)("button",{onClick:()=>eM(M.wo.id),style:{padding:"6px 10px",background:"#7c3aed",color:"white",borderRadius:6},children:"Deploy"}),M.wo?.status==="DEPLOYED"&&(0,r.jsx)("button",{onClick:()=>eN(M.wo.id),style:{padding:"6px 10px",background:"#ef4444",color:"white",borderRadius:6},children:"Undeploy"}),(0,r.jsx)("button",{onClick:function(){N({open:!1,wo:null}),V("");try{ee(S,I)}catch(e){console.warn("Failed to refresh work order list after closing modal",e)}},style:{padding:"6px 10px"},children:"Close"})]})]})]}),(0,r.jsx)("div",{style:{marginBottom:8},children:(0,r.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",tableLayout:"fixed"},children:[(0,r.jsxs)("colgroup",{children:[(0,r.jsx)("col",{style:{width:"50px"}}),(0,r.jsx)("col",{}),(0,r.jsx)("col",{style:{width:"110px"}}),(0,r.jsx)("col",{style:{width:"340px"}})]}),(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{style:{background:"#f5f5f5"},children:[(0,r.jsx)("th",{style:{textAlign:"left",padding:12,borderBottom:"1px solid #ddd"},children:"No"}),(0,r.jsx)("th",{style:{textAlign:"left",padding:12,borderBottom:"1px solid #ddd"},children:"Task Name"}),(0,r.jsx)("th",{style:{textAlign:"left",padding:12,borderBottom:"1px solid #ddd",textAlignLast:"right"},children:"Duration (min)"}),ez(M.wo)&&(0,r.jsx)("th",{style:{textAlign:"left",padding:12,borderBottom:"1px solid #ddd"},children:"Assign technicians"})]})}),(0,r.jsx)("tbody",{children:Array.isArray(M.wo.tasks)&&M.wo.tasks.map((e,t)=>{let a,l=e.id??e.task_id??String(t);G[l];let i=function(e){try{for(let t of["realisasi","realisasis","realisasi_list","realisasi_entries","realisasiItems","realisasi_items","realisasiEntries"]){let a=e[t];if(Array.isArray(a)&&a.length>0)return!0}if(Array.isArray(e.assignments))for(let t of e.assignments){if(Array.isArray(t.realisasi)&&t.realisasi.length>0||(t.realisasi_count||t.realisasiCount||t.realisasiTotal)>0)return!0;let e=(t.status||t.state||"").toString().toUpperCase();if(e.includes("COMP")||e.includes("VERIF")||e.includes("DONE")||e.includes("APPROV"))return!0}let t=Array.isArray(M.wo?.assignments)?M.wo.assignments:[];if(t.length>0)for(let a of t){let t=a.task_id??a.taskId??a.task?.id?String(a.task_id??a.taskId??a.task?.id):null,r=e.id??e.task_id??e.external_id?String(e.id??e.task_id??e.external_id):null;if(t&&r&&t===r){if(Array.isArray(a.realisasi)&&a.realisasi.length>0||(a.realisasi_count||a.realisasiCount||a.realisasiTotal)>0)return!0;let e=(a.status||a.state||"").toString().toUpperCase();if(e.includes("COMP")||e.includes("VERIF")||e.includes("DONE")||e.includes("APPROV"))return!0}let l=(a.task_name||a.taskName||a.task?.name||"").toString().trim().toLowerCase(),n=(e.name||e.task_name||e.taskName||"").toString().trim().toLowerCase();if(l&&n&&l===n){if(Array.isArray(a.realisasi)&&a.realisasi.length>0||(a.realisasi_count||a.realisasiCount||a.realisasiTotal)>0)return!0;let e=(a.status||a.state||"").toString().toUpperCase();if(e.includes("COMP")||e.includes("VERIF")||e.includes("DONE")||e.includes("APPROV"))return!0}}if(!0===e.completed||!0===e.is_completed||String(e.status||"").toUpperCase().includes("COMP")||e.completed_at||e.realisasi_at||e.approved_at)return!0}catch(e){}return!1}(e)||!!(e.has_realisasi||e.realisasi_count);return(0,r.jsxs)("tr",{style:{borderBottom:"1px solid #f1f1f1"},children:[(0,r.jsx)("td",{style:{padding:12,verticalAlign:"top"},children:e.task_number??t+1}),(0,r.jsxs)("td",{style:{padding:12,verticalAlign:"top"},children:[(0,r.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,r.jsx)("div",{style:{fontWeight:700},children:e.name??e.task_name??"-"}),i?(0,r.jsx)("span",{style:{background:"#10b981",color:"white",padding:"2px 8px",borderRadius:999,fontSize:12,fontWeight:600},children:"Realisasi ✓"}):(a=Number(e.pending_realisasi_count||e.pendingCount||0),e.has_pending||a>0?(0,r.jsxs)("span",{style:{background:"#f59e0b",color:"white",padding:"2px 8px",borderRadius:999,fontSize:12,fontWeight:600},children:["Pending",a?` (${a})`:""]}):(0,r.jsx)("span",{style:{background:"#64748b",color:"white",padding:"2px 8px",borderRadius:999,fontSize:12,fontWeight:600},children:"Belum Realisasi"}))]}),(0,r.jsxs)("div",{style:{fontSize:12,color:"#888",marginTop:6},children:["ID: ",e.id??"-"]}),Array.isArray(e.assignments)&&e.assignments.length>0&&(0,r.jsx)("div",{style:{marginTop:8,display:"flex",gap:8,flexWrap:"wrap"},children:e.assignments.map(t=>(0,r.jsxs)("div",{style:{background:"#eef2ff",padding:"4px 8px",borderRadius:6,display:"flex",gap:8,alignItems:"center"},children:[(0,r.jsx)("span",{style:{fontSize:13,fontWeight:600},children:t.user?.name??t.user?.nipp??t.user?.email??t.assigned_to??"Unknown"}),q&&!["DEPLOYED","IN_PROGRESS"].includes((M.wo?.status??"").toString())&&(0,r.jsx)("button",{onClick:async()=>{try{await (0,n.default)(`/tasks/${encodeURIComponent(e.id)}/assign/${encodeURIComponent(t.id)}`,{method:"DELETE"})}catch(a){try{await (0,n.default)(`/tasks/${encodeURIComponent(e.id)}/assign/${encodeURIComponent(t.id)}`,{method:"DELETE"})}catch(e){console.error("unassign failed",e),alert("Unassign failed");return}}try{let e=await (0,n.default)(`/work-orders/${encodeURIComponent(M.wo?.id)}`),t=e?.data??e,a=await (0,n.default)(`/work-orders/${encodeURIComponent(M.wo?.id)}/tasks`),r=Array.isArray(a)?a:a?.data??[];N(e=>({...e||{},wo:{...e?.wo||{},...t,tasks:r}}))}catch(e){console.warn("refresh workorder after unassign failed",e)}},style:{background:"transparent",border:"none",color:"#c00",cursor:"pointer"},children:"Unassign"})]},t.id))})]}),(0,r.jsx)("td",{style:{padding:12,verticalAlign:"top",textAlign:"right"},children:e.duration_min??e.task_duration??"-"}),ez(M.wo)?(0,r.jsx)("td",{style:{padding:12,verticalAlign:"top"},children:(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[(0,r.jsx)(ec,{multiple:!0,options:W||[],getOptionLabel:e=>(e.name||e.nipp||e.email||"").toString(),filterSelectedOptions:!0,value:(G[l]||[]).map(e=>W.find(t=>t.id===e)).filter(Boolean),onChange:(e,t)=>Y(e=>({...e,[l]:t.map(e=>e.id)})),renderInput:e=>(0,r.jsx)(x.default,{...e,placeholder:"Cari teknisi (nama / email / id)",size:"small"})}),(0,r.jsx)("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginTop:8},children:(W||[]).slice(0,200).map(e=>{let t=(G[l]||[]).includes(e.id);return(0,r.jsx)(B.default,{label:(e.name||e.nipp||e.email||"").toString(),onClick:()=>{Y(t=>{let a=new Set(t[l]||[]);return a.has(e.id)?a.delete(e.id):a.add(e.id),{...t,[l]:Array.from(a)}})},clickable:!0,color:t?"primary":"default",variant:t?"filled":"outlined",size:"small",sx:{marginRight:.5}},e.id)})}),(0,r.jsx)("div",{style:{display:"flex",gap:8,justifyContent:"flex-start",marginTop:8},children:void 0===q?(0,r.jsx)(eh.default,{size:"small",disabled:!0,children:"Checking..."}):null===q?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eh.default,{size:"small",variant:"contained",color:"primary",onClick:()=>{window.location.href="/login"},children:"Login to assign"}),(0,r.jsx)(eh.default,{size:"small",onClick:()=>{Y(e=>({...e,[l]:[]}))},children:"Clear"})]}):["DEPLOYED","IN_PROGRESS"].includes((M.wo?.status??"").toString())?(0,r.jsx)(eh.default,{size:"small",disabled:!0,children:"Deployed"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eh.default,{size:"small",variant:"contained",onClick:async()=>{let a=G[l]||[];if(!a||0===a.length)return void alert("Pilih minimal 1 teknisi");try{for(let r of Array.from(new Set(a)))await (0,n.default)(`/tasks/${encodeURIComponent(e.id??e.task_id??String(t))}/assign`,{method:"POST",body:{userId:r,assignedBy:q?.id}});alert("Assignment created");try{let e=await (0,n.default)(`/work-orders/${encodeURIComponent(M.wo?.id)}`),t=e?.data??e,a=await (0,n.default)(`/work-orders/${encodeURIComponent(M.wo?.id)}/tasks`),r=Array.isArray(a)?a:a?.data??[];N(e=>({...e||{},wo:{...e?.wo||{},...t,tasks:r}}))}catch(e){console.warn("refresh tasks after assign failed",e)}ee(S,I)}catch(e){console.error("assign error",e),alert(e?.body?.message||e?.message||"Assignment failed")}},children:"Assign"}),(0,r.jsx)(eh.default,{size:"small",onClick:()=>{Y(e=>({...e,[l]:[]}))},children:"Clear"})]})})]})}):(0,r.jsx)("td",{style:{padding:12,verticalAlign:"top"}})]},t)})})]})})]})}),(0,r.jsxs)(eg.default,{open:!!ei,onClose:eo,fullWidth:!0,maxWidth:"sm",children:[(0,r.jsxs)(em.default,{children:["Details — ",ei?.doc_no??ei?.id]}),(0,r.jsx)(ex.default,{dividers:!0,children:ei?(0,r.jsxs)(g.default,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,r.jsx)("div",{style:{fontWeight:700},children:ei.asset_name??"-"}),(0,r.jsx)("div",{style:{color:"#666"},children:ei.description??"-"}),(0,r.jsxs)("div",{style:{color:"#666",fontSize:13},children:["Location: ",ei.vendor_cabang??ei.raw?.vendor_cabang??"-"]}),(0,r.jsxs)("div",{style:{color:"#666",fontSize:13},children:["Start: ",t(ei.start_date)]}),(0,r.jsxs)("div",{style:{color:"#666",fontSize:13},children:["End: ",t(ei.end_date)]}),(0,r.jsx)("div",{style:{marginTop:8},children:eL(ei.status??ei?.raw?.status??"PREPARATION")}),"number"==typeof ei.progress&&(0,r.jsxs)(g.default,{sx:{mt:1},children:[(0,r.jsxs)(eI.default,{variant:"caption",sx:{fontWeight:700},children:[Math.round(100*Math.max(0,Math.min(1,ei.progress||0))),"%"]}),(0,r.jsx)(e$.default,{variant:"determinate",value:Math.round(100*Math.max(0,Math.min(1,ei.progress||0))),sx:{height:8,borderRadius:2,backgroundColor:"#f1f5f9","& .MuiLinearProgress-bar":{background:eD(ei.status??ei?.raw?.status??"PREPARATION")}}})]})]}):null}),(0,r.jsxs)(ey.default,{children:[(0,r.jsx)(eh.default,{onClick:eo,children:"Close"}),(0,r.jsx)(eR.default,{title:"Edit Tanggal",children:(0,r.jsx)(U.default,{onClick:()=>{ei&&(ed(ei),eo())},"aria-label":"Edit Dates",children:(0,r.jsx)(eP.default,{})})}),ei&&Array.isArray(ei.raw?.activities)&&ei.raw.activities.length>0&&(0,r.jsx)(eR.default,{title:`Lihat Task (${(ei.raw?.activities||[]).length})`,children:(0,r.jsx)(U.default,{onClick:()=>{ei&&(eu(ei),eo())},"aria-label":"Lihat Task",children:(0,r.jsx)(e_.default,{})})})]})]}),(0,r.jsxs)(eg.default,{open:!!O,onClose:()=>_(null),fullWidth:!0,maxWidth:"sm",children:[(0,r.jsxs)(em.default,{children:["Edit Dates — ",O?.doc_no??O?.id]}),(0,r.jsx)(ex.default,{dividers:!0,children:(0,r.jsxs)(eb.default,{spacing:2,sx:{mt:1},children:[(0,r.jsx)(x.default,{label:"Start Date & Time",type:"datetime-local",size:"small",value:J,onChange:e=>X(e.target.value),InputLabelProps:{shrink:!0},fullWidth:!0}),(0,r.jsxs)("div",{style:{fontSize:12,color:"#666"},children:["Current: ",t(O?.start_date)]}),(0,r.jsx)(x.default,{label:"End Date & Time",type:"datetime-local",size:"small",value:Q,onChange:e=>Z(e.target.value),InputLabelProps:{shrink:!0},fullWidth:!0}),(0,r.jsxs)("div",{style:{fontSize:12,color:"#666"},children:["Current: ",t(O?.end_date)]}),(0,r.jsx)(x.default,{label:"Keterangan (opsional)",placeholder:"Alasan atau catatan perubahan tanggal",multiline:!0,rows:4,value:E,onChange:e=>D(e.target.value),fullWidth:!0,size:"small"}),Array.isArray(z)&&z.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"History perubahan tanggal"}),(0,r.jsx)("div",{style:{maxHeight:240,overflow:"auto"},children:z.map((e,a)=>(0,r.jsxs)("div",{style:{padding:12,borderBottom:"1px solid #f5f5f5"},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsx)("div",{style:{fontSize:13,color:"#333",fontWeight:700},children:e.changed_at?new Date(e.changed_at).toLocaleString():"-"}),(0,r.jsx)("div",{style:{fontSize:12,color:"#666"},children:e.changed_by?`${e.changed_by.nipp??e.changed_by.id??"-"} • ${e.changed_by.name??e.changed_by.email??"-"}`:"-"})]}),(0,r.jsxs)("div",{style:{marginTop:6,color:"#444"},children:[(0,r.jsxs)("div",{children:["Start: ",e.old_start?t(e.old_start):"-"," → ",e.new_start?t(e.new_start):"-"]}),(0,r.jsxs)("div",{children:["End: ",e.old_end?t(e.old_end):"-"," → ",e.new_end?t(e.new_end):"-"]})]}),e.note&&(0,r.jsxs)("div",{style:{marginTop:8,fontSize:13,color:"#555"},children:["Catatan: ",e.note]})]},e.id||a))})]})]})}),(0,r.jsxs)(ey.default,{sx:{p:2},children:[(0,r.jsx)(eh.default,{onClick:()=>_(null),disabled:P,children:"Batal"}),(0,r.jsx)(eh.default,{variant:"contained",color:"primary",onClick:async()=>{function e(e){if(!e)return null;let t=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2})$/.exec(e);if(!t)return null;let[,a,r,l,n,i]=t;return`${a}-${r}-${l} ${n}:${i}:00`}if(J&&!/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2})$/.test(J))return void alert("Start date tidak valid");if(Q&&!/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2})$/.test(Q))return void alert("End date tidak valid");let t=e(J||null),a=e(Q||null);await eT(O.id,t,a)},disabled:P,children:P?"Menyimpan...":"Simpan Perubahan"})]})]})]})}function eE(){let e=(0,l.useRef)(null);return(0,r.jsxs)("main",{style:{padding:24,fontFamily:'Inter, system-ui, -apple-system, Roboto, "Helvetica Neue", Arial'},children:[(0,r.jsx)("h1",{style:{marginBottom:12},children:"Work Orders"}),(0,r.jsx)("section",{style:{marginBottom:20},children:(0,r.jsx)(h,{onCreated:()=>e.current?.()})}),(0,r.jsx)("section",{children:(0,r.jsx)(eT,{onRefreshRequested:t=>e.current=t})})]})}e.s(["default",()=>eE],60855)}]);