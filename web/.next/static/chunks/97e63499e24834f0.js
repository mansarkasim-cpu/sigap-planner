(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,92081,(e,t,a)=>{"use strict";var r=e.r(7478);Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var n=r(e.r(87915)),l=e.r(14294);a.default=(0,n.default)((0,l.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"}),"Save")},54501,(e,t,a)=>{"use strict";var r=e.r(7478);Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var n=r(e.r(87915)),l=e.r(14294);a.default=(0,n.default)((0,l.jsx)("path",{d:"M11 21h-1l1-7H7.5c-.58 0-.57-.32-.38-.66.19-.34.05-.08.07-.12C8.48 10.94 10.42 7.54 13 3h1l-1 7h3.5c.49 0 .56.33.47.51l-.07.15C12.96 17.55 11 21 11 21z"}),"Bolt")},60855,e=>{"use strict";var t,a,r=e.i(14294),n=e.i(30878),l=e.i(23703),i=e.i(75696),o=e.i(36742),s=e.i(24268),s=s,d=e.i(61645),u=e.i(54073),u=u,c=e.i(87988),c=c,p=e.i(92081),f=e.i(54501);function g({onCreated:e}){let[t,a]=(0,n.useState)(""),[g,h]=(0,n.useState)(!1),[m,x]=(0,n.useState)(null);async function y(r){if(r.preventDefault(),x(null),!t.trim())return x("Masukkan id SIGAP");h(!0);try{let r=await (0,l.default)("/work-orders/add",{method:"POST",body:{id:t.trim()}});x("Work order tersimpan: "+(r?.data?.doc_no||r?.data?.id||"OK")),a(""),e?.()}catch(e){console.error("add error",e),x("Error: "+(e.body?.detail||e.body?.message||e.message||"gagal"))}finally{h(!1)}}return(0,r.jsx)(d.Paper,{elevation:2,sx:{p:2,mb:2},children:(0,r.jsx)("form",{onSubmit:y,children:(0,r.jsxs)(s.default,{direction:"row",spacing:2,alignItems:"center",children:[(0,r.jsx)(i.TextField,{value:t,onChange:e=>a(e.target.value),placeholder:"Masukkan id SIGAP (contoh: 1656)",disabled:g,size:"small",variant:"outlined",sx:{minWidth:320},InputProps:{startAdornment:(0,r.jsx)(c.default,{position:"start",children:(0,r.jsx)(f.default,{color:"primary"})})}}),(0,r.jsx)(o.Button,{type:"submit",variant:"contained",color:"primary",startIcon:(0,r.jsx)(p.default,{}),disabled:g,sx:{whiteSpace:"nowrap"},children:g?"Mengambil...":"Ambil & Simpan"}),m&&(0,r.jsx)(u.default,{severity:m.startsWith("Error")?"error":"success",sx:{ml:1},children:m})]})})})}var h=e.i(88627),m=e.i(28960),x=e.i(71606);e.i(50382);var y=e.i(79711),b=e.i(73161),v=e.i(30279),w=e.i(64848),S=e.i(45262),k=e.i(93243),j=e.i(1352),C=e.i(7775);function A(e){return void 0!==e.normalize?e.normalize("NFD").replace(/[\u0300-\u036f]/g,""):e}function $(e,t){for(let a=0;a<e.length;a+=1)if(t(e[a]))return a;return -1}let I=function(e={}){let{ignoreAccents:t=!0,ignoreCase:a=!0,limit:r,matchFrom:n="any",stringify:l,trim:i=!1}=e;return(e,{inputValue:o,getOptionLabel:s})=>{let d=i?o.trim():o;a&&(d=d.toLowerCase()),t&&(d=A(d));let u=d?e.filter(e=>{let r=(l||s)(e);return a&&(r=r.toLowerCase()),t&&(r=A(r)),"start"===n?0===r.indexOf(d):r.indexOf(d)>-1}):e;return"number"==typeof r?u.slice(0,r):u}}(),R=e=>{var t;return null!==e.current&&(null==(t=e.current.parentElement)?void 0:t.contains(document.activeElement))};var O=e.i(42735),P=e.i(44734),T=e.i(28569),_=e.i(56568),E=e.i(30352),D=e.i(20455),L=e.i(75964);function N(e){return(0,L.default)("MuiListSubheader",e)}(0,D.default)("MuiListSubheader",["root","colorPrimary","colorInherit","gutters","inset","sticky"]);let M=["className","color","component","disableGutters","disableSticky","inset"],z=(0,T.default)("li",{name:"MuiListSubheader",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:a}=e;return[t.root,"default"!==a.color&&t[`color${(0,E.default)(a.color)}`],!a.disableGutters&&t.gutters,a.inset&&t.inset,!a.disableSticky&&t.sticky]}})(({theme:e,ownerState:t})=>(0,b.default)({boxSizing:"border-box",lineHeight:"48px",listStyle:"none",color:(e.vars||e).palette.text.secondary,fontFamily:e.typography.fontFamily,fontWeight:e.typography.fontWeightMedium,fontSize:e.typography.pxToRem(14)},"primary"===t.color&&{color:(e.vars||e).palette.primary.main},"inherit"===t.color&&{color:"inherit"},!t.disableGutters&&{paddingLeft:16,paddingRight:16},t.inset&&{paddingLeft:72},!t.disableSticky&&{position:"sticky",top:0,zIndex:1,backgroundColor:(e.vars||e).palette.background.paper})),U=n.forwardRef(function(e,t){let a=(0,_.default)({props:e,name:"MuiListSubheader"}),{className:n,color:l="default",component:i="li",disableGutters:o=!1,disableSticky:s=!1,inset:d=!1}=a,u=(0,y.default)(a,M),c=(0,b.default)({},a,{color:l,component:i,disableGutters:o,disableSticky:s,inset:d}),p=(e=>{let{classes:t,color:a,disableGutters:r,inset:n,disableSticky:l}=e,i={root:["root","default"!==a&&`color${(0,E.default)(a)}`,!r&&"gutters",n&&"inset",!l&&"sticky"]};return(0,w.unstable_composeClasses)(i,N,t)})(c);return(0,r.jsx)(z,(0,b.default)({as:i,className:(0,v.default)(p.root,n),ref:t,ownerState:c},u))});U.muiSkipListHighlight=!0;var W=e.i(22921),B=e.i(65250),H=e.i(87220),F=e.i(29248),G=e.i(42882),V=e.i(79939),Y=e.i(11724),q=e.i(65515);function K(e){return(0,L.default)("MuiAutocomplete",e)}let J=(0,e.i(27605).unstable_generateUtilityClasses)("MuiAutocomplete",["root","expanded","fullWidth","focused","focusVisible","tag","tagSizeSmall","tagSizeMedium","hasPopupIcon","hasClearIcon","inputRoot","input","inputFocused","endAdornment","clearIndicator","popupIndicator","popupIndicatorOpen","popper","popperDisablePortal","paper","listbox","loading","noOptions","option","groupLabel","groupUl"]);var X=e.i(85537);let Q=["autoComplete","autoHighlight","autoSelect","blurOnSelect","ChipProps","className","clearIcon","clearOnBlur","clearOnEscape","clearText","closeText","componentsProps","defaultValue","disableClearable","disableCloseOnSelect","disabled","disabledItemsFocusable","disableListWrap","disablePortal","filterOptions","filterSelectedOptions","forcePopupIcon","freeSolo","fullWidth","getLimitTagsText","getOptionDisabled","getOptionLabel","isOptionEqualToValue","groupBy","handleHomeEndKeys","id","includeInputInList","inputValue","limitTags","ListboxComponent","ListboxProps","loading","loadingText","multiple","noOptionsText","onChange","onClose","onHighlightChange","onInputChange","onOpen","open","openOnFocus","openText","options","PaperComponent","PopperComponent","popupIcon","readOnly","renderGroup","renderInput","renderOption","renderTags","selectOnFocus","size","slotProps","value"],Z=["ref"],ee=(0,T.default)("div",{name:"MuiAutocomplete",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:a}=e,{fullWidth:r,hasClearIcon:n,hasPopupIcon:l,inputFocused:i,size:o}=a;return[{[`& .${J.tag}`]:t.tag},{[`& .${J.tag}`]:t[`tagSize${(0,E.default)(o)}`]},{[`& .${J.inputRoot}`]:t.inputRoot},{[`& .${J.input}`]:t.input},{[`& .${J.input}`]:i&&t.inputFocused},t.root,r&&t.fullWidth,l&&t.hasPopupIcon,n&&t.hasClearIcon]}})(({ownerState:e})=>(0,b.default)({[`&.${J.focused} .${J.clearIndicator}`]:{visibility:"visible"},"@media (pointer: fine)":{[`&:hover .${J.clearIndicator}`]:{visibility:"visible"}}},e.fullWidth&&{width:"100%"},{[`& .${J.tag}`]:(0,b.default)({margin:3,maxWidth:"calc(100% - 6px)"},"small"===e.size&&{margin:2,maxWidth:"calc(100% - 4px)"}),[`& .${J.inputRoot}`]:{flexWrap:"wrap",[`.${J.hasPopupIcon}&, .${J.hasClearIcon}&`]:{paddingRight:30},[`.${J.hasPopupIcon}.${J.hasClearIcon}&`]:{paddingRight:56},[`& .${J.input}`]:{width:0,minWidth:30}},[`& .${H.default.root}`]:{paddingBottom:1,"& .MuiInput-input":{padding:"4px 4px 4px 0px"}},[`& .${H.default.root}.${F.default.sizeSmall}`]:{[`& .${H.default.input}`]:{padding:"2px 4px 3px 0"}},[`& .${G.default.root}`]:{padding:9,[`.${J.hasPopupIcon}&, .${J.hasClearIcon}&`]:{paddingRight:39},[`.${J.hasPopupIcon}.${J.hasClearIcon}&`]:{paddingRight:65},[`& .${J.input}`]:{padding:"7.5px 4px 7.5px 5px"},[`& .${J.endAdornment}`]:{right:9}},[`& .${G.default.root}.${F.default.sizeSmall}`]:{paddingTop:6,paddingBottom:6,paddingLeft:6,[`& .${J.input}`]:{padding:"2.5px 4px 2.5px 8px"}},[`& .${V.default.root}`]:{paddingTop:19,paddingLeft:8,[`.${J.hasPopupIcon}&, .${J.hasClearIcon}&`]:{paddingRight:39},[`.${J.hasPopupIcon}.${J.hasClearIcon}&`]:{paddingRight:65},[`& .${V.default.input}`]:{padding:"7px 4px"},[`& .${J.endAdornment}`]:{right:9}},[`& .${V.default.root}.${F.default.sizeSmall}`]:{paddingBottom:1,[`& .${V.default.input}`]:{padding:"2.5px 4px"}},[`& .${F.default.hiddenLabel}`]:{paddingTop:8},[`& .${V.default.root}.${F.default.hiddenLabel}`]:{paddingTop:0,paddingBottom:0,[`& .${J.input}`]:{paddingTop:16,paddingBottom:17}},[`& .${V.default.root}.${F.default.hiddenLabel}.${F.default.sizeSmall}`]:{[`& .${J.input}`]:{paddingTop:8,paddingBottom:9}},[`& .${J.input}`]:(0,b.default)({flexGrow:1,textOverflow:"ellipsis",opacity:0},e.inputFocused&&{opacity:1})})),et=(0,T.default)("div",{name:"MuiAutocomplete",slot:"EndAdornment",overridesResolver:(e,t)=>t.endAdornment})({position:"absolute",right:0,top:"calc(50% - 14px)"}),ea=(0,T.default)(W.default,{name:"MuiAutocomplete",slot:"ClearIndicator",overridesResolver:(e,t)=>t.clearIndicator})({marginRight:-2,padding:4,visibility:"hidden"}),er=(0,T.default)(W.default,{name:"MuiAutocomplete",slot:"PopupIndicator",overridesResolver:({ownerState:e},t)=>(0,b.default)({},t.popupIndicator,e.popupOpen&&t.popupIndicatorOpen)})(({ownerState:e})=>(0,b.default)({padding:2,marginRight:-2},e.popupOpen&&{transform:"rotate(180deg)"})),en=(0,T.default)(P.default,{name:"MuiAutocomplete",slot:"Popper",overridesResolver:(e,t)=>{let{ownerState:a}=e;return[{[`& .${J.option}`]:t.option},t.popper,a.disablePortal&&t.popperDisablePortal]}})(({theme:e,ownerState:t})=>(0,b.default)({zIndex:(e.vars||e).zIndex.modal},t.disablePortal&&{position:"absolute"})),el=(0,T.default)(m.default,{name:"MuiAutocomplete",slot:"Paper",overridesResolver:(e,t)=>t.paper})(({theme:e})=>(0,b.default)({},e.typography.body1,{overflow:"auto"})),ei=(0,T.default)("div",{name:"MuiAutocomplete",slot:"Loading",overridesResolver:(e,t)=>t.loading})(({theme:e})=>({color:(e.vars||e).palette.text.secondary,padding:"14px 16px"})),eo=(0,T.default)("div",{name:"MuiAutocomplete",slot:"NoOptions",overridesResolver:(e,t)=>t.noOptions})(({theme:e})=>({color:(e.vars||e).palette.text.secondary,padding:"14px 16px"})),es=(0,T.default)("div",{name:"MuiAutocomplete",slot:"Listbox",overridesResolver:(e,t)=>t.listbox})(({theme:e})=>({listStyle:"none",margin:0,padding:"8px 0",maxHeight:"40vh",overflow:"auto",position:"relative",[`& .${J.option}`]:{minHeight:48,display:"flex",overflow:"hidden",justifyContent:"flex-start",alignItems:"center",cursor:"pointer",paddingTop:6,boxSizing:"border-box",outline:"0",WebkitTapHighlightColor:"transparent",paddingBottom:6,paddingLeft:16,paddingRight:16,[e.breakpoints.up("sm")]:{minHeight:"auto"},[`&.${J.focused}`]:{backgroundColor:(e.vars||e).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},'&[aria-disabled="true"]':{opacity:(e.vars||e).palette.action.disabledOpacity,pointerEvents:"none"},[`&.${J.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},'&[aria-selected="true"]':{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:(0,O.alpha)(e.palette.primary.main,e.palette.action.selectedOpacity),[`&.${J.focused}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:(0,O.alpha)(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:(e.vars||e).palette.action.selected}},[`&.${J.focusVisible}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.focusOpacity}))`:(0,O.alpha)(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.focusOpacity)}}}})),ed=(0,T.default)(U,{name:"MuiAutocomplete",slot:"GroupLabel",overridesResolver:(e,t)=>t.groupLabel})(({theme:e})=>({backgroundColor:(e.vars||e).palette.background.paper,top:-8})),eu=(0,T.default)("ul",{name:"MuiAutocomplete",slot:"GroupUl",overridesResolver:(e,t)=>t.groupUl})({padding:0,[`& .${J.option}`]:{paddingLeft:24}}),ec=n.forwardRef(function(e,l){var i,o,s,d;let u,c=(0,_.default)({props:e,name:"MuiAutocomplete"}),{autoComplete:p=!1,autoHighlight:f=!1,autoSelect:g=!1,blurOnSelect:h=!1,ChipProps:x,className:A,clearIcon:O=t||(t=(0,r.jsx)(Y.default,{fontSize:"small"})),clearOnBlur:T=!c.freeSolo,clearOnEscape:D=!1,clearText:L="Clear",closeText:N="Close",componentsProps:M={},defaultValue:z=c.multiple?[]:null,disableClearable:U=!1,disableCloseOnSelect:W=!1,disabled:H=!1,disabledItemsFocusable:F=!1,disableListWrap:G=!1,disablePortal:V=!1,filterSelectedOptions:J=!1,forcePopupIcon:ec="auto",freeSolo:ep=!1,fullWidth:ef=!1,getLimitTagsText:eg=e=>`+${e}`,getOptionLabel:eh,groupBy:em,handleHomeEndKeys:ex=!c.freeSolo,includeInputInList:ey=!1,limitTags:eb=-1,ListboxComponent:ev="ul",ListboxProps:ew,loading:eS=!1,loadingText:ek="Loading…",multiple:ej=!1,noOptionsText:eC="No options",openOnFocus:eA=!1,openText:e$="Open",PaperComponent:eI=m.default,PopperComponent:eR=P.default,popupIcon:eO=a||(a=(0,r.jsx)(q.default,{})),readOnly:eP=!1,renderGroup:eT,renderInput:e_,renderOption:eE,renderTags:eD,selectOnFocus:eL=!c.freeSolo,size:eN="medium",slotProps:eM={}}=c,ez=(0,y.default)(c,Q),{getRootProps:eU,getInputProps:eW,getInputLabelProps:eB,getPopupIndicatorProps:eH,getClearProps:eF,getTagProps:eG,getListboxProps:eV,getOptionProps:eY,value:eq,dirty:eK,expanded:eJ,id:eX,popupOpen:eQ,focused:eZ,focusedTag:e0,anchorEl:e1,setAnchorEl:e2,inputValue:e6,groupedOptions:e4}=function(e){var t;let a,{unstable_isActiveElementInListbox:r=R,unstable_classNamePrefix:l="Mui",autoComplete:i=!1,autoHighlight:o=!1,autoSelect:s=!1,blurOnSelect:d=!1,clearOnBlur:u=!e.freeSolo,clearOnEscape:c=!1,componentName:p="useAutocomplete",defaultValue:f=e.multiple?[]:null,disableClearable:g=!1,disableCloseOnSelect:h=!1,disabled:m,disabledItemsFocusable:x=!1,disableListWrap:y=!1,filterOptions:v=I,filterSelectedOptions:w=!1,freeSolo:A=!1,getOptionDisabled:O,getOptionLabel:P=e=>{var t;return null!=(t=e.label)?t:e},groupBy:T,handleHomeEndKeys:_=!e.freeSolo,id:E,includeInputInList:D=!1,inputValue:L,isOptionEqualToValue:N=(e,t)=>e===t,multiple:M=!1,onChange:z,onClose:U,onHighlightChange:W,onInputChange:B,onOpen:H,open:F,openOnFocus:G=!1,options:V,readOnly:Y=!1,selectOnFocus:q=!e.freeSolo,value:K}=e,J=(0,C.unstable_useId)(E),X=P;X=e=>{let t=P(e);return"string"!=typeof t?String(t):t};let Q=n.useRef(!1),Z=n.useRef(!0),ee=n.useRef(null),et=n.useRef(null),[ea,er]=n.useState(null),[en,el]=n.useState(-1),ei=o?0:-1,eo=n.useRef(ei),[es,ed]=(0,j.unstable_useControlled)({controlled:K,default:f,name:p}),[eu,ec]=(0,j.unstable_useControlled)({controlled:L,default:"",name:p,state:"inputValue"}),[ep,ef]=n.useState(!1),eg=n.useCallback((e,t)=>{let a;if((M?es.length<t.length:null!==t)||u){if(M)a="";else if(null==t)a="";else{let e=X(t);a="string"==typeof e?e:""}eu!==a&&(ec(a),B&&B(e,a,"reset"))}},[X,eu,M,B,ec,u,es]),[eh,em]=(0,j.unstable_useControlled)({controlled:F,default:!1,name:p,state:"open"}),[ex,ey]=n.useState(!0),eb=!M&&null!=es&&eu===X(es),ev=eh&&!Y,ew=ev?v(V.filter(e=>!(w&&(M?es:[es]).some(t=>null!==t&&N(e,t)))),{inputValue:eb&&ex?"":eu,getOptionLabel:X}):[],eS=(t={filteredOptions:ew,value:es,inputValue:eu},a=n.useRef({}),n.useEffect(()=>{a.current=t}),a.current);n.useEffect(()=>{let e=es!==eS.value;ep&&!e||(!A||e)&&eg(null,es)},[es,eg,ep,eS.value,A]);let ek=eh&&ew.length>0&&!Y,ej=(0,k.unstable_useEventCallback)(e=>{-1===e?ee.current.focus():ea.querySelector(`[data-tag-index="${e}"]`).focus()});n.useEffect(()=>{M&&en>es.length-1&&(el(-1),ej(-1))},[es,M,en,ej]);let eC=(0,k.unstable_useEventCallback)(({event:e,index:t,reason:a="auto"})=>{if(eo.current=t,-1===t?ee.current.removeAttribute("aria-activedescendant"):ee.current.setAttribute("aria-activedescendant",`${J}-option-${t}`),W&&W(e,-1===t?null:ew[t],a),!et.current)return;let r=et.current.querySelector(`[role="option"].${l}-focused`);r&&(r.classList.remove(`${l}-focused`),r.classList.remove(`${l}-focusVisible`));let n=et.current;if("listbox"!==et.current.getAttribute("role")&&(n=et.current.parentElement.querySelector('[role="listbox"]')),!n)return;if(-1===t){n.scrollTop=0;return}let i=et.current.querySelector(`[data-option-index="${t}"]`);if(i&&(i.classList.add(`${l}-focused`),"keyboard"===a&&i.classList.add(`${l}-focusVisible`),n.scrollHeight>n.clientHeight&&"mouse"!==a&&"touch"!==a)){let e=n.clientHeight+n.scrollTop,t=i.offsetTop+i.offsetHeight;t>e?n.scrollTop=t-n.clientHeight:i.offsetTop-i.offsetHeight*(1.3*!!T)<n.scrollTop&&(n.scrollTop=i.offsetTop-i.offsetHeight*(1.3*!!T))}}),eA=(0,k.unstable_useEventCallback)(({event:e,diff:t,direction:a="next",reason:r="auto"})=>{if(!ev)return;let n=function(e,t){if(!et.current||-1===e)return -1;let a=e;for(;;){if("next"===t&&a===ew.length||"previous"===t&&-1===a)return -1;let e=et.current.querySelector(`[data-option-index="${a}"]`),r=!x&&(!e||e.disabled||"true"===e.getAttribute("aria-disabled"));if((!e||e.hasAttribute("tabindex"))&&!r)return a;a+="next"===t?1:-1}}((()=>{let e=ew.length-1;if("reset"===t)return ei;if("start"===t)return 0;if("end"===t)return e;let a=eo.current+t;return a<0?-1===a&&D?-1:y&&-1!==eo.current||Math.abs(t)>1?0:e:a>e?a===e+1&&D?-1:y||Math.abs(t)>1?e:0:a})(),a);if(eC({index:n,reason:r,event:e}),i&&"reset"!==t)if(-1===n)ee.current.value=eu;else{let e=X(ew[n]);ee.current.value=e,0===e.toLowerCase().indexOf(eu.toLowerCase())&&eu.length>0&&ee.current.setSelectionRange(eu.length,e.length)}}),e$=n.useCallback(()=>{if(!ev||(()=>{var e;if(-1!==eo.current&&eS.filteredOptions&&eS.filteredOptions.length!==ew.length&&eS.inputValue===eu&&(M?es.length===eS.value.length&&eS.value.every((e,t)=>X(es[t])===X(e)):(e=eS.value,(e?X(e):"")===(es?X(es):"")))){let e=eS.filteredOptions[eo.current];if(e&&ew.some(t=>X(t)===X(e)))return!0}return!1})())return;let e=M?es[0]:es;if(0===ew.length||null==e)return void eA({diff:"reset"});if(et.current){if(null!=e){let t=ew[eo.current];if(M&&t&&-1!==$(es,e=>N(t,e)))return;let a=$(ew,t=>N(t,e));-1===a?eA({diff:"reset"}):eC({index:a});return}if(eo.current>=ew.length-1)return void eC({index:ew.length-1});eC({index:eo.current})}},[ew.length,!M&&es,w,eA,eC,ev,eu,M]),eI=(0,k.unstable_useEventCallback)(e=>{(0,S.unstable_setRef)(et,e),e&&e$()});n.useEffect(()=>{e$()},[e$]);let eR=e=>{!eh&&(em(!0),ey(!0),H&&H(e))},eO=(e,t)=>{eh&&(em(!1),U&&U(e,t))},eP=(e,t,a,r)=>{if(M){if(es.length===t.length&&es.every((e,a)=>e===t[a]))return}else if(es===t)return;z&&z(e,t,a,r),ed(t)},eT=n.useRef(!1),e_=(e,t,a="selectOption",r="options")=>{let n=a,l=t;if(M){let e=$(l=Array.isArray(es)?es.slice():[],e=>N(t,e));-1===e?l.push(t):"freeSolo"!==r&&(l.splice(e,1),n="removeOption")}eg(e,l),eP(e,l,n,{option:t}),h||e&&(e.ctrlKey||e.metaKey)||eO(e,n),(!0===d||"touch"===d&&eT.current||"mouse"===d&&!eT.current)&&ee.current.blur()},eE=(e,t)=>{if(!M)return;""===eu&&eO(e,"toggleInput");let a=en;-1===en?""===eu&&"previous"===t&&(a=es.length-1):((a+="next"===t?1:-1)<0&&(a=0),a===es.length&&(a=-1)),el(a=function(e,t){if(-1===e)return -1;let a=e;for(;;){if("next"===t&&a===es.length||"previous"===t&&-1===a)return -1;let e=ea.querySelector(`[data-tag-index="${a}"]`);if(e&&e.hasAttribute("tabindex")&&!e.disabled&&"true"!==e.getAttribute("aria-disabled"))return a;a+="next"===t?1:-1}}(a,t)),ej(a)},eD=e=>{Q.current=!0,ec(""),B&&B(e,"","clear"),eP(e,M?[]:null,"clear")},eL=e=>{ef(!0),G&&!Q.current&&eR(e)},eN=e=>{r(et)?ee.current.focus():(ef(!1),Z.current=!0,Q.current=!1,s&&-1!==eo.current&&ev?e_(e,ew[eo.current],"blur"):s&&A&&""!==eu?e_(e,eu,"blur","freeSolo"):u&&eg(e,es),eO(e,"blur"))},eM=e=>{let t=e.target.value;eu!==t&&(ec(t),ey(!1),B&&B(e,t,"input")),""===t?g||M||eP(e,null,"clear"):eR(e)},ez=e=>{let t=Number(e.currentTarget.getAttribute("data-option-index"));eo.current!==t&&eC({event:e,index:t,reason:"mouse"})},eU=e=>{eC({event:e,index:Number(e.currentTarget.getAttribute("data-option-index")),reason:"touch"}),eT.current=!0},eW=e=>{let t=Number(e.currentTarget.getAttribute("data-option-index"));e_(e,ew[t],"selectOption"),eT.current=!1},eB=e=>{eh?eO(e,"toggleInput"):eR(e)},eH=e=>{e.currentTarget.contains(e.target)&&e.target.getAttribute("id")!==J&&e.preventDefault()},eF=e=>{e.currentTarget.contains(e.target)&&(ee.current.focus(),q&&Z.current&&ee.current.selectionEnd-ee.current.selectionStart==0&&ee.current.select(),Z.current=!1)},eG=e=>{m||""!==eu&&eh||eB(e)},eV=A&&eu.length>0;eV=eV||(M?es.length>0:null!==es);let eY=ew;return T&&(eY=ew.reduce((e,t,a)=>{let r=T(t);return e.length>0&&e[e.length-1].group===r?e[e.length-1].options.push(t):e.push({key:a,index:a,group:r,options:[t]}),e},[])),m&&ep&&eN(),{getRootProps:(e={})=>(0,b.default)({"aria-owns":ek?`${J}-listbox`:null},e,{onKeyDown:t=>{if(e.onKeyDown&&e.onKeyDown(t),!t.defaultMuiPrevented&&(-1!==en&&-1===["ArrowLeft","ArrowRight"].indexOf(t.key)&&(el(-1),ej(-1)),229!==t.which))switch(t.key){case"Home":ev&&_&&(t.preventDefault(),eA({diff:"start",direction:"next",reason:"keyboard",event:t}));break;case"End":ev&&_&&(t.preventDefault(),eA({diff:"end",direction:"previous",reason:"keyboard",event:t}));break;case"PageUp":t.preventDefault(),eA({diff:-5,direction:"previous",reason:"keyboard",event:t}),eR(t);break;case"PageDown":t.preventDefault(),eA({diff:5,direction:"next",reason:"keyboard",event:t}),eR(t);break;case"ArrowDown":t.preventDefault(),eA({diff:1,direction:"next",reason:"keyboard",event:t}),eR(t);break;case"ArrowUp":t.preventDefault(),eA({diff:-1,direction:"previous",reason:"keyboard",event:t}),eR(t);break;case"ArrowLeft":eE(t,"previous");break;case"ArrowRight":eE(t,"next");break;case"Enter":if(-1!==eo.current&&ev){let e=ew[eo.current],a=!!O&&O(e);if(t.preventDefault(),a)return;e_(t,e,"selectOption"),i&&ee.current.setSelectionRange(ee.current.value.length,ee.current.value.length)}else A&&""!==eu&&!1===eb&&(M&&t.preventDefault(),e_(t,eu,"createOption","freeSolo"));break;case"Escape":ev?(t.preventDefault(),t.stopPropagation(),eO(t,"escape")):c&&(""!==eu||M&&es.length>0)&&(t.preventDefault(),t.stopPropagation(),eD(t));break;case"Backspace":if(M&&!Y&&""===eu&&es.length>0){let e=-1===en?es.length-1:en,a=es.slice();a.splice(e,1),eP(t,a,"removeOption",{option:es[e]})}break;case"Delete":if(M&&!Y&&""===eu&&es.length>0&&-1!==en){let e=es.slice();e.splice(en,1),eP(t,e,"removeOption",{option:es[en]})}}},onMouseDown:eH,onClick:eF}),getInputLabelProps:()=>({id:`${J}-label`,htmlFor:J}),getInputProps:()=>({id:J,value:eu,onBlur:eN,onFocus:eL,onChange:eM,onMouseDown:eG,"aria-activedescendant":ev?"":null,"aria-autocomplete":i?"both":"list","aria-controls":ek?`${J}-listbox`:void 0,"aria-expanded":ek,autoComplete:"off",ref:ee,autoCapitalize:"none",spellCheck:"false",role:"combobox",disabled:m}),getClearProps:()=>({tabIndex:-1,onClick:eD}),getPopupIndicatorProps:()=>({tabIndex:-1,onClick:eB}),getTagProps:({index:e})=>(0,b.default)({key:e,"data-tag-index":e,tabIndex:-1},!Y&&{onDelete:t=>{let a=es.slice();a.splice(e,1),eP(t,a,"removeOption",{option:es[e]})}}),getListboxProps:()=>({role:"listbox",id:`${J}-listbox`,"aria-labelledby":`${J}-label`,ref:eI,onMouseDown:e=>{e.preventDefault()}}),getOptionProps:({index:e,option:t})=>{let a=(M?es:[es]).some(e=>null!=e&&N(t,e)),r=!!O&&O(t);return{key:X(t),tabIndex:-1,role:"option",id:`${J}-option-${e}`,onMouseMove:ez,onClick:eW,onTouchStart:eU,"data-option-index":e,"aria-disabled":r,"aria-selected":a}},id:J,inputValue:eu,value:es,dirty:eV,expanded:ev&&ea,popupOpen:ev,focused:ep||-1!==en,anchorEl:ea,setAnchorEl:er,focusedTag:en,groupedOptions:eY}}((0,b.default)({},c,{componentName:"Autocomplete"})),e5=!U&&!H&&eK&&!eP,e8=(!ep||!0===ec)&&!1!==ec,{onMouseDown:e3}=eW(),{ref:e7}=null!=ew?ew:{},e9=eV(),{ref:te}=e9,tt=(0,y.default)(e9,Z),ta=(0,X.default)(te,e7),tr=eh||(e=>{var t;return null!=(t=e.label)?t:e}),tn=(0,b.default)({},c,{disablePortal:V,expanded:eJ,focused:eZ,fullWidth:ef,getOptionLabel:tr,hasClearIcon:e5,hasPopupIcon:e8,inputFocused:-1===e0,popupOpen:eQ,size:eN}),tl=(e=>{let{classes:t,disablePortal:a,expanded:r,focused:n,fullWidth:l,hasClearIcon:i,hasPopupIcon:o,inputFocused:s,popupOpen:d,size:u}=e,c={root:["root",r&&"expanded",n&&"focused",l&&"fullWidth",i&&"hasClearIcon",o&&"hasPopupIcon"],inputRoot:["inputRoot"],input:["input",s&&"inputFocused"],tag:["tag",`tagSize${(0,E.default)(u)}`],endAdornment:["endAdornment"],clearIndicator:["clearIndicator"],popupIndicator:["popupIndicator",d&&"popupIndicatorOpen"],popper:["popper",a&&"popperDisablePortal"],paper:["paper"],listbox:["listbox"],loading:["loading"],noOptions:["noOptions"],option:["option"],groupLabel:["groupLabel"],groupUl:["groupUl"]};return(0,w.unstable_composeClasses)(c,K,t)})(tn);if(ej&&eq.length>0){let e=e=>(0,b.default)({className:tl.tag,disabled:H},eG(e));u=eD?eD(eq,e,tn):eq.map((t,a)=>(0,r.jsx)(B.default,(0,b.default)({label:tr(t),size:eN},e({index:a}),x)))}if(eb>-1&&Array.isArray(u)){let e=u.length-eb;!eZ&&e>0&&(u=u.splice(0,eb)).push((0,r.jsx)("span",{className:tl.tag,children:eg(e)},u.length))}let ti=eT||(e=>(0,r.jsxs)("li",{children:[(0,r.jsx)(ed,{className:tl.groupLabel,ownerState:tn,component:"div",children:e.group}),(0,r.jsx)(eu,{className:tl.groupUl,ownerState:tn,children:e.children})]},e.key)),to=eE||((e,t)=>(0,r.jsx)("li",(0,b.default)({},e,{children:tr(t)}))),ts=(e,t)=>{let a=eY({option:e,index:t});return to((0,b.default)({},a,{className:tl.option}),e,{selected:a["aria-selected"],index:t,inputValue:e6},tn)},td=null!=(i=eM.clearIndicator)?i:M.clearIndicator,tu=null!=(o=eM.paper)?o:M.paper,tc=null!=(s=eM.popper)?s:M.popper,tp=null!=(d=eM.popupIndicator)?d:M.popupIndicator;return(0,r.jsxs)(n.Fragment,{children:[(0,r.jsx)(ee,(0,b.default)({ref:l,className:(0,v.default)(tl.root,A),ownerState:tn},eU(ez),{children:e_({id:eX,disabled:H,fullWidth:!0,size:"small"===eN?"small":void 0,InputLabelProps:eB(),InputProps:(0,b.default)({ref:e2,className:tl.inputRoot,startAdornment:u,onClick:e=>{e.target===e.currentTarget&&e3(e)}},(e5||e8)&&{endAdornment:(0,r.jsxs)(et,{className:tl.endAdornment,ownerState:tn,children:[e5?(0,r.jsx)(ea,(0,b.default)({},eF(),{"aria-label":L,title:L,ownerState:tn},td,{className:(0,v.default)(tl.clearIndicator,null==td?void 0:td.className),children:O})):null,e8?(0,r.jsx)(er,(0,b.default)({},eH(),{disabled:H,"aria-label":eQ?N:e$,title:eQ?N:e$,ownerState:tn},tp,{className:(0,v.default)(tl.popupIndicator,null==tp?void 0:tp.className),children:eO})):null]})}),inputProps:(0,b.default)({className:tl.input,disabled:H,readOnly:eP},eW())})})),e1?(0,r.jsx)(en,(0,b.default)({as:eR,disablePortal:V,style:{width:e1?e1.clientWidth:null},ownerState:tn,role:"presentation",anchorEl:e1,open:eQ},tc,{className:(0,v.default)(tl.popper,null==tc?void 0:tc.className),children:(0,r.jsxs)(el,(0,b.default)({ownerState:tn,as:eI},tu,{className:(0,v.default)(tl.paper,null==tu?void 0:tu.className),children:[eS&&0===e4.length?(0,r.jsx)(ei,{className:tl.loading,ownerState:tn,children:ek}):null,0!==e4.length||ep||eS?null:(0,r.jsx)(eo,{className:tl.noOptions,ownerState:tn,role:"presentation",onMouseDown:e=>{e.preventDefault()},children:eC}),e4.length>0?(0,r.jsx)(es,(0,b.default)({as:ev,className:tl.listbox,ownerState:tn},tt,ew,{ref:ta,children:e4.map((e,t)=>em?ti({key:e.key,group:e.group,children:e.options.map((t,a)=>ts(t,e.index+a))}):ts(e,t))})):null]}))})):null]})});var ep=e.i(1138),ef=e.i(70993),eg=e.i(60152),eh=e.i(14067),em=e.i(87695),ex=e.i(73743),ey=e.i(66769),eb=s,ev=e.i(71666),ew=e.i(73509),eS=e.i(12744),ek=e.i(95013),ej=e.i(77678),eC=e.i(91962),eA=e.i(54169),e$=e.i(81620),eI=e.i(71864);function eR({onRefreshRequested:e}){function t(e){if(!e)return"-";let t=String(e).trim(),a=/^(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2})(?::(\d{2}))?)?$/.exec(t),r=e=>String(e).padStart(2,"0");if(a){let[,e,t,n,l="00",i="00"]=a;return`${r(Number(n))}/${r(Number(t))}/${e} ${r(Number(l))}:${r(Number(i))}`}let n=new Date(t);return isNaN(n.getTime())?"-":`${r(n.getDate())}/${r(n.getMonth()+1)}/${n.getFullYear()} ${r(n.getHours())}:${r(n.getMinutes())}`}function a(e){if(null==e)return"";let t=String(e).toString();return"NEW"===t.toUpperCase().trim()?"PREPARATION":t}let[i,o]=(0,n.useState)([]),[s,d]=(0,n.useState)(!1),[u,c]=(0,n.useState)(null),[p,f]=(0,n.useState)([]),[g,y]=(0,n.useState)(""),[b,v]=(0,n.useState)([]),[w,S]=(0,n.useState)([]),[k,j]=(0,n.useState)(1),[C]=(0,n.useState)(10),[A,$]=(0,n.useState)(0),[I,R]=(0,n.useState)(""),[O,P]=(0,n.useState)(null),[T,_]=(0,n.useState)(!1),[E,D]=(0,n.useState)(""),[L,N]=(0,n.useState)([]),[M,z]=(0,n.useState)({open:!1,wo:null}),[U,W]=(0,n.useState)([]),[H,F]=(0,n.useState)(""),[G,V]=(0,n.useState)({}),[Y,q]=(0,n.useState)(void 0),[K,J]=(0,n.useState)(""),[X,Q]=(0,n.useState)("");async function Z(e=k,t=I,r=g){d(!0),c(null);try{let n=new URLSearchParams;t&&n.set("q",t),n.set("page",String(e)),n.set("pageSize",String(C)),r&&n.set("location",r);let i=await (0,l.default)(`/work-orders?${n.toString()}`),s=Array.isArray(i)?i:i?.data??[],d=i&&"object"==typeof i&&!Array.isArray(i)?i.meta??{page:e,pageSize:C,total:0}:{page:e,pageSize:C,total:0},u=Array.isArray(s)?s:[],c=Array.from(new Set(u.map(e=>(e.vendor_cabang??e.raw?.vendor_cabang??"").toString().trim()).filter(Boolean))),p=Array.from(new Set(u.map(e=>a(e.status??e.raw?.status??"PREPARATION").toString().trim()).filter(Boolean)));v(p),f(c);let g=u;if(console.debug("test ",u),r){let e=r.toString().toLowerCase().trim();g=u.filter(t=>(t.vendor_cabang??t.raw?.vendor_cabang??"").toString().toLowerCase().trim()===e)}if(w&&w.length>0){let e=new Set(w.map(e=>e.toString().toUpperCase().replace(/[-\s]/g,"_")));g=g.filter(t=>{let r=a(t.status??t.raw?.status??"PREPARATION").toString().toString().toUpperCase().replace(/[-\s]/g,"_");return e.has(r)})}w&&0!==w.length||(g=g.filter(e=>{let t=a(e.status??e.raw?.status??"PREPARATION").toString().toString().toUpperCase().replace(/[-\s]/g,"_");return"COMPLETED"!==t})),o(g),$("number"==typeof d.total?d.total:0)}catch(e){console.error("load work orders",e),c(e?.body?.message||e?.message||"Gagal memuat")}finally{d(!1)}}async function ee(e,t,a){_(!0);try{let r={};void 0!==t&&(r.start_date=t||null),void 0!==a&&(r.end_date=a||null),E&&E.trim().length&&(r.note=E.trim()),await (0,l.default)(`/work-orders/${encodeURIComponent(e)}`,{method:"PATCH",body:r}),Z(k,I),P(null)}catch(e){console.error("save edit",e),alert("Gagal menyimpan: "+(e?.body?.message||e?.message))}finally{_(!1)}}function et(e){if(!e)return"";let t=String(e).trim(),a=/^(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2})(?::(\d{2}))?)?$/.exec(t),r=e=>String(e).padStart(2,"0");if(a){let[,e,t,n,l="00",i="00"]=a;return`${e}-${t}-${n}T${r(Number(l))}:${r(Number(i))}`}let n=new Date(t);return isNaN(n.getTime())?"":`${n.getFullYear()}-${r(n.getMonth()+1)}-${r(n.getDate())}T${r(n.getHours())}:${r(n.getMinutes())}`}function ea(e){switch(a(e).toString().toUpperCase()){case"ASSIGNED":return"#1e40af";case"DEPLOYED":return"#db2777";case"READY_TO_DEPLOY":return"#7c3aed";case"IN_PROGRESS":case"IN-PROGRESS":return"#f97316";case"COMPLETED":return"#10b981";case"PREPARATION":case"OPEN":return"#64748b";case"CANCELLED":return"#ef4444";case"CLOSED":return"#334155";default:return"#6b7280"}}function er(e){let t=(e?.status??e?.raw?.status??"").toString().toUpperCase().replace(/[-\s]/g,"_");return"IN_PROGRESS"!==t&&"COMPLETED"!==t}async function en(e){try{await (0,l.default)(`/work-orders/${encodeURIComponent(e)}/deploy`,{method:"POST"});let t=await (0,l.default)(`/work-orders/${encodeURIComponent(e)}`),a=t?.data??t,r=await (0,l.default)(`/work-orders/${encodeURIComponent(e)}/tasks`),n=Array.isArray(r)?r:r?.data??[];z(e=>({...e||{},wo:{...e?.wo||{},...a,tasks:n}})),Z(k,I)}catch(e){console.error("deploy failed",e),alert("Deploy gagal: "+(e?.message||e))}}async function el(e){try{await (0,l.default)(`/work-orders/${encodeURIComponent(e)}/undeploy`,{method:"POST"});let t=await (0,l.default)(`/work-orders/${encodeURIComponent(e)}`),a=t?.data??t,r=await (0,l.default)(`/work-orders/${encodeURIComponent(e)}/tasks`),n=Array.isArray(r)?r:r?.data??[];z(e=>({...e||{},wo:{...e?.wo||{},...a,tasks:n}})),Z(k,I)}catch(e){console.error("undeploy failed",e),alert("Undeploy gagal: "+(e?.message||e))}}return(0,n.useEffect)(()=>{Z(1,I),j(1)},[I,g,w]),(0,n.useEffect)(()=>{"function"==typeof e&&e(async()=>{await Z(1,I,g),j(1)})},[]),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{style:{display:"flex",gap:8,marginBottom:12,alignItems:"center"},children:[(0,r.jsxs)(h.default,{sx:{display:"flex",gap:2,flexWrap:"wrap",mb:2},children:[(0,r.jsxs)(ep.default,{value:g,onChange:e=>y(String(e.target.value)),displayEmpty:!0,size:"small",sx:{minWidth:180},children:[(0,r.jsx)(ef.default,{value:"",children:"Semua Lokasi"}),p.map(e=>(0,r.jsx)(ef.default,{value:e,children:e},e))]}),(0,r.jsx)(ep.default,{multiple:!0,displayEmpty:!0,size:"small",value:w,onChange:e=>S("string"==typeof e.target.value?e.target.value.split(","):e.target.value),renderValue:e=>e&&e.length>0?(0,r.jsx)(h.default,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:e.map(e=>(0,r.jsx)(B.default,{label:e,size:"small"},e))}):"Semua Status",sx:{minWidth:220},children:["PREPARATION","ASSIGNED","READY TO DEPLOY","DEPLOYED","IN PROGRESS","COMPLETED"].map(e=>(0,r.jsxs)(ef.default,{value:e,children:[(0,r.jsx)(eA.default,{checked:w.indexOf(e)>-1}),e]},e))}),(0,r.jsx)(x.default,{placeholder:"Search doc_no / asset / desc",value:I,onChange:e=>R(e.target.value),size:"small",sx:{flex:1,minWidth:240}}),(0,r.jsx)(eg.default,{variant:"contained",color:"primary",size:"small",onClick:()=>Z(1,I),disabled:s,children:"Search"}),(0,r.jsx)(eg.default,{variant:"outlined",size:"small",onClick:()=>Z(1,I),disabled:s,children:"Refresh"}),(0,r.jsxs)(h.default,{sx:{alignSelf:"center",ml:"auto",color:"text.secondary"},children:[A," item"]})]}),s?(0,r.jsx)(eI.default,{variant:"body2",children:"Loading..."}):null,u?(0,r.jsx)(eI.default,{variant:"body2",color:"error",children:u}):null]}),(0,r.jsxs)("div",{style:{overflowX:"auto"},children:[(0,r.jsx)(ek.default,{component:m.default,sx:{mb:2},children:(0,r.jsxs)(ev.default,{size:"small",children:[(0,r.jsx)(ej.default,{children:(0,r.jsxs)(eC.default,{children:[(0,r.jsx)(eS.default,{children:"Doc No"}),(0,r.jsx)(eS.default,{children:"Jenis Work Order"}),(0,r.jsx)(eS.default,{children:"Start"}),(0,r.jsx)(eS.default,{children:"End"}),(0,r.jsx)(eS.default,{children:"Equipment"}),(0,r.jsx)(eS.default,{children:"Status"}),(0,r.jsx)(eS.default,{children:"Location"}),(0,r.jsx)(eS.default,{children:"Description"}),(0,r.jsx)(eS.default,{children:"Progress"}),(0,r.jsx)(eS.default,{children:"Action"})]})}),(0,r.jsx)(ew.default,{children:i.map(e=>{let n,i,o,s,d=e.raw?.activities??[],u=a(e.status??e.raw?.status??"PREPARATION").toString(),c=u.toUpperCase().replace(/[-\s]/g,"_");return(0,r.jsxs)(eC.default,{hover:!0,children:[(0,r.jsx)(eS.default,{children:e.doc_no??e.id}),(0,r.jsx)(eS.default,{children:e.work_type??e.type_work??e.raw?.work_type??e.raw?.type_work??"-"}),(0,r.jsx)(eS.default,{children:t(e.start_date)}),(0,r.jsx)(eS.default,{children:t(e.end_date)}),(0,r.jsx)(eS.default,{children:e.asset_name??"-"}),(0,r.jsx)(eS.default,{children:(i=ea(n=a(e.status??e.raw?.status??"PREPARATION")),(0,r.jsx)("span",{style:{display:"inline-block",padding:"4px 8px",borderRadius:999,background:i,color:"white",fontSize:12,fontWeight:600},children:String(n).replace(/_/g," ")}))}),(0,r.jsx)(eS.default,{children:e.vendor_cabang??e.raw?.vendor_cabang??"-"}),(0,r.jsx)(eS.default,{sx:{maxWidth:220,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.description??"-"}),(0,r.jsx)(eS.default,{sx:{width:180},children:"IN_PROGRESS"===c&&"number"==typeof e.progress?(o=Math.max(0,Math.min(1,e.progress||0)),s=ea(u),(0,r.jsxs)(h.default,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[(0,r.jsxs)(eI.default,{variant:"caption",sx:{fontWeight:700},children:[Math.round(100*o),"%"]}),(0,r.jsx)(e$.default,{variant:"determinate",value:Math.round(100*o),sx:{height:8,borderRadius:2,backgroundColor:"#f1f5f9","& .MuiLinearProgress-bar":{background:s}}})]})):(0,r.jsx)(eI.default,{variant:"body2",color:"text.secondary",children:"-"})}),(0,r.jsx)(eS.default,{children:(0,r.jsxs)(h.default,{sx:{display:"flex",gap:1},children:[Array.isArray(d)&&d.length>0&&(0,r.jsxs)(eg.default,{size:"small",variant:"outlined",onClick:()=>(function(e){if(console.debug("[openTaskModal]"),console.debug("workorder:",e),!e.start_date){alert("Work Order belum memiliki Start Date. Isi Start Date dan End Date terlebih dahulu."),P(e);return}F(""),W([]),V({}),z({open:!0,wo:e}),(async()=>{let t=[];try{let a=e.vendor_cabang??e.raw?.vendor_cabang??e.raw?.site??"",r=String(a||"").toLowerCase().trim(),n=e=>String(e).padStart(2,"0"),i=function(e){if(!e)return null;let t=String(e).trim(),a=/^(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2})(?::(\d{2}))?)?$/.exec(t);if(a){let[,e,t,r,n="00",l="00",i="00"]=a,o=new Date(Date.UTC(Number(e),Number(t)-1,Number(r),Number(n),Number(l),Number(i)));return new Date(o.getTime()+0)}let r=new Date(t);return isNaN(r.getTime())?null:new Date(r.getTime()+0)}(String(e.start_date));if(!i){alert("Start Date tidak valid. Isi Start Date yang benar terlebih dahulu."),P(e);return}let o=`${i.getUTCFullYear()}-${n(i.getUTCMonth()+1)}-${n(i.getUTCDate())}`,s=`${n(i.getUTCHours())}:${n(i.getUTCMinutes())}`;console.debug("[openTaskModal] assignDate/time (local)",{assignDate:o,assignTime:s,raw:e.start_date});let d=`/scheduled-technicians?date=${encodeURIComponent(o)}&time=${encodeURIComponent(s)}`+(r?`&site=${encodeURIComponent(r)}`:"");console.debug(d);try{console.debug("[openTaskModal] fetching scheduled technicians",{schedUrl:d});let e=await (0,l.default)(d);console.debug(e);let a=Array.isArray(e)?e:e?.data??[];console.debug("[openTaskModal] scheduled-technicians response",{count:Array.isArray(a)?a.length:0}),a&&a.length>0?(t=a,console.debug("[openTaskModal] using scheduled-technicians sample",a.slice(0,5))):t=a}catch(r){console.warn("scheduled-technicians fetch failed, falling back",r);let e=await (0,l.default)("/users?role=technician"),a=Array.isArray(e)?e:e?.data??[];console.debug("[openTaskModal] fallback /users?role=technician response",{count:Array.isArray(a)?a.length:0}),t=a}console.debug("[openTaskModal] final filteredTechs",{count:t.length,sample:t.slice(0,5)}),W(t)}catch(e){console.warn("Failed to load technicians from shift assignments",e),W([]),t=[]}try{let a=await (0,l.default)(`/work-orders/${encodeURIComponent(e.id)}`),r=a?.data??a;try{console.debug("[openTaskModal] fetching tasks for workorder",{workOrderId:e.id});let t=await (0,l.default)(`/work-orders/${encodeURIComponent(e.id)}/tasks`),a=Array.isArray(t)?t:t?.data??[];console.debug("[openTaskModal] tasks fetch result",{count:Array.isArray(a)?a.length:0,sample:a.slice(0,5)}),r.tasks=a}catch(t){console.debug("[openTaskModal] /tasks fetch failed, falling back to raw.activities",t);let e=Array.isArray(r.raw?.activities)?r.raw.activities:[];r.tasks=e.map((e,t)=>({id:`raw-${t}`,name:e.task_name||e.name||`Task ${t+1}`,duration_min:e.task_duration}))}z({open:!0,wo:r});let n={},i=Array.isArray(r.tasks)?r.tasks:[],o=new Set((Array.isArray(t)?t:[]).map(e=>String(e.id)));for(let e of(console.debug("[openTaskModal] building selectedAssignees from task.assignments",{taskCount:i.length,techIdsCount:o.size}),i)){let t=String(e.id??e.task_id??e.external_id??"");if(!t)continue;let a=Array.isArray(e.assignments)?e.assignments:[],r=[];for(let e of a){let a=String(e?.user?.id??e.user_id??e.userId??"");if(a){if(!o.has(a)){console.debug("[openTaskModal] skipping assignment because assignee not in filtered technicians",{assId:a,key:t});continue}r.includes(a)||r.push(a)}}r.length>0&&(n[t]=r)}console.debug("[openTaskModal] selectedAssignees prepared",n),V(n)}catch(e){console.warn("Failed to load workorder detail",e)}try{let e=await (0,l.default)("/auth/me");q(e?.data??e)}catch(e){q(null)}})()})(e),children:["Lihat Task (",d.length,")"]}),"IN_PROGRESS"!==c&&"COMPLETED"!==c&&"DEPLOYED"!==c&&(0,r.jsx)(eg.default,{size:"small",variant:"contained",color:"secondary",onClick:()=>{P(e),D(""),J(et(e.start_date)),Q(et(e.end_date)),(async()=>{try{let t=await (0,l.default)(`/work-orders/${encodeURIComponent(e.id)}/date-history`),a=t?.data??t;Array.isArray(a)?N(a):N([])}catch(e){N([])}})()},children:"Edit Dates"})]})})]},e.id)})})]})}),(0,r.jsxs)(h.default,{sx:{display:"flex",gap:2,alignItems:"center"},children:[(0,r.jsx)(eg.default,{onClick:function(){k>1&&j(e=>{let t=e-1;return Z(t),t})},disabled:k<=1,size:"small",children:"Prev"}),(0,r.jsxs)(eI.default,{variant:"body2",children:["Page ",k," / ",Math.max(1,Math.ceil(A/C))]}),(0,r.jsx)(eg.default,{onClick:function(){k<Math.ceil(A/C)&&j(e=>{let t=e+1;return Z(t),t})},disabled:k>=Math.max(1,Math.ceil(A/C)),size:"small",children:"Next"})]})]}),M.open&&M.wo&&(0,r.jsx)("div",{style:{position:"fixed",left:0,right:0,top:0,bottom:0,background:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:2e3,padding:16},children:(0,r.jsxs)("div",{style:{background:"white",padding:16,width:"95%",maxWidth:900,borderRadius:8,maxHeight:"86vh",overflow:"auto",boxShadow:"0 6px 30px rgba(0,0,0,0.2)"},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:12,marginBottom:12},children:[(0,r.jsxs)("div",{style:{flex:1},children:[(0,r.jsxs)("h2",{style:{marginTop:0,marginBottom:6,fontSize:20},children:["Task - ",M.wo.doc_no??M.wo.id]}),(0,r.jsx)("div",{style:{color:"#666",fontSize:13},children:M.wo.description})]}),(0,r.jsxs)("div",{style:{textAlign:"right",minWidth:180},children:[(0,r.jsx)("div",{style:{fontSize:13,marginBottom:8},children:void 0===Y?(0,r.jsx)("span",{style:{color:"#666"},children:"Checking auth..."}):null===Y?(0,r.jsx)("span",{style:{color:"#c00"},children:"Not authenticated"}):(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{style:{fontWeight:700},children:Y.name||Y.username||Y.email}),(0,r.jsxs)("div",{style:{color:"#666",fontSize:12},children:[Y.email," — ",Y.role??Y.type]})]})}),(0,r.jsxs)("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[M.wo?.status==="READY_TO_DEPLOY"&&(0,r.jsx)("button",{onClick:()=>en(M.wo.id),style:{padding:"6px 10px",background:"#7c3aed",color:"white",borderRadius:6},children:"Deploy"}),M.wo?.status==="DEPLOYED"&&(0,r.jsx)("button",{onClick:()=>el(M.wo.id),style:{padding:"6px 10px",background:"#ef4444",color:"white",borderRadius:6},children:"Undeploy"}),(0,r.jsx)("button",{onClick:function(){z({open:!1,wo:null}),F("");try{Z(k,I)}catch(e){console.warn("Failed to refresh work order list after closing modal",e)}},style:{padding:"6px 10px"},children:"Close"})]})]})]}),(0,r.jsx)("div",{style:{marginBottom:8},children:(0,r.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",tableLayout:"fixed"},children:[(0,r.jsxs)("colgroup",{children:[(0,r.jsx)("col",{style:{width:"50px"}}),(0,r.jsx)("col",{}),(0,r.jsx)("col",{style:{width:"110px"}}),(0,r.jsx)("col",{style:{width:"340px"}})]}),(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{style:{background:"#f5f5f5"},children:[(0,r.jsx)("th",{style:{textAlign:"left",padding:12,borderBottom:"1px solid #ddd"},children:"No"}),(0,r.jsx)("th",{style:{textAlign:"left",padding:12,borderBottom:"1px solid #ddd"},children:"Task Name"}),(0,r.jsx)("th",{style:{textAlign:"left",padding:12,borderBottom:"1px solid #ddd",textAlignLast:"right"},children:"Duration (min)"}),er(M.wo)&&(0,r.jsx)("th",{style:{textAlign:"left",padding:12,borderBottom:"1px solid #ddd"},children:"Assign technicians"})]})}),(0,r.jsx)("tbody",{children:Array.isArray(M.wo.tasks)&&M.wo.tasks.map((e,t)=>{let a,n=e.id??e.task_id??String(t);G[n];let i=function(e){try{for(let t of["realisasi","realisasis","realisasi_list","realisasi_entries","realisasiItems","realisasi_items","realisasiEntries"]){let a=e[t];if(Array.isArray(a)&&a.length>0)return!0}if(Array.isArray(e.assignments))for(let t of e.assignments){if(Array.isArray(t.realisasi)&&t.realisasi.length>0||(t.realisasi_count||t.realisasiCount||t.realisasiTotal)>0)return!0;let e=(t.status||t.state||"").toString().toUpperCase();if(e.includes("COMP")||e.includes("VERIF")||e.includes("DONE")||e.includes("APPROV"))return!0}let t=Array.isArray(M.wo?.assignments)?M.wo.assignments:[];if(t.length>0)for(let a of t){let t=a.task_id??a.taskId??a.task?.id?String(a.task_id??a.taskId??a.task?.id):null,r=e.id??e.task_id??e.external_id?String(e.id??e.task_id??e.external_id):null;if(t&&r&&t===r){if(Array.isArray(a.realisasi)&&a.realisasi.length>0||(a.realisasi_count||a.realisasiCount||a.realisasiTotal)>0)return!0;let e=(a.status||a.state||"").toString().toUpperCase();if(e.includes("COMP")||e.includes("VERIF")||e.includes("DONE")||e.includes("APPROV"))return!0}let n=(a.task_name||a.taskName||a.task?.name||"").toString().trim().toLowerCase(),l=(e.name||e.task_name||e.taskName||"").toString().trim().toLowerCase();if(n&&l&&n===l){if(Array.isArray(a.realisasi)&&a.realisasi.length>0||(a.realisasi_count||a.realisasiCount||a.realisasiTotal)>0)return!0;let e=(a.status||a.state||"").toString().toUpperCase();if(e.includes("COMP")||e.includes("VERIF")||e.includes("DONE")||e.includes("APPROV"))return!0}}if(!0===e.completed||!0===e.is_completed||String(e.status||"").toUpperCase().includes("COMP")||e.completed_at||e.realisasi_at||e.approved_at)return!0}catch(e){}return!1}(e)||!!(e.has_realisasi||e.realisasi_count);return(0,r.jsxs)("tr",{style:{borderBottom:"1px solid #f1f1f1"},children:[(0,r.jsx)("td",{style:{padding:12,verticalAlign:"top"},children:e.task_number??t+1}),(0,r.jsxs)("td",{style:{padding:12,verticalAlign:"top"},children:[(0,r.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,r.jsx)("div",{style:{fontWeight:700},children:e.name??e.task_name??"-"}),i?(0,r.jsx)("span",{style:{background:"#10b981",color:"white",padding:"2px 8px",borderRadius:999,fontSize:12,fontWeight:600},children:"Realisasi ✓"}):(a=Number(e.pending_realisasi_count||e.pendingCount||0),e.has_pending||a>0?(0,r.jsxs)("span",{style:{background:"#f59e0b",color:"white",padding:"2px 8px",borderRadius:999,fontSize:12,fontWeight:600},children:["Pending",a?` (${a})`:""]}):(0,r.jsx)("span",{style:{background:"#64748b",color:"white",padding:"2px 8px",borderRadius:999,fontSize:12,fontWeight:600},children:"Belum Realisasi"}))]}),(0,r.jsxs)("div",{style:{fontSize:12,color:"#888",marginTop:6},children:["ID: ",e.id??"-"]}),Array.isArray(e.assignments)&&e.assignments.length>0&&(0,r.jsx)("div",{style:{marginTop:8,display:"flex",gap:8,flexWrap:"wrap"},children:e.assignments.map(t=>(0,r.jsxs)("div",{style:{background:"#eef2ff",padding:"4px 8px",borderRadius:6,display:"flex",gap:8,alignItems:"center"},children:[(0,r.jsx)("span",{style:{fontSize:13,fontWeight:600},children:t.user?.name??t.user?.nipp??t.user?.email??t.assigned_to??"Unknown"}),Y&&!["DEPLOYED","IN_PROGRESS"].includes((M.wo?.status??"").toString())&&(0,r.jsx)("button",{onClick:async()=>{try{await (0,l.default)(`/tasks/${encodeURIComponent(e.id)}/assign/${encodeURIComponent(t.id)}`,{method:"DELETE"})}catch(a){try{await (0,l.default)(`/tasks/${encodeURIComponent(e.id)}/assign/${encodeURIComponent(t.id)}`,{method:"DELETE"})}catch(e){console.error("unassign failed",e),alert("Unassign failed");return}}try{let e=await (0,l.default)(`/work-orders/${encodeURIComponent(M.wo?.id)}`),t=e?.data??e,a=await (0,l.default)(`/work-orders/${encodeURIComponent(M.wo?.id)}/tasks`),r=Array.isArray(a)?a:a?.data??[];z(e=>({...e||{},wo:{...e?.wo||{},...t,tasks:r}}))}catch(e){console.warn("refresh workorder after unassign failed",e)}},style:{background:"transparent",border:"none",color:"#c00",cursor:"pointer"},children:"Unassign"})]},t.id))})]}),(0,r.jsx)("td",{style:{padding:12,verticalAlign:"top",textAlign:"right"},children:e.duration_min??e.task_duration??"-"}),er(M.wo)?(0,r.jsx)("td",{style:{padding:12,verticalAlign:"top"},children:(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[(0,r.jsx)(ec,{multiple:!0,options:U||[],getOptionLabel:e=>(e.name||e.nipp||e.email||"").toString(),filterSelectedOptions:!0,value:(G[n]||[]).map(e=>U.find(t=>t.id===e)).filter(Boolean),onChange:(e,t)=>V(e=>({...e,[n]:t.map(e=>e.id)})),renderInput:e=>(0,r.jsx)(x.default,{...e,placeholder:"Cari teknisi (nama / email / id)",size:"small"})}),(0,r.jsx)("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginTop:8},children:(U||[]).slice(0,200).map(e=>{let t=(G[n]||[]).includes(e.id);return(0,r.jsx)(B.default,{label:(e.name||e.nipp||e.email||"").toString(),onClick:()=>{V(t=>{let a=new Set(t[n]||[]);return a.has(e.id)?a.delete(e.id):a.add(e.id),{...t,[n]:Array.from(a)}})},clickable:!0,color:t?"primary":"default",variant:t?"filled":"outlined",size:"small",sx:{marginRight:.5}},e.id)})}),(0,r.jsx)("div",{style:{display:"flex",gap:8,justifyContent:"flex-start",marginTop:8},children:void 0===Y?(0,r.jsx)(eg.default,{size:"small",disabled:!0,children:"Checking..."}):null===Y?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eg.default,{size:"small",variant:"contained",color:"primary",onClick:()=>{window.location.href="/login"},children:"Login to assign"}),(0,r.jsx)(eg.default,{size:"small",onClick:()=>{V(e=>({...e,[n]:[]}))},children:"Clear"})]}):["DEPLOYED","IN_PROGRESS"].includes((M.wo?.status??"").toString())?(0,r.jsx)(eg.default,{size:"small",disabled:!0,children:"Deployed"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eg.default,{size:"small",variant:"contained",onClick:async()=>{let a=G[n]||[];if(!a||0===a.length)return void alert("Pilih minimal 1 teknisi");try{for(let r of Array.from(new Set(a)))await (0,l.default)(`/tasks/${encodeURIComponent(e.id??e.task_id??String(t))}/assign`,{method:"POST",body:{userId:r,assignedBy:Y?.id}});alert("Assignment created");try{let e=await (0,l.default)(`/work-orders/${encodeURIComponent(M.wo?.id)}`),t=e?.data??e,a=await (0,l.default)(`/work-orders/${encodeURIComponent(M.wo?.id)}/tasks`),r=Array.isArray(a)?a:a?.data??[];z(e=>({...e||{},wo:{...e?.wo||{},...t,tasks:r}}))}catch(e){console.warn("refresh tasks after assign failed",e)}Z(k,I)}catch(e){console.error("assign error",e),alert(e?.body?.message||e?.message||"Assignment failed")}},children:"Assign"}),(0,r.jsx)(eg.default,{size:"small",onClick:()=>{V(e=>({...e,[n]:[]}))},children:"Clear"})]})})]})}):(0,r.jsx)("td",{style:{padding:12,verticalAlign:"top"}})]},t)})})]})})]})}),(0,r.jsxs)(eh.default,{open:!!O,onClose:()=>P(null),fullWidth:!0,maxWidth:"sm",children:[(0,r.jsxs)(em.default,{children:["Edit Dates — ",O?.doc_no??O?.id]}),(0,r.jsx)(ex.default,{dividers:!0,children:(0,r.jsxs)(eb.default,{spacing:2,sx:{mt:1},children:[(0,r.jsx)(x.default,{label:"Start Date & Time",type:"datetime-local",size:"small",value:K,onChange:e=>J(e.target.value),InputLabelProps:{shrink:!0},fullWidth:!0}),(0,r.jsxs)("div",{style:{fontSize:12,color:"#666"},children:["Current: ",t(O?.start_date)]}),(0,r.jsx)(x.default,{label:"End Date & Time",type:"datetime-local",size:"small",value:X,onChange:e=>Q(e.target.value),InputLabelProps:{shrink:!0},fullWidth:!0}),(0,r.jsxs)("div",{style:{fontSize:12,color:"#666"},children:["Current: ",t(O?.end_date)]}),(0,r.jsx)(x.default,{label:"Keterangan (opsional)",placeholder:"Alasan atau catatan perubahan tanggal",multiline:!0,rows:4,value:E,onChange:e=>D(e.target.value),fullWidth:!0,size:"small"}),Array.isArray(L)&&L.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"History perubahan tanggal"}),(0,r.jsx)("div",{style:{maxHeight:240,overflow:"auto"},children:L.map((e,a)=>(0,r.jsxs)("div",{style:{padding:12,borderBottom:"1px solid #f5f5f5"},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsx)("div",{style:{fontSize:13,color:"#333",fontWeight:700},children:e.changed_at?new Date(e.changed_at).toLocaleString():"-"}),(0,r.jsx)("div",{style:{fontSize:12,color:"#666"},children:e.changed_by?`${e.changed_by.nipp??e.changed_by.id??"-"} • ${e.changed_by.name??e.changed_by.email??"-"}`:"-"})]}),(0,r.jsxs)("div",{style:{marginTop:6,color:"#444"},children:[(0,r.jsxs)("div",{children:["Start: ",e.old_start?t(e.old_start):"-"," → ",e.new_start?t(e.new_start):"-"]}),(0,r.jsxs)("div",{children:["End: ",e.old_end?t(e.old_end):"-"," → ",e.new_end?t(e.new_end):"-"]})]}),e.note&&(0,r.jsxs)("div",{style:{marginTop:8,fontSize:13,color:"#555"},children:["Catatan: ",e.note]})]},e.id||a))})]})]})}),(0,r.jsxs)(ey.default,{sx:{p:2},children:[(0,r.jsx)(eg.default,{onClick:()=>P(null),disabled:T,children:"Batal"}),(0,r.jsx)(eg.default,{variant:"contained",color:"primary",onClick:async()=>{function e(e){if(!e)return null;let t=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2})$/.exec(e);if(!t)return null;let[,a,r,n,l,i]=t;return`${a}-${r}-${n} ${l}:${i}:00`}if(K&&!/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2})$/.test(K))return void alert("Start date tidak valid");if(X&&!/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2})$/.test(X))return void alert("End date tidak valid");let t=e(K||null),a=e(X||null);await ee(O.id,t,a)},disabled:T,children:T?"Menyimpan...":"Simpan Perubahan"})]})]})]})}function eO(){let e=(0,n.useRef)(null);return(0,r.jsxs)("main",{style:{padding:24,fontFamily:'Inter, system-ui, -apple-system, Roboto, "Helvetica Neue", Arial'},children:[(0,r.jsx)("h1",{style:{marginBottom:12},children:"Work Orders"}),(0,r.jsx)("section",{style:{marginBottom:20},children:(0,r.jsx)(g,{onCreated:()=>e.current?.()})}),(0,r.jsx)("section",{children:(0,r.jsx)(eR,{onRefreshRequested:t=>e.current=t})})]})}e.s(["default",()=>eO],60855)}]);