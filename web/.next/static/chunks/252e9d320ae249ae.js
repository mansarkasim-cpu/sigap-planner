(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,63586,e=>{"use strict";var t=e.i(14294),i=e.i(30878),s=e.i(23703);function n(){let[e,n]=(0,i.useState)([]),[r,l]=(0,i.useState)(!0),[a,o]=(0,i.useState)([]),[d,u]=(0,i.useState)(null),[c,g]=(0,i.useState)(null),[h,m]=(0,i.useState)(!1),f=localStorage.getItem("userId");async function p(){l(!0);try{let e=f?`?user=${encodeURIComponent(f)}`:"",t=await (0,s.apiFetch)(`/assignments${e}`);n(Array.isArray(t)?t:t.items||[])}catch(e){console.error("fetch assignments error",e),n([])}finally{l(!1)}}async function S(){if(!c)return void alert("Select assignment first");m(!0);try{let e=[];for(let t of a){let i=await (0,s.uploadFilePresign)(t);e.push(i.url)}let t=null;d&&(t=(await (0,s.uploadFilePresign)(d)).url);let i={wo_id:c.work_order_id||c.work_order?.wo_id||null,assignment_id:c.id,start_time:new Date().toISOString(),end_time:new Date().toISOString(),actions_taken:"Submitted from web UI",man_hours:1,notes:"Uploaded from Next.js web",photos:e,signature:t},n=await (0,s.apiFetch)("/realisasi",{method:"POST",body:i});alert("Realisasi submitted: "+(n.realisasi_id||n.id||"ok")),p(),o([]),u(null),g(null)}catch(e){console.error(e),alert("Submit failed: "+(e.message||"error"))}finally{m(!1)}}return(0,i.useEffect)(()=>{p()},[]),(0,t.jsxs)("div",{style:{padding:20},children:[(0,t.jsx)("h1",{children:"Assignments"}),r?(0,t.jsx)("div",{children:"Loading..."}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("ul",{children:e.map(e=>(0,t.jsxs)("li",{style:{marginBottom:8},children:[(0,t.jsx)("strong",{children:e.work_order?.title||e.work_order_id}),(0,t.jsxs)("div",{children:["Assignee: ",e.assignee_id]}),(0,t.jsxs)("div",{children:["Status: ",e.status]}),(0,t.jsx)("button",{onClick:()=>g(e),style:{marginTop:6},children:"Select"})]},e.id))}),(0,t.jsx)("hr",{}),(0,t.jsx)("h2",{children:"Submit Realisasi"}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{children:["Selected assignment: ",c?c.id:"â€”"]}),(0,t.jsx)("input",{type:"file",multiple:!0,onChange:function(e){o(Array.from(e.target.files||[]))}}),(0,t.jsxs)("div",{style:{marginTop:8},children:[(0,t.jsx)("label",{children:"Signature (PNG): "}),(0,t.jsx)("input",{type:"file",accept:"image/png",onChange:function(e){u(e.target.files&&e.target.files[0]||null)}})]}),(0,t.jsx)("div",{style:{marginTop:12},children:(0,t.jsx)("button",{onClick:S,disabled:h||!c,children:h?"Submitting...":"Submit Realisasi"})})]})]})]})}e.s(["default",()=>n])}]);